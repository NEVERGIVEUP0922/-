<!-- 前台搜索模板文件  -->
<!-- 方案中心的命名:(旧)planCenter,(新)solution,简写sol -->

<extend name="Layout:layout" />

<block name="title">方案中心</block>
<block name="keywords">这里是关键字</block>
<block name="description">这里是描述</block>
<block name="css">
	<link rel="stylesheet" href="__PUBLIC__/Home/Public/css/search-nav.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/Index/css/release.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/Solution/css/project_upload.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/Solution/css/public.css">
	<link rel="stylesheet" href="__PUBLIC__/Common/module/layui/2.2.4/css/layui.css" rel="stylesheet"  media="all">

	<!--sol的前缀是solution(方案)的缩写-->
</block>
<block name="main">
	<!-- 主要内容 -->
	<!--面包屑导航系统-->
	{$breadcrum}
	<!--页面布局主区域-->
	<div id="jl-project">
		<!--进度条-->
		<div>
			<ul id="jl-cart-progress" class="jl-cle">
				<li class="jl-cur">
					<p>
						<span class="jl-serial">1</span>
						填写方案基本信息
					</p>
					<i class="jl-arr"></i>
				</li>
				<li>
					<i class="jl-arr-white"></i>
					<p>
						<span class="jl-serial">2</span>
						上传相关文件
					</p>
					<i class="jl-arr"></i>
				</li>
				<li class="jl-progress-last">
					<i class="jl-arr-white"></i>
					<p>
						<span class="jl-serial">3</span>
						提交成功,后台审核中
					</p>
				</li>
			</ul>
		</div>
		<!--提交成功-->
		<div class="tj_success">
			<div class="tj1"><img src="__PUBLIC__/Home/Solution/img/tj_success.png" alt=""></div>
			<div class="tj2">您已成功提交方案!</div>
			<div class="tj3">方案已提交进入审核， 审核通过后才会发布</div>
			<div class="tj4">
				<div class="browse-desir">查看方案</div>
				<div class="return-index">返回上传</div>
			</div>
		</div>
		<!--基本信息-->
		<div class="content-main">
			<div class="content-list">
				<ul>
					<li>
						<div class="List-name">
							<i class="xinxin"></i><label for="types">方案类型:</label>
						</div>
						<div class="List-content" >
							<select name="types" id="types" class="form-control">
								<if condition="empty($types) neq true">
									<option value="0">--请选择方案类型--</option>
									<else/>
									<foreach name="sol_types" item="vo">
										<option value="{$vo.id}">{$vo.types}</option>
									</foreach>
								</if>
							</select>
						</div>
					</li>
					<li>
						<div class="List-name">
							<i class="xinxin"></i><label for="pro_name">方案名:</label>
						</div>
						<div class="List-content">
							<input type="text" name="desir_name" value="" id="pro_name" class="form-control" placeholder="请填写方案名">
							<span class="empty_check yincang"></span>
						</div>
					</li>
					<li>
						<div class="List-name">
							<i class="xinxin"></i><label for="main_model">主控型号:</label>
						</div>
						<div class="List-content">
							<input type="text" name="mobile" value="" id="main_model" class="form-control" placeholder="请填写主控型号" >
							<span class="empty_check yincang"></span>
						</div>
					</li>
					<li>
						<div class="List-name">
							<i class="xinxin"></i><label for="main_brand">主控品牌:</label>
						</div>
						<div class="List-content">
							<input type="text" name="company" value="" id="main_brand" class="form-control" placeholder="请填写主控的品牌">
							<span class="empty_check yincang"></span>
						</div>
					</li>
					<li>
						<div class="List-name">
							<i class="xinxin"></i><label for="synopsis">方案简要描述:</label>
						</div>
						<div class="List-content">
							<textarea name="desir_desc" id="synopsis" class="form-control" value="" rows="3"  placeholder="请填写方案简要描述" style="display: block;padding: 10px;width:718px;"></textarea>
						</div>
						<div class="enter_content float_R">
							<span class="empty_check yincang" id="desc_empty_check"></span>
							还可以输入<span id="enter_content"><!--还可以输入字--></span>个字!</div>
						<div class="clear"></div>
					</li>
					<li>
						<div class="List-name">
							<i class="xinxin"></i><label for="pro_desc">方案详细描述:</label>
						</div>
						<div class="List-content">
							<textarea name="desir_desc" id="pro_desc" class="form-control" value="" rows="5"  placeholder="请填写方案详细描述" style="display: block;padding: 10px; width:718px;"></textarea>
						</div>
						<div class="enter_content float_R">
							<span class="empty_check yincang" id="desc_empty_check2"></span>
							还可以输入<span id="enter_content2"><!--还可以输入字--></span>个字!</div>
						<div class="clear"></div>
					</li>

					<li>
						<div class="List-name">
							<i class="xinxin"></i><label >是否提供PCBA:</label>
						</div>
						<div class="List-content layui-form">
							<div class="layui-form-item">
								<div class="layui-input-block">
									<input type="radio" name="pcba" value="1" lay-filter="test" title="是" checked="" >
									<span style="display:inline-block;width:50px;"></span>
									<input type="radio" name="pcba" value="0" lay-filter="test" title="否" >
									<input type="text" name="pcba_list" value="" placeholder="请输入方案需要的pcba型号">
									<span class="empty_check yincang"></span>
								</div>
							</div>
						</div>
					</li>
				</ul>
			</div>
			<div class="content-state">
				<div>说明:(星号为必填)</div>
				<div>1.方案类型,为您的方案类型,如果您不确定方案类型,可输入其他;建议填写行业名词.</div>
				<div>2.方案名称,标题需填写能够说明方案的内容,字数16字符为佳,限制30个字符</div>
				<div>3.方案描述,这个是能吸引购买方的直观要素,建议能简要介绍您的方案价值所在;简要精简限制字符100字.详情描述可详细描述限制字符1000字.</div>
				<div>4.方案可以保存为草稿,也可以直接提交,提交需要填写完整的方案信息</div>
			</div>
		</div>
		<!--上传文件页面-->
		<div class="uploads">
			<div class="upload_files_p">
				<div class="upload_files">
				<ul>
					<li>
						<div class="upload_name"><i class="xinxin"></i>方案图片:</div>
						<div class="upload_content">
							<div class="up_picture" data-imgs="{}">上传图片</div><span>每张图片不超过3M,最多可上传<i style="color: #e84343;">5</i>张图片,<img src="" alt="" class="up_success"></span>
							<div><!--专业墙板--></div>
							<div class="more_picture"></div>
							<div id="imgs" class="up_picture add_imgs_div">
								<img src="__PUBLIC__/Home/Solution/img/add.jpg" style="width:110px;height:110px;" alt="">
							</div>
						</div>
					</li>
					<li>
						<div class="upload_name"><i class="xinxin"></i>PCBA文件:</div>
						<div class="upload_content">
							<div id="up_pcba"  data-pcba_file="">上传文件</div><span><img src="" alt="" class="up_success"></span>
							<div id="pcba_file" class="upload_content_div">
								<span>支持doc、xls、img、zip等格式文件,文件小于4M</span>
							</div>
						</div>
					</li>
					<li>
						<div class="upload_name"><i class="xinxin"></i>代码包:</div>
						<div class="upload_content">
							<div id="up_code" data-code="">上传文件</div><span><img src="" alt="" class="up_success"></span>
							<div id="code" class="upload_content_div" >
								<span>支持doc、xls、img、zip等格式文件,文件小于4M</span>
							</div>
						</div>
					</li>
					<li>
						<div class="upload_name"><i class="xinxin"></i>其他文档:</div>
						<div class="upload_content">
							<div id="up_files" data-files="">上传文件</div><span><img src="" alt="" class="up_success"></span>
							<div id="files" class="upload_content_div">
								<span>支持doc、xls、txt、图片等格式文件,文件小于4M</span>
							</div>
						</div>
					</li>
					<li>
						<div class="upload_name"><i class="xinxin"></i>bom表:</div>
						<div class="upload_content">
							<div id="up_bom" data-bom="">上传文件</div>
							<div class="red_cell jl-download-excel" style="display: inline-block;margin-top: 0px;vertical-align: top;">下载格式</div>
							<span ><img src="" alt="" class="up_success"></span>
							<div id="bom" class="upload_content_div">
								<span>支持doc、xls、img、zip等格式文件,文件小于4M</span>
							</div>
						</div>
					</li>
				</ul>
			</div>
			</div>
			<div class="content-state">
				<div>说明:(星号为必填)</div>
				<div>1.方案图片,为您的方案设计的展示,图片说明方案意图,需清晰明了。</div>
				<div>2.上传其他文档,文档包括使用手册,方案规格、测试结果等。</div>
				<div>3.逐步上传 方案PCBA设计,代码包.其他文件三种文件资料。</div>
				<div>4.发布上传方案,需要基本资料和文件资料齐全。如果资料不齐全,可以先保存,稍后在"我的供应方案"中补充完整</div>
				<div>5.发布中的方案,可以在"我的供应方案"中手动下架.</div>
			</div>
		</div>
		<div class="clear"></div>
		<!--商业条款-->
		<div class="read-accept">
			<span id="accept"><input type="radio" name="read_accept"/>阅读并接受</span>
			<span id="business-rule" data-method="business_rule">《商业资源交易规则》</span></a>
		</div>
		<!--接受保存-->
		<div class="read-accept save-commit">
			<div class="save_desir">保存</div>
			<div class="next_step ">下一步</div>
			<div class="pre_step ">上一步</div>
			<div class="commit_pro">提交</div>
		</div>
	</div>
</block>

<block name="js">
	<script>
        require(['__PUBLIC__/Home/Public/js/require-config.js','layer-all'], function () {
            require(['jquery', 'jl-modal', 'pikaday', 'jl-tool', 'webuploader','layer'], function ($, modal, pikaday, jlTool, WebUploader) {
                var jlTool = layui.jlTool;
                //对象的名字,和data里的键名一样,但不是同一个东西
                var had_checked= false;
                var data = {};
                var types= $('#types');/*方案类型*/
					data.types = types.val();
                var synopsis = $('#synopsis');//简要描述
				var pro_desc = $('#pro_desc');//详细描述
				var pro_name = $('#pro_name');//方案名字
					pro_name.maxlength = 30;
				var main_model=$('#main_model');//主控型号
                	main_model.maxLength=30;
				var main_brand=$('#main_brand');//主控品牌
                	main_model.maxLength=30;
				var pcba      =$("input[name='pcba']:checked");/*注意,pcba指基础数据中的是否提供pcba,pcbas是上传了pcba文件*/
					data.pcba =pcba.val();/*初始值*/
				var pcba_list =$("input[name='pcba_list']");/*pcba_list是指pcba的具体型号*/
//					data.pcba_list=pcba_list.val();

                var pre_step = $('.pre_step');
                var commit_pro  = $('.commit_pro');
                var next_step   = $('.next_step');
                var content_main= $('.content-main');
                var uploads     = $('.uploads');

                //会员
                $.get('/Home/SolutionVip/check_vip2',{},function(res){
                    if(res.status !== 1000){
                        modal.confirm({
                            title: '您目前还不是会员,不能发布方案',
                            isCenter:true,
                            confirmText: "点击前往升级",
                            cancelBtn:true,
                            cancelText:'取消',
                            confirm:function(){
                                window.location.href = "/Home/SolutionVip/vipIndex";
                                return;
                            }
                        });
                    }
                })

				/*基础检查数据*/
                function base_check(data){
                    if(data.types == ""||data.types==null) {
                        return false;
                    };
                    if(!data.pro_name) {
                        content_check(pro_name,'方案名称');
                        return false;
                    };
                    if(!data.main_model) {
                        content_check(main_model,'主控型号');
                        return false;
                    }
                    if(!data.main_brand) {
                        content_check(main_brand,'主控品牌');
                        return false;
                    };
                    if(!data.synopsis) {
                        synopsis.parent().next().children("#desc_empty_check").removeClass('yincang');
                        synopsis.parent().next().children("#desc_empty_check").html('<i class="waring_picture"></i>'+'方案简述不能为空');
                        return false;
                    };
                    if(!data.pro_desc) {
                        pro_desc.parent().next().children("#desc_empty_check2").removeClass('yincang');
                        pro_desc.parent().next().children("#desc_empty_check2").html('<i class="waring_picture"></i>'+'方案详细描述不能为空');
                        return false;
                    };
                    if(!data.pcba_list ){
                        content_check(pcba_list,'pcba型号');
                        return false;
                    }
                    return true;
                }
                /*完全数据检查*/
                function data_checked(data){
					var base_data = base_check(data);
					if(base_data===false){
					    return false ;
					}
					if(!data.imgs ){
					    return false;
					}
                    if(!data.code ){
                        return false;
                    }
                    if(!data.files ){
                        return false;
                    }
                    if(!data.bom ){
                        return false;
                    }
                    had_checked=true;
                    return true;

				}
				/*检查内容是否为空*//*$txt为空时的提示内容,key是保存表单值得键名*/
                function content_check($object,$txt,key){
                        var object_val = $object.val();
                        var object_tips= $object.next();
                        if(object_val==''){
                            object_tips.removeClass('yincang');
                            if($txt==''){
                                object_tips.html("<i class='waring_picture'></i>"+"内容不能为空");
                            }else{
                                object_tips.html("<i class='waring_picture'></i>"+$txt+"不能为空");
                            }
                        }else{
                            var key1 =key;
                            object_tips.addClass('yincang');
                            return data[key]=object_val;
                        }
                }
                /*获取方案类型*/
                types.on('change',function(){
                    data.types = $(this).val();
//                    console.log(data);
				});

                /*获取pcba值*/
				var form = layui.form;
				form.on('radio(test)',function(obj){
//				    console.log(data);console.log(data.elem); console.log(data.value);
				    data.pcba = obj.value;
				});

                /*主控型号验证*/
                main_model.on('blur',function(){content_check(main_model,'主控型号','main_model')});
                /*主控品牌*/
                main_brand.on('blur',function(){content_check(main_brand,'主控品牌','main_brand')});
                /*方案名称验证*/
                pro_name.on('blur',function(){content_check(pro_name,'方案名称','pro_name')});
                /*pcba_list验证*/
                pcba_list.on('blur',function(){
						var p_val = pcba_list.val();
						var p_tips= pcba_list.next();
//
						if(!p_val){
//
							p_tips.removeClass('yincang');
							p_tips.html('<i class="waring_picture"></i>'+'pcba型号不能为空');
//
						}else{
                            p_tips.addClass('yincang');
                            data['pcba_list']=p_val;/*保存pcba_List数据*/
						}
				});

                /*阅读条款*/
                $('#business-rule').on('click',function(){
//                    $('.read_desir').show();
                    var _this = $(this)
					var _descri;
                    $.ajax({
                        type:'GET',
                        url:"/Home/Solution/business_protocol",
						dataType:'html',
                        success:function(re){
                            _descri = re;
//							$('.business_rule').html(re);
						var othis = _this, method = othis.data('method');
						active[method] ? active[method](_descri) : '';
                        }
                    });
                });
                /*弹层*/
                var active = {
                    business_rule: function( text){
                        var descri = text;
                        layer.open({
                            type: 1
                            ,title:false// "方案描述"
                            ,closeBtn: false
                            ,area:['40%','800px']
                            ,shade:0.3
                            ,shadeClose:true
                            ,id: 'LAY_layuipro'
//                     	,btn:'关闭'
                            ,btnAlign: 'r'
                            ,moveType: 1
                            ,content: "<div style='text-indent: 25px;box-sizing: border-box;width:100%;height:100%;line-height:25px;padding:10px;text-indent:25px;letter-spacing: 2px;word-break: break-all;word-wrap: break-word;color:#222'>"+text+"</div>"
                            ,success: function(layero){

                            }
                        });
                    }
                };

                /*接受阅读条款*/
                $('#accept').on('click',function(){
                    var temp = data_checked(data);
                    if(temp===false){
                        modal.alert({
                            title:'请填写完整数据!'
                        });
                        $(this).find('input').attr("disabled","disabled");
                    }else{
                        $(this).find('input').attr("disabled","");
                    }
                    var re=$(this).find('input');
                    var shuxin = re.attr('checked');/*shuxin,被选中的移速*/

                    if( shuxin == 'checked'||had_checked===false){
                        re.removeAttr('checked');
                        $('.commit_pro').removeClass('green-white').addClass('gray-black');
                    }else{
                        re.attr('checked','checked');
                        $('.commit_pro').removeClass('gray-black').addClass('green-white');
                    }
                });

                /*关闭阅读条款*/
//                $('.read_close').on('click',function(){
//                    $('.read_desir').hide();
//                })

				/*下一步*/
				$('.next_step').on('click',function(){
                    $('#jl-cart-progress').children('li').eq(1).addClass('jl-cur');
					content_main.hide();
                    uploads.show();
//					upload_files.animate({width:'80%'},100);
					pre_step.show();
					commit_pro.show();
					next_step.hide();

                    uploader.refresh();//防止点击无效的情况
                    uploader1.refresh();
                    uploader2.refresh();
                    uploader3.refresh();
                    uploader4.refresh();
				});

				/*上一步*/
				$('.pre_step').on('click',function(){
                    content_main.show();
                    uploads.hide();
//                    uploads.attr('Alpha',0);
                    pre_step.hide();
                    commit_pro.hide();
                    next_step.show();
                    $('#jl-cart-progress').children('li').eq(1).removeClass('jl-cur');
				});

                /*方案简述*/ /*限制字数*/
                synopsis.attr('maxlength',200);
                $("#enter_content").text(200);

                synopsis.on('blur',function(){
                    var syn_val = synopsis.val();
                    var syn_tips= synopsis.parent().next().children("#desc_empty_check");
                    if(syn_val==''){
                        syn_tips.removeClass('yincang');
                        syn_tips.html('<i class="waring_picture"></i>'+'方案简述不能为空');
                    }else{
                        syn_tips.addClass('yincang');
                        return data.synopsis= syn_val;
                    }
                });
                synopsis.keyup(function(){
                    var syn_val = synopsis.val();
                    if(syn_val.length > 200){
                        $(this).val(syn_val.substring(0,200));
                    }
                    $("#enter_content").text( 200 - syn_val.length );
                });

                /*方案详细*/ /*限制字数*/
                pro_desc.attr('maxlength',2000);
                $("#enter_content2").text(2000);

                pro_desc.on('blur',function(){
                    var pro_val = pro_desc.val();
                    var pro_tips= pro_desc.parent().next().children("#desc_empty_check2");
                    if(pro_val==''){
                        pro_tips.removeClass('yincang');
                        pro_tips.html('<i class="waring_picture"></i>'+'方案详细描述不能为空');
                    }else{
                        pro_tips.addClass('yincang');
                        return data.pro_desc= pro_val;
                    }
                });
                pro_desc.keyup(function(){
                    var desc_val = pro_desc.val();
                    if(desc_val.length > 2000){
                        $(this).val(desc_val.substring(0,2000));
                    }
                    $("#enter_content2").text( 2000 - desc_val.length );
                });

                /*保存*/
                $('.save_desir').on('click',function(){
                    var rez = base_check(data);
                    data.draft =1;/*草稿标识符*/
                    if(rez ===false){
                        modal.alert({ title: '基础数据不完整,请补充完整'});
                        return;
                    }else{
						$.ajax({
							type: 'POST',
							url: "/Home/Solution/myProviderUpload",
							data: data,
							success: function (res) {
								if(res.status==1000){
//									console.log(res);
									data.pro_id=res.data
									modal.alert({
										title: '保存成功',
									});
								}else{
									modal.alert({
										title:res.content,
									});
								}
							},
							error: function (res) {
								if (res.status == 1027) {
									modal.alert({
										title: res.content,
									});
								}
								modal.alert({
									title: '提交错误',
								});
							}
						});
					}
				});
                /*提交*/
                $('.commit_pro').on('click',function(){
					var re  = $('#accept').find('input');
					var if_checked = re.attr('checked');
					if(if_checked !='checked'){/*检查是否同意协议*/
                        modal.alert({
                            title:'请先阅读并接受商业资源交易规则'
                        });
						return
					}
					var rez = data_checked(data);/*数据检查*/
					if( rez === false){
						modal.alert({
							title:'提交审核需要完整的资料,请补全基础信息和相关文件'
						});
						data.draft  = 0;
						return;
					}
					modal.alert({
						title:'方案提交后将不能修改,您确定提交吗?',
						confirm:function(){
							$.ajax({
								type: 'POST',
								url: "/Home/Solution/myProviderUpload",
								data: data,
								success: function (res) {
									if(res.status==1000){
									    data.pro_id = res.data//保存id防止重复提交
                                        var content2 = $('.read-accept');
                                        $('#jl-cart-progress').children('li').eq(2).addClass('jl-cur');
                                        var tj  =$('.tj_success');/*tj---添加*/
                                        uploads.remove();
                                        content_main.remove();
                                        content2.remove();
                                        tj.show();
										/*.bak*/
										/*modal.confirm({
											title: '恭喜您!提交成功',
                                            isCenter:true,
											confirmText: "点击前往查看!",
                                            cancelBtn:true,
											cancelText:'再发一条',
											confirm:function(){
												window.location.href = "/Home/Solution/myProvider";
												return;
											},
											cancel:function(){
												window.location.reload();
											},
                                            close:function () {
                                                window.location.reload();
											}
										});*/
									}else if(res.status==1023){
                                        modal.confirm({
                                            confirmText: "点击前往升级",
                                            title: res.content,
                                            isCenter:true,
                                            top: 100,
                                            confirm: function(){
                                                window.location.href = "/Home/SolutionVip/vipIndex";
                                            }
                                        });
									}else{
                                        modal.alert({
                                            title:res.content,
                                        });
									}
								},
								error: function (res) {
									if (res.status == 1027) {
										modal.alert({
											title: res.content,
										});
									}
									modal.alert({
										title: '提交错误',
									});
								}
							});
						}
					});
				});
                /*提交成功后跳转*/
                $('.browse-desir').on('click',function(){
                    window.location.href = "/Home/Solution/myProvider";
				});
                $('.return-index').on('click',function(){
                    window.location.href = "/Home/Solution/myProviderUpload";
                });

                /*文件上传*/
                var uploader_success  = function(uploader,file,res){
					if(res.error==1){
					    var msg = res.msg;
                        modal.alert({
                            title: msg
                        });
					}else if(res.error==0){
					    var path = res.msg.file.savepath+res.msg.file.savename;
					    var $container = $(uploader.options.pick);
						$container.parent().children('span').find('img').attr('src','__PUBLIC__/Home/Solution/img/up_success.png');/*添加成功标识*/
						$container.parent().children('.upload_content_div').html("<img src='__PUBLIC__/Home/Solution/img/upload_file.png'>");
						return path;
					}else{
                        modal.alert({
                            title: '上传失败'
                        });
					}
				}
				var uploader_error    = function(uploader){
                    console.log('失败');
                    var $container = $(uploader.options.pick).parent().children('span').find('img');
						$container.attr('src','__PUBLIC__/Home/Solution/img/up_fail.png');
//                    modal.alert({
//                        title: '上传失败'
//                    });
				}
				var uploader_progress = function(uploader){
                    var $container = $(uploader.options.pick);
                    $container.parent().children('span').find('img').attr('src','__PUBLIC__/Home/Solution/img/uploading.gif');/*添加成功标识*/
				}
				/*bom表上传*/
				var uploader4= WebUploader.create({
                    pick: '#up_bom',
                    auto: true,
                    swf: '__PUBLIC__/Common/module/webuploader/0.1.5/Uploader.swf',
                    server: "/Home/Solution/UploadFiles",
                    formData: {
                        path: 'Solution',
                        modname:'bom'
                    },
                    accept: {
                        title: 'bom',
                        extensions: 'jpg,gif,png,jpeg,bmp,doc,docx,pdf,xlsx,xls',
                        mimeTypes: 'image/jpg,image/jpeg,image/png,image/bmp,application/pdf,application/msword,.pdf,.xls,xlsx'
                    },
                    fileSingleSizeLimit: 20 * 1024 * 1024,
                    duplicate: true
				});
                uploader4.on('uploadSuccess', function (file, res){
                    var container = uploader_success(uploader4,file,res);
                    if(container){
                        data.bom =container;
                    }
                });
                uploader4.on('uploadError', function(){
                    uploader_error();
                });
                uploader4.on('uploadProgress',function(file,percentage){
                    uploader_progress(uploader4);
				});
                /*其他文件*/
                var uploader3= WebUploader.create({
                    pick: '#up_files',
                    auto: true,
                    swf: '__PUBLIC__/Common/module/webuploader/0.1.5/Uploader.swf',
                    server: "/Home/Solution/UploadFiles",
                    formData: {
                        path: 'Solution',
                        modname:'files'
                    },
                    accept: {
                        title: 'files',
                        extensions: 'jpg,gif,png,jpeg,bmp,doc,docx,pdf,xls,xlsx,txt',
                        mimeTypes: 'image/jpg,image/jpeg,image/png,image/bmp,application/pdf, application/msword,.xls,.xlsx,.pdf,.txt'
                    },
                    fileSingleSizeLimit: 20 * 1024 * 1024,
                    duplicate: true
                });
                uploader3.on('uploadSuccess', function (file, res){
                    var container = uploader_success(uploader3,file,res);
                    if(container){
                        data.files =container;
                    }
                });
                uploader3.on('uploadError', function(){
                    uploader_error();
                });
                uploader3.on('uploadProgress',function(file,percentage){
                    uploader_progress(uploader3);
                });
				/*代码包上传*/
				var uploader2= WebUploader.create({
                    pick: '#up_code',
                    auto: true,
                    swf: '__PUBLIC__/Common/module/webuploader/0.1.5/Uploader.swf',
                    server: "/Home/Solution/UploadFiles",
                    formData: {
                        path: 'Solution',
                        modname:'code'
                    },
                    accept: {
                        title: 'code',
                        extensions: 'zip,rar',
                        mimeTypes: '.zip,.rar'
                    },
                    fileSingleSizeLimit: 20 * 1024 * 1024,
                    duplicate: true
				});
                uploader2.on('uploadSuccess', function (file, res){
                    var container = uploader_success(uploader2,file,res);
                    if(container){
                        data.code =container;
                    }
                });
                uploader2.on('uploadError', function(){
                    uploader_error();
                });
                uploader2.on('uploadProgress',function(file,percentage){
                    uploader_progress(uploader2);
                });
				/*pcba文件上传*/
				var uploader1= WebUploader.create({
                    pick: '#up_pcba',
                    auto: true,
                    swf: '__PUBLIC__/Common/module/webuploader/0.1.5/Uploader.swf',
                    server: "/Home/Solution/UploadFiles",
                    formData: {
                        path: 'Solution',
                        modname:'pcba'
                    },
                    accept: {
                        title: 'codefile',
                        extensions: 'zip,rar',
                        mimeTypes: '.zip,.rar'
                    },
//					fileVal:'code2',
//					method:'POST',
//					chunked:true,
//					chunkSize:5*1024*1024,
                    fileSingleSizeLimit: 20 * 1024 * 1024,
                    duplicate: true
				});
				uploader1.on('uploadSuccess', function (file, res){
				    var container = uploader_success(uploader1,file,res);
				    if(container){
                        data.pcbas =container;
					}
				});
                uploader1.on('uploadError', function(){
                    uploader_error();
				});
                uploader1.on('uploadProgress',function(file,percentage){
                    uploader_progress(uploader1);
                });
				//相册上传
                var uploader = WebUploader.create({
                    pick: '.up_picture',
                    auto: true,
                    swf: '__PUBLIC__/Common/module/webuploader/0.1.5/Uploader.swf',
                    server: "/Home/Solution/UploadFiles",
                    formData: {
                        path: 'Solution',
                        modname:'imgs'
                    },
                    accept: {
                        title: 'Images',
                        extensions: 'gif,jpg,jpeg,bmp,png',
                        mimeTypes: 'image/jpg,image/jpeg,image/png,image/bmp'
                    },
                    thumb:{
						width: 110,
						height: 110,
						quality: 70,
						allowMagnify:false,/*是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.*/
						crop: true,/*是否允许裁剪。*/
						type: 'image/jpeg'/*为空的话则保留原有图片格式。否则强制转换成指定的类型。*/
					},
                    threads:3,/*并发量*/
                    fileNumLimit:5,/*数量*/
                    fileSingleSizeLimit: 5 * 1024 * 1024,/*每张大小*/
                    duplicate: true
                });
                var allImgs = new Array();
                uploader.on('uploadSuccess', function (file, res){
                   var container = uploader_success(uploader,file, res);
                   if(container){
                       allImgs.push(container);
                       data.imgs = allImgs;
                   }
                });
                uploader.on('uploadError', function(){
                    uploader_error();
				});
                uploader.on('uploadProgress',function(file,percentage){
                    uploader_progress(uploader);
                });

                 /*当有文件添加进来的时候*/
				uploader.on('fileQueued', function (file) {
					var $li = $(
						'<div id="' + file.id + '" class="up_imgs_sister">' +
						'<img>' +
						'<div class="less_picture"></div></div>'
						),
						$img = $li.find('img');
					$('.more_picture').append($li);
					////			 /*$list为容器jQuery实例*/
					uploader.makeThumb(file, function (error, src) {
						if (error) {
							//$img.replaceWith('<span>不能预览</span>');
							console.log('缩略图失败');
							return;
						}
						$img.attr('src', src);
					});
				});
                /*文件上传过程中创建进度条实时显示。*/
//                    uploader.on('uploadProgress', function (file, percentage) {
//                        var $li = $('#' + file.id),
//                            $percent = $li.find('.progress span');
//                        if (!$percent.length) {
//                            $percent = $('<div class="progress progress-striped active">' +
//                                '<div class="progress-bar" role="progressbar" style="width: 0%">' +
//                                '</div>' +
//                                '</div>').appendTo($li).find('.progress-bar');
//                        }
//                        $percent.css('width', percentage * 100 + '%');
//                    });
//				console.log(data);

				//下载bom表
                $(".jl-download-excel").on("click",function(){
                    var a = document.createElement("a");
                    a.href = "/Uploads/bomsample.xlsx";
                    a.download ="智能分析BOM表标准模板.xlsx";
                    a.click();
                    // window.location.href="{:U('Home/Default/bomPrice?action=match')}";
                });
            });
        })
	</script>
</block>