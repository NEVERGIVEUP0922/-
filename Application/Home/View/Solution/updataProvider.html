<!-- 前台搜索模板文件  -->
<!-- 方案中心的命名:(旧)planCenter,(新)solution,简写sol -->

<extend name="Layout:layout-updata" />

<block name="title">方案中心</block>
<block name="keywords">这里是关键字</block>
<block name="description">这里是描述</block>
<block name="css">
	<link rel="stylesheet" href="__PUBLIC__/Home/Public/css/search-nav.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/Index/css/release.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/Solution/css/project_upload.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/Solution/css/public.css">
	<link rel="stylesheet" href="__PUBLIC__/Common/module/layui/2.2.4/css/layui.css" rel="stylesheet"  media="all">
	<!--sol的前缀是solution(方案)的缩写-->
	<style>
		.content-list label{
			height:35px;
			line-height: 35px;
		}
		/*layi_add不可放入css文件*/
		.layui-form-label{
			padding:0px;
			margin:0px 76px 0px 45px;
		}
		.layui-input{
			width:345px!important;
		}
		.layui-form-item{
			height:35px;
		}
		.layui-form-select dl dd.layui-this{
			background-color:#e84343;
		}
		.layui-form-select dl{
			top:35px;
		}
		.edit_click{
			display: inline-block;
			width:60px;
			height:25px;
			line-height: 25px;
			background:#e84343;
			margin:0 0 10px 20px;
			color:#fff;
			text-align: center;
			border-radius: 2px;
			cursor:pointer;
		}
		#jl-center-main{
			margin-top:0px;
		}
		#jl-project{
			margin-top:0px;
		}
		textarea{
			resize:none;
		}
		.upload_content>#imgs{/*相册补充*/
			margin-top:10px;
		}
		/*富文本css*/
		#describe-container{
			width:100%;
		}
		.jl-form-agree{
			visibility: hidden;
		}
	</style>
</block>
<block name="nav-title">
	项目管理中心
</block>
<block name="main">
	<!-- 主要内容 -->
	<!--面包屑导航系统-->
	<div id='jl-brand'>
	<ul class='jl-brand-url'>
		<li>您的位置 <span> ></span></li>
		<li><a href="javascript:;">首页</a><span>></span></li>
		<li><a href="javascript:;">方案中心</a> <span>></span></li>
		<li><a href="javascript:;">项目管理中心</a><span>></span></li>
		<li><a href="javascript:;">修改供应方案</a> <span> ></span></li>
	</ul></div>
	<!--页面布局主区域-->
	<div id="jl-project">
		<!--进度条-->
		<div>
			<ul id="jl-cart-progress" class="jl-cle">
				<li class="jl-cur">
					<p>
						<span class="jl-serial">1</span>
						填写方案基本信息
					</p>
					<i class="jl-arr"></i>
				</li>
				<li>
					<i class="jl-arr-white"></i>
					<p>
						<span class="jl-serial">2</span>
						上传相关文件
					</p>
					<i class="jl-arr"></i>
				</li>
				<li class="jl-progress-last">
					<i class="jl-arr-white"></i>
					<p>
						<span class="jl-serial">3</span>
						提交成功,后台审核中
					</p>
				</li>
			</ul>
		</div>
		<!--提交成功-->
		<div class="tj_success">
			<div class="tj1"><img src="__PUBLIC__/Home/Solution/img/tj_success.png" alt=""></div>
			<div class="tj2">您已成功提交方案!</div>
			<div class="tj3">点击下方按钮,关闭窗口</div>
			<div class="tj4">
			</div>
		</div>
		<!--基本信息-->
		<div class="content-main">
			<div class="content-list">
				<ul>
					<li style="height:35px;overflow: visible;" >
						<form class="layui-form" lay-filter="sol_types" action="">
							<div class="layui-form-item" >
								<span class="empty_check yincang types-span"></span>
								<label class="layui-form-label black_word" ><i class="xinxin"></i>项目类型:</label>
								<div class="layui-inline layui-input-inline" lay-filter="" >
									<select name="sol_types" id="sol-types-id" class="sol-types" lay-filter="sol_types" style="border:1px solid #777;width:380px;" lay-search="">
										<option value="">请选择方案类型</option>
										<foreach name="sol_types" item="vo">
											<if condition="$res['types'] eq $vo['id']">
												<option value="{$vo.id}" selected>{$vo.types}</option>
												<else />
												<option value="{$vo.id}">{$vo.types}</option>
											</if>
										</foreach>
									</select>
								</div>
							</div>
						</form>
					</li>
					<div></div>
					<li>
						<div class="List-name">
							<i class="xinxin"></i><label for="pro_name">方案名:</label>
						</div>
						<div class="List-content">
							<input type="text" name="desir_name" value="{$res.pro_name}" id="pro_name" class="form-control" placeholder="请填写方案名" maxlength = "30">
							<span class="empty_check yincang"></span>
						</div>
					</li>
					<li>
						<div class="List-name">
							<i class="xinxin"></i><label for="main_model">主控型号:</label>
						</div>
						<div class="List-content">
							<input type="text" name="mobile" value="{$res.main_model}" id="main_model" class="form-control" placeholder="请填写主控型号" maxlength = "30" >
							<span class="empty_check yincang"></span>
						</div>
					</li>
					<li>
						<div class="List-name">
							<i class="xinxin"></i><label for="main_brand">主控品牌:</label>
						</div>
						<div class="List-content">
							<input type="text" name="company" value="{$res.main_brand}" id="main_brand" class="form-control" placeholder="请填写主控的品牌" maxlength = "30">
							<span class="empty_check yincang"></span>
						</div>
					</li>
					<li>
						<div class="List-name">
							<i class="xinxin"></i><label for="synopsis">方案简要描述:</label>
						</div>
						<div class="List-content">
							<textarea name="desir_desc" id="synopsis" class="form-control"rows="3"  placeholder="请填写方案简要描述" style="display: block;padding: 10px;width:718px;">{$res.synopsis}</textarea>
						</div>
						<div class="enter_content float_R">
							<span class="empty_check yincang" id="desc_empty_check"></span>
							还可以输入<span id="enter_content">50<!--还可以输入字--></span>个字!</div>
						<div class="clear"></div>
					</li>
					<li>
						<div class="List-name">
							<i class="xinxin"></i><label for="pro_desc">方案详细描述:</label>
						</div>
						<div class="List-content">
							<textarea name="desir_desc" id="pro_desc" class="form-control" rows="5"  placeholder="请填写方案详细描述" style="display: block;padding: 10px; width:718px;"><notempty name="res.pro_desc">文件保存成功</notempty></textarea>
						</div>
						<div class="enter_content float_R">
							<span class="empty_check yincang" id="desc_empty_check2"></span>
						</div>
						<div class="clear"></div>
					</li>

					<li>
						<div class="List-name">
							<i class="xinxin"></i><label >是否提供PCBA:</label>
						</div>
						<div class="List-content layui-form">
							<div class="layui-form-item">
								<div class="layui-input-block">
									<if condition="$res['pcba'] eq 1">
										<input type="radio" name="pcba" value="1" lay-filter="test" title="是" checked="checked">
										<span style="display:inline-block;width:50px;"></span>
										<input type="radio" name="pcba" value="0" lay-filter="test" title="否" >
										<else />
										<input type="radio" name="pcba" value="1" lay-filter="test" title="是" >
										<span style="display:inline-block;width:50px;"></span>
										<input type="radio" name="pcba" value="0" lay-filter="test" title="否" checked="checked">
									</if>
									<!--<input type="text" name="pcba_list" value="{$res.pcba_list}" placeholder="请输入方案需要的pcba型号">-->
									<!--<span class="empty_check yincang"></span>-->
								</div>
							</div>
						</div>
					</li>
				</ul>
			</div>
			<div class="content-state">
				<div>说明:(星号为必填)</div>
				<div>1.方案类型,为您的方案类型,如果您不确定方案类型,可输入其他;建议填写行业名词.</div>
				<div>2.方案名称,标题需填写能够说明方案的内容,字数16字符为佳,限制30个字符</div>
				<div>3.方案描述,这个是能吸引购买方的直观要素,建议能简要介绍您的方案价值所在;简要精简限制字符100字.详情描述可详细描述限制字符1000字.</div>
				<div>4.方案可以保存为草稿,也可以直接提交,提交需要填写完整的方案信息</div>
			</div>
		</div>
		<!--上传文件页面-->
		<div class="uploads">
			<div class="upload_files_p">
				<div class="upload_files">
					<ul>
						<li style="display: block;width:1000px;">
							<div class="upload_name"><i class="xinxin"></i>方案图片:</div>
							<div class="upload_content" style="width:780px;">
								<empty name="res.imgs">
									<div class="">上传图片</div><span>请上传您的方案图片,最多可上传<i style="color: #e84343;">5</i>张图片<img src="" alt="" class="up_success"></span>
									<div><!--"墙板"--></div>
									<div class="more_picture"></div>
									<else />
									<div class="">上传图片</div><span>请上传您的方案图片,最多可上传<i style="color: #e84343;">5</i>张图片<img src="__PUBLIC__/Home/Solution/img/up_success.png" alt="" class="up_success"></span>
									<div><!--"墙板"--></div>
									<div class="more_picture">
										<foreach name="res.imgs" item="vo" key="k">
											<!--<div class="up_imgs_sister"><img src="/Uploads/{$vo}"><div class="less_picture"></div></div>-->
											<div class="up_imgs_sister"><img src="{$prefix}{$vo}{$suffix}" alt="{$vo}"><div class="less_picture"></div></div>
										</foreach>
									</div>
								</empty>
								<div id="imgs" class="up_picture">
									<img src="__PUBLIC__/Home/Solution/img/add.jpg" style="width:110px;height:110px;" alt="">
								</div>
							</div>
						</li>
						<li>
							<div class="upload_name"><i class="xinxin"></i>PCBA文件:</div>
							<div class="upload_content">
								<div id="up_pcba"  data-pcba_file="">上传文件</div>
								<span>
									<empty name="res.pcbas">
										<img src="" alt="" class="up_success">
									<else />
										<img src="__PUBLIC__/Home/Solution/img/up_success.png" class="up_success">
									</empty>
								</span>
								<div id="pcba_file" class="upload_content_div">
									<empty name="res.pcbas"><img src="" alt="" class="up_success">
										<span>仅支持zip、rar格式文件,文件小于20M</span>
										<else />
										<img src='__PUBLIC__/Home/Solution/img/upload_file.png'>
									</empty>
								</div>
							</div>
						</li>
						<li>
							<div class="upload_name"><i></i>代码包:</div>
							<div class="upload_content">
								<div id="up_code" data-code="">上传文件</div>
								<span>
									<empty name="res.code">
										<img src="" alt="" class="up_success">
									<else />
										<img src="__PUBLIC__/Home/Solution/img/up_success.png" class="up_success">
									</empty>
								</span>
								<div id="code" class="upload_content_div" >
									<empty name="res.code"><img src="" alt="" class="up_success">
										<span>仅支持zip、rar格式文件,文件小于20M</span>
										<else />
										<img src='__PUBLIC__/Home/Solution/img/upload_file.png'>
									</empty>
								</div>
							</div>
						</li>
						<li>
							<div class="upload_name"><i class="xinxin"></i>bom表:</div>
							<div class="upload_content">
								<div id="up_bom" data-bom="">上传文件</div>
								<div class="red_cell jl-download-excel" style="display: inline-block;margin-top: 0px;vertical-align: top;">下载格式</div>
								<span >
									<empty name="res.bom">
										<img src="" alt="" class="up_success">
									<else />
										<img src="__PUBLIC__/Home/Solution/img/up_success.png" class="up_success">
									</empty>
								</span>
								<div id="bom" class="upload_content_div">
									<empty name="res.bom"><img src="" alt="" class="up_success">
										<span>仅支持doc、xls格式文件,文件小于20M</span>
										<else />
										<img src='__PUBLIC__/Home/Solution/img/upload_file.png'>
									</empty>
								</div>
							</div>
						</li>
						<li>
							<div class="upload_name"><i></i>其他文档:</div>
							<div class="upload_content">
								<div id="up_files" data-files="">上传文件</div>
								<span>
									<empty name="res.files">
										<img src="" alt="" class="up_success">
									<else />
										<img src="__PUBLIC__/Home/Solution/img/up_success.png" class="up_success">
									</empty>
								</span>
								<div id="files" class="upload_content_div">
									<empty name="res.files"><img src="" alt="" class="up_success">
										<span>仅支持doc、xls、txt、图片等格式文件,文件小于20M</span>
										<else />
										<img src='__PUBLIC__/Home/Solution/img/upload_file.png'>
									</empty>
								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>
			<div class="content-state">
				<div>说明:(<i class="xinxin"></i>号为必填)</div>
				<div>1.方案图片,为您的方案设计的展示,图片说明方案意图,需清晰明了。</div>
				<div>2.上传其他文档,文档包括使用手册,方案规格、测试结果等。</div>
				<div>3.逐步上传 方案PCBA设计,代码包.其他文件三种文件资料。</div>
				<div>4.发布上传方案,需要基本资料和必要的文件齐全。如果资料不齐全,可以先保存,稍后在"我的供应方案"中补充完整</div>
				<div>5.发布中的方案,可以在 <span style="color:#e84343;">"我的供应方案"</span>中手动下架.</div>
			</div>
		</div>
		<div class="clear"></div>
		<!--商业条款-->
		<div class="read-accept">
			<div class="jl-form-agree">
				<span href="#" class="jl-check" id="jl-checkbox"></span>
				<span>阅读并同意</span><a href="javascript:;" data-method="business_rule">《商业资源交易规则》</a>
			</div>
		</div>
		<!--接受保存-->
		<div class="read-accept save-commit">
			<div class="save_desir">保存</div>
			<div class="next_step ">下一步</div>
			<div class="pre_step ">上一步</div>
			<div class="commit_pro">提交</div>
		</div>
	</div>

</block>

<block name="js">
	<script src="__PUBLIC__/Common/module/ueditor2/ueditor.config.js"></script>
	<script src="__PUBLIC__/Common/module/ueditor2/ueditor.all.min.js"></script>
	<script>
        require(['__PUBLIC__/Home/Public/js/require-config.js','layer-all'], function () {
            require(['jquery', 'jl-modal', 'pikaday', 'jl-tool', 'webuploader'], function ($, modal, pikaday, jlTool, WebUploader){
                var layer = layui.layer;
                //对象的名字,和data里的键名一样,但不是同一个东西
                var had_checked= false;
                var data = {};
                var $resInfo = {$res|json_encode};
                /*heihei*/
                data.types =$resInfo.types;
                data.pro_id=$resInfo.id;
                data.pcbas= $resInfo.pcbas;
                data.code = $resInfo.code;
                data.files= $resInfo.files;
                data.bom  = $resInfo.bom;
                data.imgs = $resInfo.imgs;
                data.pro_name= $resInfo.pro_name;

                data.pro_desc= $resInfo.pro_desc;
				data.html_path=$resInfo.pro_desc;
                data.html_modifier_sign = 0;/*html修改标志符号*/

                data.synopsis= $resInfo.synopsis;
                data.pcba_list=$resInfo.pcba_list;
                data.main_model=$resInfo.main_model;
                data.main_brand=$resInfo.main_brand;
                var synopsis = $('#synopsis');//简要描述
                var pro_desc = $('#pro_desc');//详细描述
                var pro_name = $('#pro_name');//方案名字
//                pro_name.maxlength = "30";
                var main_model=$('#main_model');//主控型号
//                main_model.maxLength=30;
                var main_brand=$('#main_brand');//主控品牌
//                main_model.maxLength=30;
                var pcba      =$("input[name='pcba']:checked");/*注意,pcba指基础数据中的是否提供pcba,pcbas是上传了pcba文件*/
                data.pcba =pcba.val();/*初始值*/
                var form= layui.form;/*方案类型*/
                var types_span = $('.types-span');

                var pre_step = $('.pre_step');
                var commit_pro  = $('.commit_pro');
                var next_step   = $('.next_step');
                var content_main= $('.content-main');
                var uploads     = $('.uploads');
                var jl_form_agree = $('.jl-form-agree');

                //会员
//                $.get('/Home/SolutionVip/check_vip2',{},function(res){
//                    if(res.status==999) {
//                        window.location.href = '/Home/Account/login';
//                        return;
//                    }
//                    if(res.status !== 1000){
//                        modal.confirm({
//                            title: '您目前还不是会员,不能发布方案',
//                            isCenter:true,
//                            confirmText: "点击前往升级",
//                            cancelBtn:true,
//                            cancelText:'取消',
//                            confirm:function(){
//                                window.location.href = "/Home/SolutionVip/vipIndex";
//                                return;
//                            }
//                        });
//                    }
//                })

                /*基础检查数据*/
                function base_check(data){
                    if(data.types == ""||data.types==null) {
                        $('.types-span').html('<i class="waring_picture"></i>'+'方案类型不能为空');
                        return false;
                    };
                    if(!data.pro_name) {
                        content_check(pro_name,'方案名称');
                        return false;
                    };
                    if(!data.main_model) {
                        content_check(main_model,'主控型号');
                        return false;
                    }
                    if(!data.main_brand) {
                        content_check(main_brand,'主控品牌');
                        return false;
                    };
                    if(!data.synopsis) {
                        synopsis.parent().next().children("#desc_empty_check").removeClass('yincang');
                        synopsis.parent().next().children("#desc_empty_check").html('<i class="waring_picture"></i>'+'方案简述不能为空');
                        return false;
                    };
                    if(!data.pro_desc) {
                        pro_desc.parent().next().children("#desc_empty_check2").removeClass('yincang');
                        pro_desc.parent().next().children("#desc_empty_check2").html('<i class="waring_picture"></i>'+'方案详细描述不能为空');
                        return false;
                    };
                    if(!data.pcba){
                        waring_alert('pcba选项不能为空!');
                    }
                    return true;
                }
                /*完全数据检查*/
                function data_checked(data){
                    var base_data = base_check(data);
                    if(base_data===false){
                        commit_stop();
                        return false ;
                    }
                    if(!data.imgs ){
                        commit_stop();
                        return false;
                    }
//                    if(!data.code ){
//                        return false;
//                    }
//                    if(!data.files ){
//                        return false;
//                    }
                    if(!data.bom ){
                        commit_stop();
                        return false;
                    }
                    if(!_checkbox.hasClass('jl-check-active')){
                        commit_stop();
                        setTimeout(function(){
                            waring_alert('请先阅读并接受《商业资源交易规则》');
                        },2000)
                        return false;
                    }
                    had_checked=true;
                    commit_permission();
                    return true;

                }
                /*检查内容是否为空*//*$txt为空时的提示内容,key是保存表单值得键名*/
                function content_check($object,$txt,key){
                    var object_val = $object.val();
                    var object_tips= $object.next();
                    if(object_val==''){
                        object_tips.removeClass('yincang');
                        commit_stop();
                        if($txt==''){
                            object_tips.html("<i class='waring_picture'></i>"+"内容不能为空");
                        }else{
                            object_tips.html("<i class='waring_picture'></i>"+$txt+"不能为空");
                        }
                    }else{
                        var key1 =key;
                        object_tips.addClass('yincang');
                    }
                    return data[key]=object_val;
                }
                /*获取方案类型*/
                form.on("select(sol_types)",function(obj){
                    //console.log(obj.value);
                    data.types=obj.value;//小分类
                    if(!data.types||data.types==0){
                        commit_stop();
                        types_span.html('<i class="waring_picture"></i>'+'方案类型不能为空');
                        types_span.css('display','inline-block');
                    }else{
                        types_span.css('display','none');
                    }
                });
                /*获取pcba值*/
                var form = layui.form;
                form.on('radio(test)',function(obj){
//				    console.log(data);console.log(data.elem); console.log(data.value);
                    data.pcba = obj.value;
                });
                /*主控型号验证*/
                main_model.on('blur',function(){content_check(main_model,'主控型号','main_model')});
                /*主控品牌*/
                main_brand.on('blur',function(){content_check(main_brand,'主控品牌','main_brand')});
                /*方案名称验证*/
                pro_name.on('blur',function(){content_check(pro_name,'方案名称','pro_name')});
                /*方案简述*/ /*限制字数*/
                var valDom 	= document.getElementById('synopsis');
                var numDom	= document.getElementById("enter_content");
                var syn_tips= synopsis.parent().next().children("#desc_empty_check");
                $(valDom).on('input',function(){
                    var syn_val = synopsis.val();
                    if(!syn_val){
                        commit_stop();
                        syn_tips.removeClass('yincang');
                        syn_tips.html('<i class="waring_picture"></i>'+'方案简述不能为空');
                    }else{
                        syn_tips.addClass('yincang');
                    }
                    words_deal();
                    return data.synopsis= syn_val;
                });
                //字数限制函数
                var zLen;
                function words_deal(){
                    //最多允许输入n个字，每个英文单词算一个，标点不计算个数
                    zLen = 50;
                    var str = valDom.value//获取文本域的值
                    //判断是否包含中文：if(/^[\u4e00-\u9fa5]/.test("名字"))
                    var regH = /^[\u4e00-\u9fa5]/;
                    var regY = /^[a-zA-Z]/;
                    var regN=/\d/g;//数字
                    var regK=/\s/g;//空格
                    var regZ=/./g;//总长
                    var strlen = str.length;
                    //如果字符串长度大于0
                    if(strlen > 0){
                        //遍历字符串
                        for(var i=0;i<strlen;i++){
                            //获取for循环当前字符
                            var strIndex = str.charAt(i);
                            //判断是否为英文，英文以单词为单位，不是以英文字母
                            if(regY.test(strIndex)){
                                if(i+1<=strlen){
                                    var strNext = str.charAt(i+1);
                                    //如果下一个不是英文
                                    if(!regY.test(strNext)){
                                        zLen--;
                                        //达到字数限制
                                        if(zLen<=0){
                                            limitNum(i,str);
                                            return false;
                                        }
                                    }
                                }else{
                                    //最后一个字符
                                    zLen--;
                                    if(zLen<=0){
                                        limitNum(i,str);
                                        return false;
                                    }
                                }
                            }else{
                                //var kflag = regK.test(strIndex);
                                //汉子
                                var hflag = regH.test(strIndex);
                                //数字
                                var nflag = regN.test(strIndex);
                                if(hflag || nflag){
                                    zLen--;
                                    if(zLen<=0){
                                        limitNum(i,str);
                                        return false;
                                    }
                                }
                            }
                        }
                        numDom.innerText=zLen;
                    } else{
                        numDom.innerText='50';
                    }
                }
                function limitNum(i,str){
                    //此处不能截取 0，19.因为存在英文单词或者标点
                    var newStr = str.substr(0, i+1);
                    valDom.value = newStr;
                    numDom.innerText=0;
                }
                /*方案详细*/
                pro_desc.on('focus',function(){
                    goDescribe(pro_desc,false);
                });
                /*阅读条款*/
                $('#business-rule').on('click',function(){
//                    $('.read_desir').show();
                    var _this = $(this)
                    var othis = _this, method = othis.data('method');
                    active[method] ? active[method]() : '';
                });
                /*弹层*/
                var active = {
                    business_rule:function(){
                        var url = "/Public/Home/Solution/business_rule.html";
                        layer.open({
                            type: 2
                            , title: false
                            , closeBtn: 0
                            , area: ["45%", '90%']
                            , scrollbar: false
                            , shade: 0.5
                            , id: 'LAY_layuipro'
                            , btn: ['关闭页面']
                            , content: [url]
                            , end:function(){
                            }
                        });
                    }
                };
                /*接受阅读条款*/
                var _checkbox = $('#jl-checkbox');
                var is_commit = $('.commit_pro');
                $('.jl-form-agree').on('click',function(){
                    var is_accept= _checkbox.hasClass('jl-check-active');
                    if(is_accept){
                        _checkbox.removeClass("jl-check-active");
                    }else{
                        _checkbox.addClass('jl-check-active');
                    }
                    var temp = data_checked(data);
                    if(temp == false ){
                        waring_alert('提交方案需要基础资料和文件齐全,请补充');
                    };
                });
                /*下一步*/
                $('.next_step').on('click',function(){
                    $('#jl-cart-progress').children('li').eq(1).addClass('jl-cur');
                    content_main.hide();
                    jl_form_agree.css('visibility','inherit');
                    uploads.show();
//					upload_files.animate({width:'80%'},100);
                    pre_step.show();
                    commit_pro.show();
                    next_step.hide();

                    uploader.refresh();//防止点击无效的情况
                    uploader1.refresh();
                    uploader2.refresh();
                    uploader3.refresh();
                    uploader4.refresh();
                });
                /*上一步*/
                $('.pre_step').on('click',function(){
                    jl_form_agree.css('visibility','hidden');
                    content_main.show();
                    uploads.hide();
//                    uploads.attr('Alpha',0);
                    pre_step.hide();
                    commit_pro.hide();
                    next_step.show();
                    $('#jl-cart-progress').children('li').eq(1).removeClass('jl-cur');
                });
                //禁止or允许
                function commit_stop(){
                    _checkbox.removeClass("jl-check-active");
                    is_commit.removeClass('green-white').addClass('gray-black');
                }
                function commit_permission(){
                    _checkbox.addClass("jl-check-active");
                    is_commit.removeClass('gray-black').addClass('green-white');
                }
                /*保存*/
                $('.save_desir').on('click',function(){
                    var rez = base_check(data);
                    data.draft =1;/*草稿标识符*/
                    if(rez ===false){
                        waring_alert('基础数据不完整,请补充完整');
                        return;
                    }else{
                        $.ajax({
                            type: 'POST',
                            url: "/Home/Solution/myProviderUpload",
                            data: data,
                            success: function (res) {
                                if(res.status==999) {
                                    window.location.href = '/Home/Account/login';
                                    return;
                                }
                                if(res.status==1000){
//									console.log(res);
                                    data.pro_id=res.data.id;
                                    data.html_path = res.data.html_path;
                                    waring_alert('保存成功');
                                }else{
                                    waring_alert(res.content);
                                }
                            },
                            error: function (res) {
                                if (res.status == 1027) {
                                    waring_alert(res.content);
                                }
                                waring_alert('提交错误')
                            }
                        });
                    }
                });
                /*提交*/
                $('.commit_pro').on('click',function(){
                    var rez = data_checked(data);/*数据检查*/
                    if( rez === false){
                        waring_alert('提交审核需要完整的资料,请补全基础信息和相关文件');
                        return;
                    }else {
                        data.draft  = 0;
                        modal.alert({
                            title: '提示',
                            brief: '方案提交后将不能修改,您确定提交吗?',
                            confirm: function () {
                                $.ajax({
                                    type: 'POST',
                                    url: "/Home/Solution/myProviderUpload",
                                    data: data,
                                    success: function (res) {
                                        if (res.status == 999) {
                                            window.location.href = '/Home/Account/login';
                                            return;
                                        }
                                        if (res.status == 1000) {
//                                        return;
                                            data.pro_id = res.data//保存id防止重复提交
                                            var content2 = $('.read-accept');
                                            $('#jl-cart-progress').children('li').eq(2).addClass('jl-cur');
                                            var tj = $('.tj_success');
                                            /*tj---添加*/
                                            uploads.remove();
                                            content_main.remove();
                                            content2.remove();
                                            tj.show();
                                        } else if (res.status == 1023) {
                                            modal.confirm({
                                                confirmText: "点击前往升级",
                                                title: res.content,
                                                isCenter: true,
                                                top: 100,
                                                confirm: function () {
                                                    window.location.href = "/Home/SolutionVip/vipIndex";
                                                }
                                            });
                                        } else {
                                            waring_alert(res.content);
                                        }
                                    },
                                    error: function (res) {
                                        if (res.status == 1027) {
                                            waring_alert(res.content);
                                        }
                                        waring_alert('提交错误');
                                    }
                                });
                            }
                        });
                    }
                });
                /*提交成功后跳转*/
                $('.browse-desir').on('click',function(){
                    window.location.href = "/Home/Solution/myProvider";
                });
                $('.return-index').on('click',function(){
                    window.location.href = "/Home/Solution/myProviderUpload";
                });
                /*提示*/
                function waring_alert(brief,title){
                    modal.alert({
                        title:title?title:'提示',
                        brief:brief?brief:false,
                    });
                };
                /*文件上传*/
                var uploader_success  = function(uploader,file,res){
                    if(res.error==1){
                        var msg = res.msg;
                        waring_alert(msg);
                    }else if(res.error==0){
                       /* var path = res.msg.file.savepath+res.msg.file.savename;*/
                        var path = res.msg;
                        var $container = $(uploader.options.pick);
                        $container.parent().children('span').find('img').attr('src','__PUBLIC__/Home/Solution/img/up_success.png');/*添加成功标识*/
                        $container.parent().children('.upload_content_div').html("<img src='__PUBLIC__/Home/Solution/img/upload_file.png'>");
                        return path;
                    }else{
                        waring_alert('上传失败');
                    }
                }
                var uploader_error    = function(uploader){
                    console.log('失败');
                    var $container = $(uploader.options.pick).parent().children('span').find('img');
                    $container.attr('src','__PUBLIC__/Home/Solution/img/up_fail.png');
//                    modal.alert({
//                        title: '上传失败'
//                    });
                }
                var uploader_progress = function(uploader){
                    var $container = $(uploader.options.pick);
                    $container.parent().children('span').find('img').attr('src','__PUBLIC__/Home/Solution/img/uploading.gif');/*添加成功标识*/
                }
                /*bom表上传*/
                var uploader4= WebUploader.create({
                    pick: '#up_bom',
                    auto: true,
                    swf: '__PUBLIC__/Common/module/webuploader/0.1.5/Uploader.swf',
                    /*server: "/Home/Solution/UploadFiles",*/
                    server: "/Home/SolutionUpload/webUpload_oss",
                    formData: {
                        path: 'Solution',
                        modname:'bom'
                    },
                    accept: {
                        title: 'bom',
                        extensions: 'jpg,gif,png,jpeg,bmp,doc,docx,pdf,xlsx,xls,txt,pdf,zip,rar',
                        mimeTypes: 'image/*,application/*,txt/plain'
                    },
                    fileSingleSizeLimit: 3 * 1024 * 1024,
                    duplicate: true
                });
                uploader4.on('uploadSuccess', function (file, res){
                    var container = uploader_success(uploader4,file,res);
                    if(container){
                        data.bom =container;
                    }
                });
                uploader4.on('uploadError', function(){
                    uploader_error(uploader4);
                });
                uploader4.on('uploadProgress',function(file,percentage){
                    uploader_progress(uploader4);
                });
                /*其他文件*/
                var uploader3= WebUploader.create({
                    pick: '#up_files',
                    auto: true,
                    swf: '__PUBLIC__/Common/module/webuploader/0.1.5/Uploader.swf',
                    /*server: "/Home/Solution/UploadFiles",*/
                    server: "/Home/SolutionUpload/webUpload_oss",
                    formData: {
                        path: 'Solution',
                        modname:'files'
                    },
                    accept: {
                        title: 'files',
                        extensions: 'jpg,gif,png,jpeg,bmp,doc,docx,pdf,xlsx,xls,txt,pdf,zip,rar',
                        mimeTypes: 'image/*,application/*,txt/plain'
                    },
                    fileSingleSizeLimit: 3 * 1024 * 1024,
                    duplicate: true
                });
                uploader3.on('uploadSuccess', function (file, res){
                    var container = uploader_success(uploader3,file,res);
                    if(container){
                        data.files =container;
                    }
                });
                uploader3.on('uploadError', function(){
                    uploader_error( uploader3);
                });
                uploader3.on('uploadProgress',function(file,percentage){
                    uploader_progress(uploader3);
                });
                /*代码包上传*/
                var uploader2= WebUploader.create({
                    pick: '#up_code',
                    auto: true,
                    swf: '__PUBLIC__/Common/module/webuploader/0.1.5/Uploader.swf',
                    /*server: "/Home/Solution/UploadFiles",*/
                    server: "/Home/SolutionUpload/webUpload_oss",
                    formData: {
                        path: 'Solution',
                        modname:'code'
                    },
                    accept: {
                        title: 'code',
                        extensions: 'jpg,gif,png,jpeg,bmp,doc,docx,pdf,xlsx,xls,txt,pdf,zip,rar',
                        mimeTypes: 'image/*,application/*,txt/plain'
                    },
                    fileSingleSizeLimit: 3 * 1024 * 1024,
                    duplicate: true
                });
                uploader2.on('uploadSuccess', function (file, res){
                    var container = uploader_success(uploader2,file,res);
                    if(container){
                        data.code =container;
                    }
                });
                uploader2.on('uploadError', function(){
                    uploader_error(uploader2);
                });
                uploader2.on('uploadProgress',function(file,percentage){
                    uploader_progress(uploader2);
                });
                /*pcba文件上传*/
                var uploader1= WebUploader.create({
                    pick: '#up_pcba',
                    auto: true,
                    swf: '__PUBLIC__/Common/module/webuploader/0.1.5/Uploader.swf',
                    /*server: "/Home/Solution/UploadFiles",*/
                    server: "/Home/SolutionUpload/webUpload_oss",
                    formData: {
                        path: 'Solution',
                        modname:'pcba'
                    },
                    accept: {
                        title: 'codefile',
                        extensions: 'jpg,gif,png,jpeg,bmp,doc,docx,pdf,xlsx,xls,txt,pdf,zip,rar',
                        mimeTypes: 'image/*,application/*,txt/plain'
                    },
//					fileVal:'code2',
//					method:'POST',
//					chunked:true,
//					chunkSize:5*1024*1024,
                    fileSingleSizeLimit: 3 * 1024 * 1024,
                    duplicate: true
                });
                uploader1.on('uploadSuccess', function (file, res){
                    var container = uploader_success(uploader1,file,res);
                    if(container){
                        data.pcbas =container;
                    }
                });
                uploader1.on('uploadError', function(){
                    uploader_error(uploader1);
                });
                uploader1.on('uploadProgress',function(file,percentage){
                    uploader_progress(uploader1);
                });
                //相册上传
                /*var sol_imgs={$imgs2};*/
                var sol_imgs = $resInfo.imgs;
                var uploader = create_webUploader();
                if(sol_imgs){
                    var sol_imgs_len = sol_imgs.length;/*长度*/
                    if(sol_imgs_len>=5){
                        image_add_rule(false);
                    }else{
                        image_add_rule(true);
					}
                }else{
                    sol_imgs = new Array();
                    var sol_imgs_len = 0 ;
                }
                uploader.on('uploadSuccess', function (file, res){
                    var container = uploader_success(uploader,file, res);
                    if(container){
                        sol_imgs.push(container);
						data.imgs = sol_imgs;
						data.conver_image = sol_imgs[0];
						$('#'+img_alt_id).find('img').attr('alt',container);
                    }
                });
                uploader.on('uploadError', function(){
                    uploader_error();
                });
                uploader.on('uploadProgress',function(file,percentage){
                    uploader_progress(uploader);
                });

                /*当有文件添加进来的时候*/
                var img_alt_id = '';
                uploader.on('fileQueued', function (file) {
                    var $li = $(
                        '<div id="' + file.id + '" class="up_imgs_sister">' +
                        '<img>' +
                        '<div class="less_picture"></div></div>'
                        ),
                        $img = $li.find('img');
                    $('.more_picture').append($li);
                    img_alt_id  = file.id;/*留作删除图片用*/
                    /*生成缩略图*/
                    uploader.makeThumb(file, function (error, src) {
                        if (error) {
                            //$img.replaceWith('<span>不能预览</span>');
                            console.log('缩略图失败');
                            return;
                        }
                        $img.attr('src',src);
                    });
                    sol_imgs_len++;
                    if(sol_imgs_len>=5){
                        image_add_rule(false); return;
                    }else{
                        image_add_rule(true);
                    }
                });
                //删除图片
                $(document).on('click','.up_imgs_sister',function(){
                    var _imgs_sister = $(this);
                    modal.alert({
                        title:'提示',
                        brief:'你确定要删除吗?',
                        confirm:function(){
                            var delete_id = $(_imgs_sister.find('img')[0]).attr('alt');
                            if(delete_id){
                                /*移除数据*/
                                $('.up_imgs_sister').each(function(index,val){
                                    var	_src = $(val).find('img').attr('alt');
                                    if(delete_id == _src ){
                                        data.imgs.splice(index,1);
                                        $(this).remove();
                                        sol_imgs_len--;
                                        if( sol_imgs_len<5){
                                            image_add_rule(true);
                                        }
                                    }
                                });
                            };
                        }
                    });
                });
                //保持图片数量(期待更好的构思)
                function image_add_rule(add_ico){
                    if(add_ico == false){
                        $('#imgs').css('display','none');
					}else{
                    	$('#imgs').css('display','inline-block');
                    	$('#imgs div:last-child').css({'width':'100%','height':'100%'});
					}
                }
                function create_webUploader(){
                    if(uploader){
                        uploader.destroy();
                    }
                    var _uploader =  WebUploader.create({
                        pick: '.up_picture',
                        auto: true,
                        swf: '__PUBLIC__/Common/module/webuploader/0.1.5/Uploader.swf',
                        /*server: "/Home/Solution/UploadFiles",*/
                        server: "/Home/SolutionUpload/webUpload_oss",
                        prepareNextFile:true,
                        formData: {
                            path: 'Solution',
                            modname:'imgs'
                        },
                        accept: {
                            title: 'Images',
                            extensions: 'gif,jpg,jpeg,png',
                            mimeTypes: 'image/jpg,image/jpeg,image/png'
                        },
                        thumb:{
                            width: 150,
                            height: 150,
                            quality: 70,
                            allowMagnify:false,
                            crop: false,/*是否允许裁剪。*/
                            type: 'image/jpeg'/*为空的话则保留原有图片格式。否则强制转换成指定的类型。*/
                        },
                        compress:{
                            // 压缩后的尺寸
                            width: 800,
                            height: 800,
                            // 图片质量，只有type为image/jpeg的时候才有效。
                            quality: 70,
                            // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false
                            allowMagnify: false,
                            // 是否允许裁剪
                            crop: false,
                            // 是否保留头部meta信息
                            preserveHeaders: true,
                            // 如果发现压缩后文件大小比原来还大，则使用原来图片，此属性可能会影响图片自动纠正功能
                            noCompressIfLarger: false,
                            // 单位字节，如果图片大小小于此值，不会采用压缩
                            compressSize: 0
                        },
                        threads:2,/*并发量*/
                        /*fileNumLimit:5,/!*数量*!/*/
                        fileSingleSizeLimit: 2 * 1024 * 1024,/*每张大小*/
                        duplicate: true
                    });
                    return _uploader;
                }
                //下载bom表
                $(".jl-download-excel").on("click",function(){
                    var a = document.createElement("a");
                    a.href = "/Uploads/bomsample.xlsx";
                    a.download ="智能分析BOM表标准模板.xlsx";
                    a.click();
                    // window.location.href="{:U('Home/Default/bomPrice?action=match')}";
                });
                //文本编辑
				var desc_html = {$desc_html|json_encode};
                $('body').append(
                    '\t<div id="contentDiv" style="display:none;">\n' +
                    '\t\t<textarea id="describe-container"  name="content" style="width:100%;">'+desc_html+'</textarea>\n' +
                    '\t</div>');
                var ue;
                function goDescribe(_this,fn){
                    var $this = $(_this);
                    var index = layer.open({
                        title: '方案详细描述',
                        area: ['80%', '80%'],
                        type:1,
                        btn:'确定',
                        shade: false, //不显示遮罩
                        content:$('#contentDiv'),
                        success:function () {
                            $(".layui-layer-shade").css({"z-index":"1000"});
                            $(".layui-layer.layui-layer-dialog").css({"z-index":"1000"});
                            $(".layui-layer-btn").css({"text-align":"right"});
                            var $content = $('.layui-layer-content');
                            var width  = $content.width();
                            var height = $content.height();
                            $('#contentDiv').css('display','block');
                            ue = UE.getEditor('describe-container',{
                                autoHeightEnabled:true,
                                scaleEnabled:false,
                                allowDivTransToP: false,
                                initialFrameWidth:width-22,
                                initialFrameHeight:height-80,
                                topOffset:43
                            });
                        },
                        end:function () {
                            ue.destroy();
                        },
                        yes:function (index, layero) {
                            var html = ue.getContent();
//                            $this.html(html);
                            if(html){
                                $this.val('内容保存成功!');
                            }else{
                                $this.val('内容保存失败!');
                            }
                            $("#contentDiv").css('display','none');
                            data.html_modifier_sign = 1;
                            data.pro_desc = "<style>img{max-width:1140px;}</style>"+html;
                            layer.close(index);
                        },
                    });
                }
            });
        })
	</script>
</block>