{"version":3,"sources":["Home/Product/js/jl-price.js"],"names":["define","$","get_section_price","num","section","isWithSection","correct_price","length","index","parseFloat","price","unit_price","each","i","value","parseInt","start","lft_num","end","right_num","get_correct_price","option","real_pay","should_pay","active_section","isTax","product","price_section","bargain","bargainInfo","tax","discount_num","discount","isBargain","isDiscount","price_pass","price_tax_pass","min_buy","section_price","discount_price_tax","discount_price","fixed_float","digit","times","Math","pow","round","toFixed"],"mappings":"AAAA,aAEAA,OAAO,CAAC,UAAW,SAAUC,GAEzB,IAQIC,EAAoB,SAA2BC,EAAKC,EAASC,GAC7D,IAAIC,EAAgB,EACpB,GAAIF,GAAWA,EAAQG,OAAQ,CAC3B,IAAIC,EAAQJ,EAAQG,OAAS,EAC7BD,EAAgBG,WAAWL,EAAQI,GAAOE,OAASN,EAAQI,GAAOG,YAClEV,EAAEW,KAAKR,EAAS,SAAUS,EAAGC,GACzB,GAAIX,GAAOY,SAAwB,GAAfD,EAAME,MAAa,IAAMF,EAAME,OAASF,EAAMG,UAAYd,EAAMY,SAAsB,GAAbD,EAAMI,IAAW,IAAMJ,EAAMI,KAAOJ,EAAMK,WAGnI,OAFAb,EAAgBG,WAAWK,EAAMJ,OAASI,EAAMH,YAChDH,EAAQK,GACD,IAInB,OAAOR,EAAgB,CAAED,QAASA,EAAQI,GAAQE,MAAOJ,GAAkBA,GAoD/E,MAAO,CACHc,kBAlDoB,SAA2BC,GAC/C,IASIC,EAAUC,EAAYC,EATtBrB,EAAMY,SAASM,EAAOlB,KACtBsB,EAAQJ,EAAOI,MACfC,EAAUL,EAAOK,QACjBtB,EAAUsB,EAAQC,cAClBC,EAAUF,EAAQG,YAClBC,EAAMrB,WAAWiB,EAAQI,KACzBC,EAAetB,WAAWiB,EAAQK,cAClCC,EAAW,EAAIF,EAGfG,GAAY,EACZC,GAAa,EAEjB,IAAKN,IAAYA,EAAQO,aAAeP,EAAQQ,gBAAkBjC,EAAMY,SAASa,EAAQS,SAAU,CAC/F,IAAIC,EAAgBpC,EAAkBC,EAAKC,GAAS,GACpDmB,EAAae,EAAc5B,MAC3Bc,EAAiBc,EAAclC,SAC1BqB,GAA6BM,GAApB5B,EAAMoB,GAChBD,EAAWC,EAAaS,EACxBE,GAAa,GAEbZ,EAAWC,OAKXU,GAAY,EACRR,EAEAF,EADAD,EAAWM,EAAQQ,eAAiBR,EAAQW,mBAAqBX,EAAQY,eAAiBV,EAIlEC,GAApB5B,GADJoB,EAAaK,EAAQO,WAAaP,EAAQY,eAAiBV,EAAMF,EAAQW,qBAErEjB,EAAWM,EAAQO,WAAaP,EAAQY,eAAiBZ,EAAQW,mBAAqBP,EACtFE,GAAa,GAEbZ,EAAWM,EAAQO,WAAaP,EAAQY,eAAiBZ,EAAQW,mBAIjF,MAAO,CACHjB,SAAUb,WAAWa,GACrBC,WAAYd,WAAWc,GACvBU,UAAWA,EACXC,WAAYA,EACZV,eAAgBA,IAKpBtB,kBAAmBA,EACnBuC,YA5Ec,SAAqBtC,EAAKuC,GACxCA,EAAQA,GAAgB,EACxB,IAAIC,EAAQC,KAAKC,IAAI,GAAIH,GAGzB,OADAvC,GADAA,EAAMM,WAAWN,IACLyC,KAAKE,MAAM3C,EAAMwC,GAASA,EAAQ,GACnCI,QAAQL","file":"../../../../../temporaryJs/Home/Product/js/jl-price.js","sourcesContent":["'use strict';\n\ndefine(['jquery'], function ($) {\n    //数字转指定保留位数的字符串\n    var fixed_float = function fixed_float(num, digit) {\n        digit = digit ? digit : 2;\n        var times = Math.pow(10, digit);\n        num = parseFloat(num);\n        num = num ? Math.round(num * times) / times : 0;\n        return num.toFixed(digit);\n    };\n    //取区间价格\n    var get_section_price = function get_section_price(num, section, isWithSection) {\n        var correct_price = 0;\n        if (section && section.length) {\n            var index = section.length - 1;\n            correct_price = parseFloat(section[index].price || section[index].unit_price);\n            $.each(section, function (i, value) {\n                if (num >= parseInt(value.start == 0 ? '0' : value.start || value.lft_num) && num < parseInt(value.end == 0 ? '0' : value.end || value.right_num)) {\n                    correct_price = parseFloat(value.price || value.unit_price);\n                    index = i;\n                    return false;\n                }\n            });\n        }\n        return isWithSection ? { section: section[index], price: correct_price } : correct_price;\n    };\n    //取最终正确价格、计算内容：议价，开票，税，折扣限\n    var get_correct_price = function get_correct_price(option) {\n        var num = parseInt(option.num);\n        var isTax = option.isTax;\n        var product = option.product;\n        var section = product.price_section;\n        var bargain = product.bargainInfo;\n        var tax = parseFloat(product.tax);\n        var discount_num = parseFloat(product.discount_num);\n        var discount = 1 / tax;\n        //\n        var real_pay, should_pay, active_section;\n        var isBargain = false;\n        var isDiscount = false;\n        //没有议价,或者两个议价条件不成立，或者数量不足\n        if (!bargain || !bargain.price_pass && !bargain.price_tax_pass || num < parseInt(bargain.min_buy)) {\n            var section_price = get_section_price(num, section, true);\n            should_pay = section_price.price;\n            active_section = section_price.section;\n            if (!isTax && num * should_pay >= discount_num) {\n                real_pay = should_pay * discount;\n                isDiscount = true;\n            } else {\n                real_pay = should_pay;\n            }\n        }\n        //议价\n        else {\n                isBargain = true;\n                if (isTax) {\n                    real_pay = bargain.price_tax_pass ? bargain.discount_price_tax : bargain.discount_price * tax;\n                    should_pay = real_pay;\n                } else {\n                    should_pay = bargain.price_pass ? bargain.discount_price * tax : bargain.discount_price_tax;\n                    if (num * should_pay >= discount_num) {\n                        real_pay = bargain.price_pass ? bargain.discount_price : bargain.discount_price_tax * discount;\n                        isDiscount = true;\n                    } else {\n                        real_pay = bargain.price_pass ? bargain.discount_price : bargain.discount_price_tax;\n                    }\n                }\n            }\n        return {\n            real_pay: parseFloat(real_pay),\n            should_pay: parseFloat(should_pay),\n            isBargain: isBargain,\n            isDiscount: isDiscount,\n            active_section: active_section\n        };\n    };\n    return {\n        get_correct_price: get_correct_price,\n        get_section_price: get_section_price,\n        fixed_float: fixed_float\n    };\n});"]}