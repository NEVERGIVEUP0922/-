{"version":3,"sources":["Home/Public/js/bomUp.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","_toConsumableArray","arr","Array","isArray","i","arr2","length","from","define","$","wb","form","layui","modal","require","option","_this","self","types","data","layerBox","dataHandle","sheets","isExact","checkStandard","returnHead","session_data","JSON","parse","window","sessionStorage","getItem","bom_searchData","searchData","name","code","returnData","keyword","dataSave","keyIndex","search_result","extend","target","array","each","ind","val","idx","vxl","layer","msg","getSearch_result","noNum","exactAllMatch","check_name","checkValue","check_array","split","isPass","forEach","toLocaleUpperCase","indexOf","index","value","v","isEmptyObject","push","rank","check_sheets","key","max_length","rank_text","replace","inArray","check_code","table_head_line","line_code","totalIndex","position","keyValue","String","keyCode","Set","theLong","line","theMax","max","newArray","getExact","nameArray","row","lineLength","isfirst","cols","concat","p_sign","cate","next_pSign","showRow","vau","test","newReturnData","sort","a","b","obj2","countObj","exra","package","brand","exra_value","char_cols","dd","allI","nd","vuex","checkData","Psign","trim","text_count","count","optimal","type_data","exra_optimal","reg02","reg01","_key","Psigns","getPsign","getMaxCount","max_count","filter_p_sign","MatchingScore","text_letter","isValid","TheSame_rule","rule1","0","rule2","AA","reg03","reg04","reg05","reg07","reg06","sameLength","first_last","substr","sec_data","Object","sec","many","second","first","getSecondData","returnDataSearch","fn","compareString","new_data","show_searchDatas","_ref","sendData","num","bom","searcDatas","boms","code_check","this_bom","this_showData","kk","codes","search_detail","this_boms","common_data","length_data","pre_package","complete_data","contain_data","replace_data","show_search_detail","data_nom","inData","exchangeArray","blur_length","blur","complete","contain","id","arrays","isIn","_index","splice","unshift","show_code","jj","SD","common_string","_after","findSubStr","str02","package_str","complete_reg","add","replace_pt","choose_replace","replace_product_data","ll","repl","new_length","val_this","package_exact","this_blur","keys","reverse","com_array","brand_first","brand_name","exchangeArray_brand","data_obj","Array_set","arr1","arguments","undefined","arr3","againArray","this_arr","theExactData","mistyNum","str1","str2","isAfter","getSubStr","temp","len1","j","current","str2_array","before","after","importExcel","isEaxal","issendData","open","type","icon","content","sample","success","css","width","height","background-color","background-position","close","list","cates","brands","vlx","showData","mendData","setItem","stringify","setTimeout","location","href","getJSON","compareData","console","log","newData","this_data","check_head","sheet","bom_head_temporay","bom_head","str","key_array","confirm","title","brief","maxHeight","isCenter","removeItem","formData","serializeArray","save_data","temparory","render","datas","importExcelData","suffix","files","size","alert","f","reader","FileReader","readAsBinaryString","onload","e","result","XLSX","read","chooseSheet","SheetNames","confirmText","Sheets","cancelText","top","cancel","ActiveXObject","replaceWith","clone","make_xlsx_lib"],"mappings":"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","file":"../../../../../temporaryJs/Home/Public/js/bomUp.js","sourcesContent":["'use strict';\n\n/*\r\n\t\t\t FileReader共有4种读取方法：\r\n\t\t\t 1.readAsArrayBuffer(file)：将文件读取为ArrayBuffer。\r\n\t\t\t 2.readAsBinaryString(file)：将文件读取为二进制字符串\r\n\t\t\t 3.readAsDataURL(file)：将文件读取为Data URL\r\n\t\t\t 4.readAsText(file, [encoding])：将文件读取为文本，encoding缺省值为'UTF-8'\r\n\t\t\t */\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\ndefine('bomUp', ['jquery', 'xlsxFull', 'layer-all', 'jl-modal'], function ($) {\n    var wb; //读取完成的数据\n    var rABS = false; //是否将文件读取为二进制字符串\n    var form = layui.form;\n    var modal = require(\"jl-modal\");\n    var bomup = function bomup(option) {\n        var _this = option.self;\n        var types = $(_this).data(\"type\");\n        function fixdata(data) {\n            //文件流转BinaryString\n            var o = \"\",\n                l = 0,\n                w = 10240;\n            for (; l < data.byteLength / w; ++l) {\n                o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w, l * w + w)));\n            }o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w)));\n            return o;\n        }\n        var layerBox = null;\n        //数据处理\n        function dataHandle(sheets, isExact, checkStandard, returnHead) {\n            var session_data = sheets[2] ? sheets[2] : JSON.parse(window.sessionStorage.getItem(\"bom_searchData\"));\n            var bom_searchData = session_data ? session_data : [];\n            var searchData = bom_searchData.length > 0 ? bom_searchData : [{ name: \"品牌,brand,Agents,制造商,厂家,厂牌,代理,制造商,廠家,廠牌\", code: \"brand\" }, { name: \"分类,功能,参数,spec,specification,性能,规格,分類,功能,參數,規格\", code: \"cate\" }, { name: \"封装,封裝,Package\", code: \"package\" }, { name: \"数量,QTY,quantity,Q,采购量,量,单机用量,单板用量,數量采購量,量,單機用量,單板用量\", code: \"pnum\" }, { name: \"型号,part,物料,厂商,P/N,num,product,item,来料,number,type,name,typ,part_number,用料,品名,名称,品种,型號,廠商,來料,名稱,品種\", code: \"p_sign\" }];\n            var searchData_exact = [{ name: \"需求品牌\", code: \"brand\" }, { name: \"需求功能分类\", code: \"cate\" }, { name: \"需求封装\", code: \"package\" }, { name: \"需求数量\", code: \"pnum\" }, { name: \"需求型号\", code: \"p_sign\" }];\n            var defaultData = { p_sign: [], package: [], brand: [], cate: [], pnum: [] };\n            var returnData = {};\n            var keyword = [];\n            var dataSave = [];\n            var keyIndex = [];\n            var getSearch_result = function getSearch_result(target, array) {\n                if ((typeof target === 'undefined' ? 'undefined' : _typeof(target)) !== \"object\" || (typeof array === 'undefined' ? 'undefined' : _typeof(array)) !== \"object\") {\n                    layer.msg('参数错误');\n                    return;\n                };\n                $.each(target, function (ind, val) {\n                    $.each(array, function (idx, vxl) {\n                        if (vxl.code === val.code) {\n                            target[ind] = array[idx];\n                        }\n                    });\n                });\n                return target;\n            };\n            var search_result = $.extend(true, [], isExact ? getSearch_result(searchData_exact, bom_searchData.length > 0 ? searchData : []) : searchData);\n            var checkLine = \"\";\n            var sheetLength = 0;\n            var noNum = {};\n            var exactAllMatch = [];\n            var check_name = function check_name(target, checkValue) {\n                //匹配表头关键字\n                var check_array = checkValue.split(\",\");\n                var isPass = false;\n                check_array.forEach(function (val, ind) {\n                    if (target.toLocaleUpperCase().indexOf(val.toLocaleUpperCase()) > -1) {\n                        isPass = true;\n                        return false;\n                    };\n                });\n                return isPass;\n            };\n            // console.log(\"sheets\",sheets);\n            //判断是否标准字段\n            if (checkStandard) {\n                search_result.forEach(function (val, ind) {\n                    var obj = {};\n                    $.each(sheets[0], function (index, value) {\n                        if (value.v && value.v != \"null\" && val.name) {\n                            if (check_name(value.v + \"\", val.name)) {\n                                obj[val] = true;\n                            }\n                        }\n                    });\n                    if (!$.isEmptyObject(obj)) exactAllMatch.push(obj);\n                });\n                if (search_result.length == exactAllMatch.length) {\n                    return true;\n                } else {\n                    return false;\n                }\n            }\n            var sheetRow = 'A';\n            var isA = 0;\n            var rank = [];\n            var check_sheets = function check_sheets(key, array) {\n                var max_length = 0;\n                $.each(sheets[0], function (index, value) {\n                    //找出表头列\n                    var rank_text = index.indexOf(\"!\") < 0 ? index.replace(/[0-9]/ig, \"\") : \"\";\n                    if (rank_text && $.inArray(rank_text, rank) < 0) {\n                        rank.push(rank_text);\n                    };\n                    //核对关键字是否是包含表头列每一项\n                    if (array && index.indexOf(\"!\") < 0) {\n                        for (var i = 0; i < array.length; i++) {\n                            if (index.indexOf(array[i] + key) > -1) {\n                                max_length++;\n                            }\n                        };\n                    } else {\n                        array = [];\n                    }\n                });\n                if (max_length === array.length) {\n                    return { array: rank, max_length: true };\n                } else {\n                    return { array: rank, max_length: false };\n                };\n            };\n            var check_code = [];\n            var table_head_line = -1;\n            $.each(sheets[0], function (index, value) {\n                //找出第一个非数字的列\n                var line_code = index.replace(/[0-9]/ig, \"\");\n                if (noNum[line_code]) {\n                    noNum[line_code].push({ totalIndex: line_code, position: index, keyValue: String(value.v) });\n                } else {\n                    noNum[line_code] = [{ totalIndex: line_code, position: index, keyValue: String(value.v) }];\n                };\n                search_result.forEach(function (val, idx) {\n                    if (value.v && value.v != \"null\") {\n                        //找关键表头字段\n                        if (check_name(value.v + \"\", val.name) && (value.v + \"\").length < 20) {\n                            if (check_sheets(value.v, check_sheets().array).max_length /*&& $.inArray(index.replace(/[0-9]/ig, \"\"), check_code) < 0*/) {\n                                    if (table_head_line < 0) table_head_line = index.replace(/[^0-9]/ig, \"\");\n                                    check_code.push(index.replace(/[0-9]/ig, \"\"));\n                                    if (index.replace(/[^0-9]/ig, \"\") < 10) keyword.push({ totalIndex: index.replace(/[0-9]/ig, \"\"), position: index, keyValue: String(value.v), keyCode: val.code });\n                                }\n\n                            if (index.replace(/[^0-9]/ig, \"\") < 10) keyIndex.push(index.replace(/[0-9]/ig, \"\"));\n                        };\n                    }\n                });\n            });\n            var getExact = function getExact(array) {\n                if (!(array instanceof Array)) {\n                    layer.msg('参数格式错误');\n                    return;\n                };\n                var theLong = {};\n                array.forEach(function (val, idx) {\n                    if (val.position) {\n                        var line = val.position.replace(/[^0-9]/ig, '');\n                        if (theLong[line]) {\n                            theLong[line] = ++theLong[line];\n                        } else {\n                            theLong[line] = 1;\n                        }\n                    }\n                });\n                var theMax = { max: 0, value: '' };\n                for (var key in theLong) {\n                    theMax.max < theLong[key] && (theMax.max = theLong[key], theMax.value = key);\n                };\n                var newArray = [];\n                array.forEach(function (val, idx) {\n                    if (val.position) {\n                        var line = val.position.replace(/[^0-9]/ig, '');\n                        if (line - theMax.value === 0) {\n                            newArray.push(val);\n                        }\n                    }\n                });\n                return newArray;\n            };\n            //去重\n            keyIndex = Array.from(new Set(keyIndex));\n            keyword = getExact(keyword);\n            //返回table头的字段\n            if (returnHead) {\n                var nameArray = [];\n                $.each(sheets[0], function (ind, val) {\n                    if (table_head_line == ind.replace(/[^0-9]/ig, \"\")) {\n                        //去重添加数据\n                        if ($.inArray(val.v, nameArray) < 0) nameArray.push(val.v);\n                    }\n                });\n                return nameArray;\n            };\n            //整理数据，标记行号，列号\n            $.each(keyIndex, function (index, value) {\n                $.each(sheets[0], function (idx, val) {\n                    if (value == idx.replace(/[0-9]/ig, \"\")) {\n                        dataSave.push({ row: value, name: val.v, line: idx.replace(/[^0-9]/ig, \"\"), position: idx });\n                    }\n                });\n            });\n            var lineLength = [];\n            $.each(keyword, function (index, value) {\n                var array = [];\n                var isfirst = 0;\n                $.each(dataSave, function (idx, val) {\n                    if ($.inArray(val.line, lineLength) < 0) {\n                        lineLength.push(val.line);\n                    };\n                    if (value.totalIndex == val.row) {\n                        if (isfirst != 0) array.push({ name: value.keyValue, value: val.name, cols: val.row, line: val.line });\n                        isfirst++;\n                    }\n                });\n                //按A,B,C...分数组\n                if (returnData[value.keyCode]) {\n                    returnData[value.keyCode] = returnData[value.keyCode].concat(array);\n                } else {\n                    returnData[value.keyCode] = array;\n                }\n                array = null;\n            });\n            if (!returnData.p_sign) {\n                if (returnData.cate) {\n                    //没有匹配到型号就把分类作为型号\n                    returnData.p_sign = returnData.cate;\n                    delete returnData.cate;\n                } else {\n                    var next_pSign = [];\n                    var showRow = \"A\";\n                    $.each(noNum, function (idx, vau) {\n                        if (idx.indexOf('ref') < 0 && idx.indexOf('margins') < 0) {\n                            if (showRow !== String(idx)) {\n                                showRow = String(idx);\n                            }\n                            $.each(vau, function (ind, val) {\n                                var reg_01 = /[A-Za-z]+/ig;\n                                if (reg_01.test(val.keyValue) && showRow === idx) {\n                                    next_pSign.push({ cols: val.position.replace(/[0-9]/ig, \"\"), line: val.position.replace(/[^0-9]/ig, \"\"), name: \"需求型号\", value: val.keyValue });\n                                } else {\n                                    if (next_pSign.length > 1) {\n                                        return false;\n                                    }\n                                }\n                            });\n                            if (next_pSign.length > 2) {\n                                return false;\n                            } else {\n                                next_pSign = [];\n                            };\n                        }\n                    });\n\n                    returnData.p_sign = next_pSign;\n                }\n            }\n            // console.log(keyIndex,keyword,dataSave,returnData,lineLength);\n            var newReturnData = [];\n            //同一个关键字code的放在一份关键字code下数组\n            lineLength = lineLength.sort(function (a, b) {\n                return a - b;\n            });\n            for (var i = 1; i < lineLength.length; i++) {\n                var obj = {};\n                $.each(returnData, function (ind, val) {\n                    if ($.isArray(val)) {\n                        var obj2 = {};\n                        $.each(val, function (idx, value) {\n                            if (lineLength[i] == value.line) {\n                                if (!obj2[ind]) {\n                                    obj2[ind] = [value];\n                                } else {\n                                    obj2[ind].push(value);\n                                };\n                            }\n                        });\n                        obj = $.extend({}, obj, obj2);\n                    }\n                });\n                if (!$.isEmptyObject(obj)) newReturnData.push(obj);\n            }\n            //去重\n            var checkData = function checkData(array) {\n                if ((typeof array === 'undefined' ? 'undefined' : _typeof(array)) !== \"object\") {\n                    layer.msg('参数错误');\n                    return;\n                };\n                var newArray = [];\n                array.forEach(function (val, ind) {\n                    if (newArray.length < 1) {\n                        newArray.push(val);\n                    } else {\n                        var allI = 0;\n                        $.each(newArray, function (nd, vuex) {\n                            if (vuex.name !== val.name || vuex.value !== val.value || vuex.line !== val.line) {\n                                allI++;\n                            }\n                        });\n                        if (allI === newArray.length) {\n                            newArray.push(val);\n                        }\n                    };\n                });\n                return newArray;\n            };\n            //对匹配数据再次处理\n            var countObj = {},\n                perfect = [],\n                exra = { cate: {}, package: {}, brand: {} },\n                exra_value = { char_cols: {} },\n                empty_count = { count: 0 };\n            var p_sign_filter = function p_sign_filter(Psign, index) {\n                if (!(Psign instanceof Array)) {\n                    layer.msg('匹配型号数据错误');\n                    return;\n                };\n                $.each(Psign, function (key, obj) {\n                    if (!obj.value) {\n                        empty_count;\n                        return true;\n                    };\n                    var reg01 = /^[0-9_-]+(\\t)*$/ig;\n                    var reg02 = /^[\\u2E80-\\u9FFF]+$/ig;\n                    var reg03 = /[\\u2E80-\\u9FFF]+/ig;\n                    var reg04 = /(IC)|(PCB)|(DC)|(PUR)/ig;\n                    var reg05 = /(\\s)|(,)|(\\|)|(\\/)/ig;\n                    if (!reg01.test(obj.value)) {\n                        //纯数字清除\n                        if (!reg02.test(obj.value.trim())) {\n                            //纯文字清除\n                            if (reg03.test(obj.value) && reg04.test(obj.value)) {} else {\n                                if (!reg05.test(obj.value.trim())) {\n                                    if (countObj[obj.cols]) {\n                                        countObj[obj.cols].count += 1;\n                                    } else {\n                                        obj.count = 1;\n                                        countObj[obj.cols] = obj;\n                                    }\n                                } else {\n                                    //空格字符计算\n                                    if (!exra_value['char_cols'].count) {\n                                        exra_value['char_cols'] = { cols: obj.cols, count: 1, value: [obj] };\n                                    } else {\n                                        exra_value['char_cols'].count++;\n                                        exra_value['char_cols'].value[index] = obj;\n                                    };\n                                }\n                            }\n                        } else {\n                            //纯文字的计算\n                            if (obj.text_count) {\n                                obj.text_count += 1;\n                            } else {\n                                obj.text_count += 1;\n                            };\n                        }\n                    }\n                });\n            };\n            var cate_filter = function cate_filter(Cate) {\n                if (!(Cate instanceof Array)) {\n                    layer.msg('匹配分类数据错误');\n                    return;\n                };\n                $.each(Cate, function (key, obj) {\n                    var reg01 = /(IC)|(管理)|(处理)|(芯片)/ig;\n                    if (!reg01.test(obj.value)) {\n                        if (exra.cate[obj.cols]) {\n                            exra.cate[obj.cols].count += 1;\n                        } else {\n                            obj.count = 1;\n                            exra.cate[obj.cols] = obj;\n                        }\n                    }\n                });\n            };\n            newReturnData.forEach(function (val, ind) {\n                //对型号再次处理\n                var P_sign = [];\n                $.each(val, function (dd, key) {\n                    if (key.length > 1) {\n                        newReturnData[ind][dd] = val[dd] = checkData(key);\n                    }\n                });\n                /*  if(val.p_sign){\r\n                      if(val.p_sign.length>1){\r\n                          let p_position={};\r\n                          $.each(val.p_sign,function(key,obj){\r\n                              let reg01=/^[0-9_-]+(\\t)*$/ig;\r\n                              let reg02=/^[\\u2E80-\\u9FFF]+$/ig;\r\n                              let reg03=/[\\u2E80-\\u9FFF]+/ig;\r\n                              let reg04=/(IC)|(PCB)|(DC)|(PUR)/ig;\r\n                              let reg05=/(\\s)|(,)|(\\|)|(\\/)/ig;\r\n                              let reg06=/(品牌[:\\s])/ig;\r\n                              let _self_obj=(obj.value+'').split(reg06);\r\n                              if(_self_obj.length>2){\r\n                                  let self_obj={value:_self_obj[2],add:true}\r\n                                  !newReturnData[ind].brand&&(newReturnData[ind].brand=[self_obj]);\r\n                              };\r\n                              if(!reg01.test(obj.value)){\r\n                                  //纯数字清除\r\n                                  if(!reg02.test(obj.value)){\r\n                                      //纯文字清除\r\n                                      if(reg03.test(obj.value)&&reg04.test(obj.value)){\r\n                                          //识别汉字加固定字段加入分类\r\n                                          p_position.reg03=key;\r\n                                          obj.add=true;\r\n                                          !newReturnData[ind].cate&&(newReturnData[ind].cate=[obj]);\r\n                                      }else{\r\n                                          if(!reg05.test(obj.value)){\r\n                                              P_sign.push(obj);\r\n                                          }else{\r\n                                              p_position.reg05=key;\r\n                                          }\r\n                                      }\r\n                                  }else{\r\n                                      p_position.reg02=key;\r\n                                      obj.add=true;\r\n                                      !newReturnData[ind].brand&&(newReturnData[ind].brand=[obj]);\r\n                                  }\r\n                              }else{\r\n                                  p_position.reg01=key;\r\n                              }\r\n                          });\r\n                          if(P_sign.length<1){\r\n                              if(p_position.reg05&&val.p_sign[p_position.reg05].value.length>3){\r\n                                  P_sign.push(val.p_sign[p_position.reg05]);\r\n                              }else if(p_position.reg03){\r\n                                  P_sign.push(val.p_sign[p_position.reg03]);\r\n                                  //newReturnData[ind].cate.pop();\r\n                                  if(newReturnData[ind].cate.length===0){\r\n                                       newReturnData[ind].cate=[]\r\n                                  };\r\n                              }else if(p_position.reg02){\r\n                                  P_sign.push(val.p_sign[p_position.reg02]);\r\n                                  //newReturnData[ind].brand.pop();\r\n                                  if(newReturnData[ind].brand.length===0){\r\n                                    newReturnData[ind].brand=[]\r\n                                  };\r\n                              }else{\r\n                                  P_sign.push(val.p_sign[p_position.reg01])\r\n                              }\r\n                          };\r\n                        /!*  if(P_sign.length>0){\r\n                              $.each(P_sign,function(idx,val_p){\r\n                                  let common_same=isSameLength[idx]?(isSameLength[idx].p_sign||val_p.value):val_p.value;\r\n                                  if((!val_p.value||val_p.value.length===common_same.length)){\r\n                                      if(isSameLength[0].cols===val_p.cols){\r\n                                          isSameLength[idx]={cols:val_p.cols,p_sign:common_same,self_length: (isSameLength[idx]?(++(isSameLength[idx].self_length)):1)};\r\n                                        }else{\r\n                                          idx<1 &&(isSameLength[idx]={cols:val_p.cols,p_sign:common_same,self_length: (isSameLength[idx]?(++(isSameLength[idx].self_length)):1)});\r\n                                      }\r\n                                  }\r\n                              });\r\n                          }*!/\r\n                          //找最优型号\r\n                          val.p_sign&&p_sign_filter(P_sign);\r\n                          newReturnData[ind].p_sign=P_sign;\r\n                      }\r\n                  }*/\n            });\n            //找出最优数据\n            newReturnData.forEach(function (val, ind) {\n                //型号统计\n                val.p_sign && p_sign_filter(val.p_sign, ind);\n                //找最优分类\n                //val.cate&&cate_filter(val.cate);\n            });\n            //找最优型号\n            var optimal = {},\n                max_length = 0;\n            var type_data = {};\n            var exra_optimal = { cate: { optimal: {}, max_length: 0 }, brand: { optimal: {}, max_length: 0 }, package: { optimal: {}, max_length: 0 } };\n            for (var key in countObj) {\n                var reg02 = /^[\\u2E80-\\u9FFF]+$/ig;\n                var reg01 = /^[0-9_-]+(\\t)*$/ig;\n                if (reg01.test(countObj[key])) {\n                    type_data['self_number'] = $.extend({}, countObj[key]);\n                } else if (reg02.test(countObj[key])) {\n                    type_data['self_text'] = $.extend({}, countObj[key]);\n                } else {\n                    if ($.isEmptyObject(optimal.value)) {\n                        optimal = $.extend({}, countObj[key]);\n                    }\n                }\n                max_length <= countObj[key].count && !reg02.test(countObj[key]) && !reg01.test(countObj[key]) && (max_length = countObj[key].count, optimal = $.extend({}, countObj[key]));\n            };\n            if ($.isEmptyObject(optimal)) {\n                !$.isEmptyObject(type_data['self_number']) && (optimal = $.extend({}, type_data['self_number']));\n                !$.isEmptyObject(type_data['self_text']) && (optimal = $.extend({}, type_data['self_text']));\n            }\n            $.each(exra, function (ind, val) {\n                if (!$.isEmptyObject(val)) {\n                    for (var _key in val) {\n                        exra_optimal[ind].max_length <= val[_key].count && (exra_optimal[ind].max_length = val[_key].count, exra_optimal[ind].optimal = $.extend({}, val[_key]));\n                    }\n                }\n            });\n            var Psigns = [];\n            newReturnData.forEach(function (val, ind) {\n                //规则统计后，赋值\n                if (val.p_sign) {\n                    Psigns[ind] = val.p_sign;\n                    $.each(val.p_sign, function (idx, vxl) {\n                        if (optimal.cols === vxl.cols) {\n                            newReturnData[ind].p_sign = [vxl];\n                            return false;\n                        } else {\n                            newReturnData[ind].p_sign = [];\n                        }\n                    });\n                } else {\n                    Psigns[ind] = [];\n                }\n                /*if(val.cate){\r\n                    $.each(val.cate,function(idx,vxl){\r\n                        if(exra_optimal.cate.optimal.cols===vxl.cols){\r\n                            newReturnData[ind].cate=[vxl];\r\n                            return false;\r\n                        }else{\r\n                            newReturnData[ind].cate=[];\r\n                        }\r\n                    });\r\n                }*/\n            });\n            //不符合型号规则，就把规则5的数据赋值\n            var getPsign = function getPsign(cols, array) {\n                if (!array instanceof Array) {\n                    layer.msg('参数错误');\n                    return;\n                };\n                var value = {};\n                $.each(array, function (ind, val) {\n                    if (cols === val.cols) {\n                        value = $.extend(true, {}, val);\n                        return;\n                    }\n                });\n                if (array.length === 1 && $.isEmptyObject(value)) {\n                    value = array[0];\n                };\n                return value;\n            };\n            if (!optimal.cols || optimal.count < newReturnData.length * 0.2) {\n                newReturnData.forEach(function (val, ind) {\n                    if (val.p_sign && exra_value['char_cols'].cols) {\n                        if (exra_value['char_cols'].cols) {\n                            newReturnData[ind].p_sign[0] = getPsign(exra_value['char_cols'].cols, Psigns[ind]);\n                        } else {\n                            newReturnData[ind].p_sign = [];\n                        }\n                    }\n                });\n            };\n            //对匹配空数据做默认处理\n            newReturnData.forEach(function (val, ind) {\n                var default_code = ['p_sign', 'cate', 'package', 'pnum', 'brand'];\n                default_code.forEach(function (vxl, idx) {\n                    if (!val[vxl]) {\n                        newReturnData[ind][vxl] = [];\n                    } else {\n                        if (val[vxl].length > 1) {\n                            newReturnData[ind][vxl].length = 1;\n                        }\n                    }\n                });\n            });\n            //找到同一规律型号最大\n            var getMaxCount = function getMaxCount(obj) {\n                if ((typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== \"object\") {\n                    layer.msg('参数错误');return;\n                };\n                var max_count = 0;\n                $.each(obj, function (ind, val) {\n                    if (val.count) {\n                        max_count <= val.count && (max_count = val.count);\n                    }\n                });\n                return max_count;\n            };\n            //计算型号是否用分类替代\n            var filter_p_sign = { MatchingScore: 0, text_letter: 0 },\n                isValid = 0,\n                TheSame_rule = { rule1: { 0: { value: '', count: 1 }, count: 1 }, rule2: { 'AA': { value: '', count: 1 }, count: 1 } };\n            $.each(newReturnData, function (ind, val) {\n                var reg01 = /^[0-9_-]+(\\t)*$/ig;\n                var reg02 = /^[\\u2E80-\\u9FFF]+$/ig;\n                var reg03 = /[\\u2E80-\\u9FFF]+/ig;\n                var reg04 = /(IC)|(PCB)|(DC)|(PUR)/ig;\n                var reg05 = /^[0-9]*[\\u2E80-\\u9FFF]*[0-9]*(\\t)*$/ig;\n                var reg07 = /^[a-zA-Z]*[\\u2E80-\\u9FFF]*[a-zA-Z]*(\\t)*$/ig;\n                var reg06 = /[-.\\t()（）]*/ig;\n                if (val.p_sign) {\n                    $.each(val.p_sign, function (idx, vxl) {\n                        idx === 0 && isValid++;\n                        if (reg05.test((vxl.value + '').replace(reg06, '')) || reg02.test((vxl.value + '').replace(reg06, '')) || reg03.test((vxl.value + '').replace(reg06, '')) && reg04.test((vxl.value + '').replace(reg06, ''))) {\n                            filter_p_sign.MatchingScore++;\n                        };\n                        if (reg07.test((vxl.value + '').replace(reg06, ''))) {\n                            //文字字母超80%\n                            filter_p_sign.text_letter++;\n                        }\n                        //同一规律型号排除\n                        var sameLength = String(vxl.value).length || 0;\n                        if (TheSame_rule.rule1[sameLength]) {\n                            //相同的长度\n                            TheSame_rule.rule1[sameLength].count++;\n                        } else {\n                            TheSame_rule.rule1[sameLength] = { value: String(vxl.value), count: 1 };\n                        }\n                        TheSame_rule.rule1.count = getMaxCount(TheSame_rule.rule1);\n                        var first_last = String(vxl.value).replace(String(vxl.value).substr(1, String(vxl.value).length - 2), '');\n                        if (TheSame_rule.rule2[first_last]) {\n                            //收尾字母相同\n                            TheSame_rule.rule2[first_last].count++;\n                        } else {\n                            TheSame_rule.rule2[first_last] = { value: first_last, count: 1 };\n                        }\n                        TheSame_rule.rule2.count = getMaxCount(TheSame_rule.rule2);\n                    });\n                }\n            });\n            //找第二大的数据\n            var getSecondData = function getSecondData(array) {\n                if (!array instanceof Object) {\n                    layer.msg('数据错误');return;\n                };\n                var max = { count: 0, cols: '' };\n                var sec = { count: 0, cols: '' };\n                var many = 0;\n                $.each(array, function (ind, val) {\n                    //\t\t\t        第i个元素大于max\n                    many++;\n                    if (val['count'] > max['count']) {\n                        sec = max;\n                        max = val;\n                        //\t\t\t\t    第i个元素小于max但是大于sec\n                    } else if (val['count'] > sec['count']) {\n                        sec = val;\n                    }\n                });\n                return { second: sec, first: max, many: many };\n            };\n            if (filter_p_sign.MatchingScore >= isValid * 0.8 || TheSame_rule.rule1.count >= (isValid > 50 ? isValid * 0.8 : isValid * 0.6) || TheSame_rule.rule2.count >= isValid * 0.8 || filter_p_sign.text_letter >= isValid * 0.8) {\n                newReturnData.forEach(function (val, ind) {\n                    if (val.p_sign) {\n                        var sec_data = getSecondData(countObj);\n                        $.each(Psigns[ind], function (idx, vxl) {\n                            if (!$.isEmptyObject(countObj)) {\n                                if (sec_data.second.cols === vxl.cols && sec_data.many > 1 && sec_data.second.count > isValid * 0.8) {\n                                    newReturnData[ind].p_sign[0] = vxl;\n                                    return false;\n                                }\n                            };\n                            if (val.p_sign[0] && val.cate.length > 0) {\n                                newReturnData[ind].p_sign = [val.cate[0]];\n                            } else {\n                                //赋值规则5的值\n                                if (exra_value['char_cols'].cols) {\n                                    newReturnData[ind].p_sign[0] = getPsign(exra_value['char_cols'].cols, Psigns[ind]);\n                                } else {\n                                    if (!newReturnData[ind].p_sign) {\n                                        newReturnData[ind].p_sign = [];\n                                    }\n                                }\n                            };\n                        });\n                    }\n                });\n            }\n            return newReturnData;\n        }\n        //抬头数据精确处理\n        function searchDataHandle(data, fn) {\n            ///获取json文件\n            var jsons = $.getJSON('/productBom.json', function (compareData) {\n                console.log(\"json\", compareData);\n                if (!(compareData instanceof Array)) {\n                    layer.msg(\"本地商品数据错误！！！\");\n                    return;\n                }\n                var newData = {};\n                data.forEach(function (val, ind) {\n                    newData[ind] = { blur: compareData };\n                });\n                returnDataSearch({ bom: newData, sendData: data, num: {} }, function (this_data) {\n                    if (fn) fn(this_data);\n                }, ['p_sign', 'cate', 'brand', 'package']);\n            });\n        }\n        //返回数据处理\n        function returnDataSearch(data, fn, compareString) {\n            if ((typeof data === 'undefined' ? 'undefined' : _typeof(data)) !== \"object\") {\n                layer.msg(\"返回数据格式错误\");\n            };\n            var new_data = [];\n            var show_searchDatas = [];\n            var _ref = [data.sendData, data.num, data.bom],\n                searcDatas = _ref[0],\n                nums = _ref[1],\n                boms = _ref[2];\n            /* var match_code=function(code,index,search_detail,this_boms){\r\n                 //匹配返回的数据\r\n                 var common_data=[];\r\n                 let complete_data=[];\r\n                 let replace_data=[];\r\n                 let show_search_detail={};\r\n                 let data_nom=this_boms.blur?this_boms.blur:boms[index].blur;\r\n                 //查询是否在数组里面\r\n                 function inData(id,arrays){\r\n                     if(!id||!(arrays instanceof Array)){\r\n                         return layer.msg('参数错误');\r\n                     }\r\n                     let isIn=false;\r\n                     arrays.forEach(function(val,idx){\r\n                         if(id===val.id){\r\n                             isIn=true;\r\n                         }\r\n                     });\r\n                     return isIn;\r\n                 }\r\n                 //json型数组排序\r\n                 let exchangeArray=function(obj,array){\r\n                     if(typeof array !==\"object\"||typeof obj !==\"object\"){\r\n                         layer.msg('参数错误');\r\n                         return;\r\n                     };\r\n                     var newArray=$.extend(true,[],array);\r\n                     let index=-1;\r\n                     $.each(array,function(ind,val){\r\n                         if(val.id === obj.id){\r\n                             index=ind\r\n                             return false;\r\n                         }\r\n                     });\r\n                     if(index>-1){\r\n                         newArray.splice(index,1);\r\n                         newArray.unshift(obj);\r\n                     }\r\n                     return newArray;\r\n                 };\r\n                 $.each(search_detail,function(idx,val){\r\n                     let max_length=0;\r\n                     let show_code=\"\";\r\n                     let reg=/(^[0-9]+$)|(^[\\u2E80-\\u9FFF]+$)/ig;\r\n                     if(reg.test(val.value) && code===\"p_sign\"){\r\n                         return true;\r\n                     };\r\n                     $.each(data_nom,function(jj,SD){\r\n                         let common_string='';\r\n                         if(SD[code]||SD[code+\"_name\"]){\r\n                             if(code==='package' || code==='p_sign'){\r\n                                 common_string = findSubStr(val.value,SD[code]);\r\n                             }else{\r\n                                 common_string = findSubStr(val.value,SD[code+'_name']);\r\n                             };\r\n                         if((common_string.length>=3||common_string.indexOf(val.value)>-1)&& code===\"p_sign\"){\r\n                             //获取商城型号-后面的\r\n                             let _after= findSubStr(val.value,SD[code],true);\r\n                             if(common_string===_after.after){\r\n                                 return true;\r\n                             };\r\n                             //完全匹配数据\r\n                             if(common_string ===val.value){\r\n                                 if(code===\"p_sign\"){\r\n                                     if(complete_data.length>0){\r\n                                         if(!inData(SD.id,complete_data)){\r\n                                             complete_data.push(SD);\r\n                                         };\r\n                                     }else{\r\n                                         complete_data.push(SD);\r\n                                     }\r\n                                 }\r\n                                 if(this_boms.complete){\r\n                                     if(inData(SD.id,this_boms.complete)){\r\n                                         if(complete_data.length>0){\r\n                                             if(!inData(SD.id,complete_data)){\r\n                                                 complete_data.push(SD);\r\n                                             };\r\n                                         }else{\r\n                                             complete_data.push(SD);\r\n                                         }\r\n                                     };\r\n                                 }\r\n                             }\r\n                             if(max_length<=common_string.length ){\r\n                                 max_length=common_string.length,show_code=val.value;\r\n                                 if(common_data.length>0){\r\n                                     //去重\r\n                                     if(!inData(SD.id,common_data)){\r\n                                         common_data.unshift(SD);\r\n                                     };\r\n                                 }else{\r\n                                     common_data.unshift(SD);\r\n                                 }\r\n                             }else{\r\n                                 if(common_data.length>0){\r\n                                     if(!inData(SD.id,common_data)){\r\n                                         common_data.push(SD);\r\n                                     };\r\n                                 }else{\r\n                                     common_data.push(SD);\r\n                                 }\r\n                             };\r\n                         }\r\n                             //替代料号添加\r\n                             if( code ===\"p_sign\"){\r\n                                 //替代料号\r\n                                 let replace_pt='';\r\n                                 let choose_replace='';\r\n                                 let replace_product_data=SD['fitemno_access'].split(\"{}\");\r\n                                 if(SD[code] && replace_product_data.length>0 ){\r\n                                     $.each(replace_product_data,function(ll,repl){\r\n                                         if(ll>0){\r\n                                             if(code==='p_sign'){\r\n                                                 replace_pt = findSubStr(val.value,repl);\r\n                                             }\r\n                                             if(replace_pt===val.value && !choose_replace)choose_replace=replace_pt;\r\n                                         }\r\n                                     });\r\n                                 };\r\n                                 if(choose_replace.length>=3){\r\n                                     //去重\r\n                                     if(common_data.length>0){\r\n                                         if(!inData(SD.id,common_data)){\r\n                                             common_data.push(SD);\r\n                                         };\r\n                                     }else{\r\n                                         common_data.push(SD);\r\n                                     }\r\n                                     if(replace_data.length>0){\r\n                                         if(!inData(SD.id,replace_data)){\r\n                                             replace_data.push(SD);\r\n                                         };\r\n                                     }else{\r\n                                         replace_data.push(SD);\r\n                                     }\r\n                                 }\r\n                             }else {\r\n                             if(max_length<=common_string.length ){\r\n                                 max_length=common_string.length,show_code=val.value;\r\n                                 common_data=exchangeArray(SD,this_boms.blur);\r\n                                 //完全匹配\r\n                                 if(this_boms.complete){\r\n                                     complete_data=exchangeArray(SD,this_boms.complete);\r\n                                 }\r\n                                 //替代料号\r\n                                 if(this_boms.replace){\r\n                                     replace_data=exchangeArray(SD,this_boms.replace);\r\n                                 }\r\n                             }\r\n                         }\r\n                       }\r\n                     });\r\n                       show_search_detail[code]=show_code?show_code.trim():\"\";\r\n                 });\r\n                 return [(code===\"p_sign\"&&common_data.length>50?(common_data.splice(0,50)):common_data),show_search_detail,complete_data,(replace_data.length<1?(this_boms.replace||[]):replace_data)];\r\n             };*/\n\n            var match_code2 = function match_code2(code, index, search_detail, this_boms) {\n                //匹配返回的数据\n                var common_data = [];\n                var length_data = {};\n                var pre_package = [];\n                var complete_data = [];\n                var contain_data = [];\n                var replace_data = [];\n                var show_search_detail = {};\n                var data_nom = code !== 'p_sign' ? this_boms.blur : boms[index].blur;\n                //查询是否在数组里面\n                var inData = function inData(id, arrays) {\n                    if (!id || !(arrays instanceof Array)) {\n                        return layer.msg('参数错误1');\n                    }\n                    var isIn = false;\n                    arrays.forEach(function (val, idx) {\n                        if (id === val.id) {\n                            isIn = true;\n                        }\n                    });\n                    return isIn;\n                };\n                //json型数组排序\n                var exchangeArray = function exchangeArray(obj, array) {\n                    if ((typeof array === 'undefined' ? 'undefined' : _typeof(array)) !== \"object\" || (typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== \"object\") {\n                        layer.msg('参数错误2');\n                        return [];\n                    };\n                    var newArray = $.extend(true, [], array);\n                    if (obj.id) {\n                        var _index = -1;\n                        $.each(array, function (ind, val) {\n                            if (val.id === obj.id) {\n                                _index = ind;\n                                return false;\n                            }\n                        });\n                        if (_index > -1) {\n                            newArray.splice(_index, 1);\n                            newArray.unshift(obj);\n                        }\n                    }\n                    return newArray;\n                };\n                $.each(search_detail, function (idx, val) {\n                    var max_length = 0;\n                    var show_code = \"\";\n                    var reg = /(^[0-9]+$)|(^[\\u2E80-\\u9FFF]+$)/ig;\n                    if (reg.test(val.value) && code === \"p_sign\" || !val.value) {\n                        return true;\n                    };\n                    $.each(data_nom, function (jj, SD) {\n                        var common_string = '';\n                        if (SD[code] || SD[code + \"_name\"]) {\n                            if (code === 'package' || code === 'p_sign') {\n                                var _after = findSubStr(SD[code].trim(), SD['package'].trim());\n                                var str02 = SD[code].split(_after)[0].trim();\n                                if (code === 'p_sign') {\n                                    common_string = findSubStr(String(val.value).trim(), str02);\n                                } else {\n                                    common_string = findSubStr(String(val.value).trim(), SD['package'].trim());\n                                }\n                            } else {\n                                common_string = findSubStr(String(val.value).trim(), SD[code + '_name'].trim());\n                            };\n                            common_string = common_string.replace(/[-]*/ig, '');\n                            if ((common_string.length >= 3 || common_string.toLocaleUpperCase().indexOf(String(val.value).toLocaleUpperCase().trim()) > -1) && code === \"p_sign\") {\n                                //获取商城型号-后面的\n                                var package_str = findSubStr(String(val.value).trim(), SD['package'].trim());\n                                if (package_str.length > 3) {\n                                    if (common_string.toLocaleUpperCase().indexOf(package_str.toLocaleUpperCase().trim()) > -1) {\n                                        return true;\n                                    } else {\n                                        pre_package.push({ value: package_str });\n                                    };\n                                };\n                                //完全匹配数据\n                                var complete_reg = /(-)/ig;\n                                if (str02.replace(complete_reg, '').toLocaleUpperCase() === String(val.value).replace(complete_reg, '').toLocaleUpperCase().trim() || String(val.value).toLocaleUpperCase().trim() === SD[code].toLocaleUpperCase()) {\n                                    if (complete_data.length > 0) {\n                                        if (!inData(SD.id, complete_data)) {\n                                            complete_data.push(SD);\n                                            if (!inData(SD.id, common_data)) {\n                                                common_data.unshift(SD);\n                                            } else {\n                                                common_data.unshift(SD);\n                                            }\n                                        };\n                                    } else {\n                                        complete_data.push(SD);\n                                        if (!inData(SD.id, common_data)) {\n                                            common_data.unshift(SD);\n                                        } else {\n                                            common_data.unshift(SD);\n                                        }\n                                    }\n                                } else {\n                                    if (SD[code].replace(complete_reg, '').toLocaleUpperCase().indexOf(String(val.value).toLocaleUpperCase().replace(complete_reg, '').trim()) > -1) {\n                                        //包含需求型号\n                                        if (contain_data.length > 0) {\n                                            if (!inData(SD.id, contain_data)) {\n                                                contain_data.push(SD);\n                                                if (!inData(SD.id, common_data)) {\n                                                    common_data.unshift(SD);\n                                                } else {\n                                                    common_data.unshift(SD);\n                                                }\n                                            };\n                                        } else {\n                                            contain_data.push(SD);\n                                            if (!inData(SD.id, common_data)) {\n                                                common_data.unshift(SD);\n                                            } else {\n                                                common_data.unshift(SD);\n                                            }\n                                        }\n                                    } else {\n                                        if (max_length <= common_string.length) {\n                                            max_length = common_string.length, !val.add && (show_code = val.value);\n                                            if (common_data.length > 0) {\n                                                //去重\n                                                if (!inData(SD.id, common_data)) {\n                                                    common_data.unshift(SD);\n                                                    if (length_data[common_string.length]) {\n                                                        length_data[common_string.length].push(SD);\n                                                    } else {\n                                                        length_data[common_string.length] = [SD];\n                                                    }\n                                                };\n                                            } else {\n                                                common_data.unshift(SD);\n                                                if (length_data[common_string.length]) {\n                                                    length_data[common_string.length].push(SD);\n                                                } else {\n                                                    length_data[common_string.length] = [SD];\n                                                }\n                                            }\n                                        } else {\n                                            if (common_data.length > 0) {\n                                                if (!inData(SD.id, common_data)) {\n                                                    common_data.push(SD);\n                                                    if (length_data[common_string.length]) {\n                                                        length_data[common_string.length].push(SD);\n                                                    } else {\n                                                        length_data[common_string.length] = [SD];\n                                                    }\n                                                };\n                                            } else {\n                                                common_data.push(SD);\n                                                if (length_data[common_string.length]) {\n                                                    length_data[common_string.length].push(SD);\n                                                } else {\n                                                    length_data[common_string.length] = [SD];\n                                                }\n                                            }\n                                        };\n                                    };\n                                }\n                            }\n                            //替代料号\n                            if (code === \"p_sign\") {\n                                var replace_pt = '';\n                                var choose_replace = '';\n                                var replace_product_data = SD['fitemno_access'].split(\"{}\");\n                                if (SD[code] && replace_product_data.length > 0) {\n                                    $.each(replace_product_data, function (ll, repl) {\n                                        if (ll > 0) {\n                                            if (code === 'package' || code === 'p_sign') {\n                                                replace_pt = findSubStr(String(val.value).trim(), repl.trim());\n                                            }\n                                            if (repl.toLocaleUpperCase().indexOf(String(val.value).toLocaleUpperCase().trim()) > -1 && replace_pt.length > 3 && !choose_replace) choose_replace = replace_pt;\n                                        }\n                                    });\n                                };\n\n                                if (choose_replace.length >= 3 /*&& complete_data.length<1*/) {\n                                        //去重\n                                        /* if(common_data.length>0){\r\n                                             if(!inData(SD.id,common_data)){\r\n                                                 common_data.push(SD);\r\n                                             };\r\n                                         }else{\r\n                                             common_data.push(SD);\r\n                                         }*/\n                                        if (replace_data.length > 0) {\n                                            if (!inData(SD.id, replace_data)) {\n                                                replace_data.push(SD);\n                                            };\n                                        } else {\n                                            replace_data.push(SD);\n                                        }\n                                    }\n                            } else {\n                                if (max_length <= common_string.length) {\n                                    max_length = common_string.length;\n                                    !val.add && (show_code = val.value);\n                                    if (this_boms.blur) {\n                                        common_data = exchangeArray(SD, this_boms.blur);\n                                        var new_length = !$.isEmptyObject(length_data) ? length_data : $.extend(true, {}, this_boms.blur_length);\n                                        $.each(new_length, function (ind, val_this) {\n                                            if (val) {\n                                                length_data[ind] = exchangeArray(SD, val_this);\n                                            };\n                                        });\n                                    }\n                                    //完全匹配\n                                    if (this_boms.complete) {\n                                        complete_data = exchangeArray(SD, this_boms.complete);\n                                    }\n                                    //替代料号\n                                    if (this_boms.replace) {\n                                        replace_data = exchangeArray(SD, this_boms.replace);\n                                    }\n                                    //全部包含\n                                    if (this_boms.contain) {\n                                        contain_data = exchangeArray(SD, this_boms.contain);\n                                    }\n                                }\n                            }\n                        }\n                    });\n                    show_search_detail[code] = show_code ? String(show_code).trim() : \"\";\n                });\n                $.each(length_data, function (val, ind) {\n                    if (val.length > 20) {\n                        length_data[ind].length = 20;\n                    }\n                });\n                if (pre_package.length > 0) {\n                    var package_exact = function package_exact(array) {\n                        if (!(array instanceof Array)) {\n                            layer.msg('参数错误');\n                            return;\n                        };\n                        var newArray = [],\n                            obj = {};\n                        array.forEach(function (val, ind) {\n                            if (!obj[val.value]) {\n                                obj[val.value] = true;\n                                newArray.push(val);\n                            }\n                        });\n                        return newArray;\n                    };\n                    //去重\n                    pre_package = package_exact(pre_package);\n                };\n\n                return [code === \"p_sign\" && common_data.length > 40 ? common_data.splice(0, 40) : common_data, show_search_detail, complete_data, replace_data, length_data || {}, pre_package || [], contain_data || []];\n            };\n            var code_check = compareString ? compareString : ['cate', 'brand', 'package'];\n            if (searcDatas) {\n                $.each(searcDatas, function (ind, val) {\n                    var this_bom = [[], [], [], [], [], [], []];\n                    var this_showData = {};\n                    $.each(code_check, function (kk, codes) {\n                        if (this_bom[5]) {\n                            this_bom[5].length > 0 && codes === \"package\" && (val[codes] ? val[codes] = val[codes].concat(this_bom[5]) : val[codes] = this_bom[5]);\n                        }\n                        if (val[codes]) {\n                            if (val[codes].length > 0) {\n                                this_bom = match_code2(codes, ind, val[codes], { blur_length: this_bom[4], blur: this_bom[0], complete: this_bom[2], replace: this_bom[3], contain: this_bom[6] });\n                                this_showData = $.extend(this_showData, this_bom[1]);\n                            };\n                        }\n                    });\n                    var this_blur = [];\n                    //json型数组排序\n                    var exchangeArray_brand = function exchangeArray_brand(array) {\n                        if ((typeof array === 'undefined' ? 'undefined' : _typeof(array)) !== \"object\") {\n                            layer.msg('参数错误3');\n                            return [];\n                        };\n                        var brand_first = ['明智类比'];\n                        var newArray = $.extend(true, [], array);\n                        if (array.length > 0) {\n                            var index = -1;\n                            $.each(array, function (ind, val) {\n                                if (val.brand_name) {\n                                    if (brand_first[0] === val.brand_name.trim()) {\n                                        index = ind;\n                                        return false;\n                                    }\n                                }\n                            });\n                            if (index > -1) {\n                                newArray.splice(index, 1);\n                                newArray.unshift(array[index]);\n                            }\n                        }\n                        return newArray;\n                    };\n                    if (!$.isEmptyObject(this_bom[4])) {\n                        var keys = Object.keys(this_bom[4]).sort(function (a, b) {\n                            return a - b;\n                        }).reverse();\n                        if (!val['package']) {\n                            val['package'] = [];\n                        };\n                        keys.forEach(function (val_this, ind) {\n                            var com_array = val['package']['length'] > 0 ? exchangeArray_brand(this_bom[4][val_this]) : this_bom[4][val_this];\n                            this_blur = this_blur.concat(com_array);\n                        });\n                    };\n                    var data_obj = { blur: this_blur || [], complete: this_bom[2] || [], replace: this_bom[3] || [] };\n                    var Array_set = function Array_set() {\n                        var arr1 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n                        var arr2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n                        var arr3 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n\n                        //剔除json重复的id的数组\n                        if (!(arr1 instanceof Array) || !(arr2 instanceof Array) || !(arr3 instanceof Array)) {\n                            layer.msg('参数类型错误');\n                            return;\n                        };\n                        var newArray = [],\n                            againArray = [];\n                        if (arr2.length > 0) {\n                            $.each(arr1, function (val, ind) {\n                                $.each(arr2, function (vxl, idx) {\n                                    if (val.id !== vxl.id) {\n                                        newArray.push(val);\n                                    }\n                                });\n                            });\n                        };\n                        if (arr3.length > 0) {\n                            var this_arr = arr2.length > 0 ? newArray : arr1;\n                            $.each(this_arr, function (val, ind) {\n                                if (arr3.length > 0) {\n                                    $.each(arr3, function (vxl, idx) {\n                                        if (val.id !== vxl.id) {\n                                            againArray.push(val);\n                                        }\n                                    });\n                                }\n                            });\n                        };\n                        if (arr2.length < 1 && arr3.length < 1) {\n                            return arr1;\n                        } else {\n                            return arr3.length > 0 ? againArray : newArray;\n                        };\n                    };\n                    if (data_obj.replace.length > 0 && data_obj.complete.length > 0) {\n                        data_obj.replace = Array_set(data_obj.replace, data_obj.complete);\n                    };\n                    //全部包含，但不等于\n                    if (this_bom[6].length > 0) {\n                        //data_obj.blur=(val['package']['length']>0 ? exchangeArray_brand(this_bom[6]):this_bom[6]);\n                        data_obj.complete = [].concat(_toConsumableArray(data_obj.complete), _toConsumableArray(this_bom[6]));\n                    };\n                    if (data_obj.complete.length > 0 || this_bom[6].length > 0) {\n                        data_obj.complete = [].concat(_toConsumableArray(data_obj.complete), _toConsumableArray(data_obj.replace));\n                        data_obj.replace = [];\n                    };\n                    data_obj.blur = Array_set(data_obj.blur, data_obj.complete, data_obj.replace);\n                    var theExactData = [].concat(_toConsumableArray(data_obj.complete), _toConsumableArray(data_obj.replace), _toConsumableArray(data_obj.blur));\n                    new_data.push({ blur: theExactData || [], mistyNum: data_obj.blur || [], complete: data_obj.complete || [], replace: data_obj.replace || [] });\n\n                    show_searchDatas[ind] = this_showData;\n                });\n            };\n            if (fn) fn([new_data, show_searchDatas]);\n        }\n        //求最长公共字串\n        function findSubStr(str1, str2, isAfter) {\n            var getSubStr = function getSubStr(str1, str2) {\n                if (str1.length > str2.length) {\n                    var temp = str1;\n                    str1 = str2;\n                    str2 = temp;\n                }\n                var len1 = str1.length,\n                    len2 = str2.length;\n                for (var j = len1; j >= 0; j--) {\n                    for (var i = 0; i <= len1 - j; i++) {\n                        var current = str1.substr(i, j);\n                        if (str2.toLocaleUpperCase().indexOf(current.toLocaleUpperCase()) >= 0) {\n                            return current;\n                        }\n                    }\n                }\n                return \"\";\n            };\n            if (isAfter) {\n                var str2_array = str2.split('-');\n                var _before = getSubStr(str1, str2_array[0] || \"\");\n                var _after = getSubStr(str1, str2_array[1] || \"\");\n                return { before: _before, after: _after };\n            } else {\n                return getSubStr(str1, str2);\n            }\n        }\n\n        //提交数据\n        function importExcel(obj, isEaxal, issendData) {\n            layerBox = layer.open({\n                type: 3,\n                icon: 2,\n                content: '<div style=\"color:#fff;margin-left:120px;height:100px;line-height:100px\"> ' + (option.sample ? \"数据导入中\" : \"数据解析中\") + '...</div>', //这里content是一个普通的String\n                success: function success() {\n                    $(\".layui-layer-content.layui-layer-loading2\").css({ width: '300px', height: '100px', 'background-color': '#999', 'background-position': '74px center' });\n                }\n            });\n            var sendData = issendData ? obj[0] : dataHandle(obj, isEaxal);\n            if (sendData.length < 1) {\n                layer.close(layerBox);\n                layer.msg(\"没有匹配到任何数据\");\n                return;\n            };\n            searchDataHandle(sendData, function (data) {\n                var list = {};\n                sendData.forEach(function (val, ind) {\n                    var cates = [],\n                        brands = [];\n                    if (val.cate) {\n                        $.each(val.cate, function (idx, vlx) {\n                            if (!vlx.add) {\n                                cates.push(vlx);\n                            }\n                        });\n                    };\n                    if (val.brand) {\n                        $.each(val.brand, function (idx, vlx) {\n                            if (!vlx.add) {\n                                brands.push(vlx);\n                            }\n                        });\n                    };\n                    sendData[ind].cate = cates;\n                    sendData[ind].brand = brands;\n                });\n                list.sendData = sendData;\n                list.showData = data[1];\n                list.name = obj[1];\n                list.bom = data[0];\n                if (list.bom.length > 0) {\n                    $.each(list.bom, function (ind, val) {\n                        if (val.blur) {\n                            if (val.blur.length > 50) {\n                                if (list.bom.length > 120) {\n                                    list.bom[ind].blur.length = 10;\n                                    list.bom[ind].mistyNum.length = 10;\n                                } else {\n                                    list.bom[ind].blur.length = 50;\n                                    list.bom[ind].mistyNum.length = 50;\n                                }\n                            };\n                        } else {\n                            list.bom[ind] = { blur: [], complete: [], replace: [] };\n                        }\n                    });\n                };\n                if (option.sample) {\n                    option.fn(list);\n                    return;\n                };\n                if (option.mendData) {\n                    option.fn(list);\n                    return;\n                }\n                //console.log('list',list);\n                window.sessionStorage.setItem(\"bomData\", JSON.stringify(list));\n                setTimeout(function () {\n                    layer.close(layerBox);\n                    window.location.href = \"/Home/Default/bomPrice?action=match\";\n                }, 10);\n            });\n            return;\n            $.ajax({\n                url: \"/Home/Bom/bomQuery\",\n                type: 'post',\n                dataType: \"json\",\n                data: { data: sendData },\n                success: function success(e) {\n                    var list = e.data;\n                    list.sendData = sendData;\n                    list.name = obj[1];\n                    if (e.error == 0) {\n                        if (list.bom.length < 1) {\n                            layer.msg(\"没有匹配到任何数据\", { icon: 5 });\n                            return;\n                        };\n                        if (option.sample) {\n                            option.fn(list);\n                            return;\n                        }\n                        returnDataSearch(list, function (handle_data) {\n                            window.sessionStorage.setItem(\"bomData\", JSON.stringify(handle_data));\n                            setTimeout(function () {\n                                layer.close(layerBox);\n                                window.location.href = \"/Home/Default/bomPrice?action=match\";\n                            }, 10);\n                        });\n                        /*window.sessionStorage.setItem(\"bomData\", JSON.stringify(list));\r\n                        setTimeout(function () {\r\n                            layer.close(layerBox);\r\n                            window.location.href = \"/Home/Default/bomPrice?action=match\";\r\n                        }, 10);*/\n                    } else {\n                        modal.confirm({\n                            title: '错误提示',\n                            brief: list.msg,\n                            confirmText: '确定',\n                            top: 100,\n                            confirm: function confirm() {\n                                //location.href = '{:U(\"Home/User/favorite\")}';\n                            }\n                        });\n                    }\n                    //console.log(e);\n                }\n            });\n        };\n        //表头标准字段匹配\n        var check_head = function check_head(sheet) {\n            debugger;\n            var data = window.sessionStorage.getItem(\"bom_searchData\");\n            var searcData_excal = [{ name: \"\", code: \"p_sign\" }, { name: \"\", code: \"package\" }, { name: \"\", code: \"brand\" }, { name: \"\", code: \"cate\" }, { name: \"\", code: \"pnum\" }];\n            var bom_head_temporay = data ? JSON.parse(data) : searcData_excal;\n            var bom_head = {};\n            if (bom_head_temporay instanceof Array) {\n                $.each(bom_head_temporay, function (ind, val) {\n                    bom_head[val.code] = val.name;\n                });\n            } else {\n                bom_head = bom_head_temporay;\n            };\n            var getMode = function getMode(array) {\n                var getOption = function getOption(key) {\n                    var str = '';\n                    var select_option = [{ name: \"需求型号\", code: \"p_sign\" }, { name: \"需求封装\", code: \"package\" }, { name: \"需求品牌\", code: \"brand\" }, { name: \"需求分类\", code: \"cate\" }, { name: \"需求数量\", code: \"pnum\" }];\n                    $.each(select_option, function (ind, val) {\n                        if (bom_head[val.code]) {\n                            var key_array = bom_head[val.code].split(\",\");\n                            if ($.inArray(key, key_array) > -1) {\n                                str += '<option value=\"' + val.code + '\" selected>' + val.name + '</option>';\n                            } else {\n                                str += '<option value=\"' + val.code + '\">' + val.name + '</option>';\n                            }\n                        } else {\n                            str += '<option value=\"' + val.code + '\">' + val.name + '</option>';\n                        }\n                    });\n                    return str;\n                };\n                var str = '';\n                $.each(array, function (ind, val) {\n                    str += '<div class=\"layui-form-item\">\\n' + '    <label class=\"layui-form-label\">' + val + '</label>\\n' + '    <div class=\"layui-input-block\">\\n' + '      <select name=\"' + val + '\" lay-verify=\"required\">\\n' + '        <option value=\"\"></option>\\n' + getOption(val) + '      </select>\\n' + '    </div>\\n' + '  </div>';\n                });\n                return str;\n            };\n            var str = '<form class=\"layui-form\">' + getMode(dataHandle(sheet, false, false, true)) + '</form>';\n            modal.confirm({\n                title: \"表头字段匹配填写\",\n                brief: str,\n                width: \"26vw\",\n                height: \"auto\",\n                maxHeight: \"60vh\",\n                isCenter: true,\n                confirm: function confirm() {\n                    window.sessionStorage.removeItem(\"bom_searchData\");\n                    var formData = $(\".layui-form\").serializeArray();\n                    var save_data = [];\n                    var temparory = {};\n                    formData.forEach(function (val, ind) {\n                        if (val.value) {\n                            if (temparory[val.value]) {\n                                temparory[val.value] = temparory[val.value] + \",\" + val.name;\n                            } else {\n                                temparory[val.value] = val.name + \"\";\n                            }\n                        }\n                    });\n                    $.each(temparory, function (ind, val) {\n                        save_data.push({ name: val, code: ind });\n                    });\n                    //window.sessionStorage.setItem(\"bom_searchData\", JSON.stringify($.extend(true, [], save_data)));\n                    //  console.log(formData,searcData_excal);\n                    debugger;\n                    sheet.push(save_data);\n                    importExcel(sheet, true);\n                    // layer.msg(\"设置成功，请上传excel\");\n                    modal.close();\n                }\n            });\n            $(\".layui-form label\").css(\"width\", \"60px\");\n            form.render();\n        };\n        if (option.importExcel) {\n            var datas = option.importExcelData;\n            importExcel(datas[0], datas[1], datas[2]);\n            return;\n        }\n        var suffix = _this.files[0].name.split(\".\")[_this.files[0].name.split(\".\").length - 1];\n        $('#_file_path').val(_this.files[0].name);\n        if (suffix != 'xls' && suffix != 'xlsx') {\n            layer.msg(\"Only support excel!\");\n            return;\n        }\n        if (_this.files[0].size / 1024 > 5000) {\n            alert(\"The file can not over 4MB\");\n            return;\n        }\n        var f = _this.files[0];\n        var reader = new FileReader();\n        if (rABS) {\n            reader.readAsArrayBuffer(f);\n        } else {\n            reader.readAsBinaryString(f);\n            //reader.readAsText(f,'UTF-8');\n        };\n        reader.onload = function (e) {\n            var data = e.target.result;\n            if (rABS) {\n                wb = XLSX.read(btoa(fixdata(data)), { //手动转化\n                    type: 'base64'\n                });\n            } else {\n                wb = XLSX.read(data, {\n                    type: 'binary'\n                });\n            }\n            //wb.SheetNames[0]是获取Sheets中第一个Sheet的名字\n            //wb.Sheets[Sheet名]获取第一个Sheet的数据\n            /* var a = wb.SheetNames[0];\r\n             var b = wb.Sheets[a]; //内容为方式2\r\n             data = XLSX.utils.sheet_to_json(b); //内容为方式1\r\n             if (!data || data == \"\") {\r\n                 layer.closeAll('loading');\r\n                 layer.msg(\"The file is empty please choose another file!\");\r\n                 return;\r\n             }*/\n            var chooseSheet = function chooseSheet(fn) {\n                var str = '';\n                $.each(wb.SheetNames, function (ind, val) {\n                    if (ind < 1) {\n                        str += '<input type=\"radio\" name=\"sheet\" value=\"' + val + '\" title=\"' + val + '\" checked>';\n                    } else {\n                        str += '<input type=\"radio\" name=\"sheet\" value=\"' + val + '\" title=\"' + val + '\">';\n                    };\n                });\n                modal.confirm({\n                    title: '选择上传表',\n                    brief: '<form class=\"layui-form self-select\">' + '<div class=\"layui-form-item\">\\n' + '    <div class=\"layui-input-block\" style=\"margin-left:0\">\\n' + str + '    </div>\\n' + '  </div></form>',\n                    confirmText: '确定',\n                    confirm: function confirm() {\n                        var a = $('.self-select').serializeArray()[0].value;\n                        var b = wb.Sheets[a]; //内容为方式2\n                        if (fn) fn(b);\n                    }\n                });\n                form.render();\n            };\n            chooseSheet(function (sheet) {\n                if (types == \"standard\") {\n                    if (dataHandle([sheet], true, true)) {\n                        chooseSheet(function (sheet) {\n                            importExcel([sheet, f['name']], true);\n                        });\n                    } else {\n                        modal.confirm({\n                            title: '温馨提示',\n                            brief: '非商城标准格式，如继续上传，可能会影响准确性',\n                            confirmText: '继续上传',\n                            cancelText: '取消',\n                            top: 100,\n                            confirm: function confirm() {\n                                importExcel([sheet, f['name']], true);\n                            },\n                            cancel: function cancel() {\n                                //check_head();\n                            }\n                        });\n                    };\n                } else {\n                    modal.confirm({\n                        title: '温馨提示',\n                        brief: '是否先按商城需求定义表格字段，可以提升匹配准确性',\n                        confirmText: '是',\n                        cancelText: '继续上传',\n                        top: 100,\n                        confirm: function confirm() {\n                            check_head([sheet, f['name']], true, true);\n                        },\n                        cancel: function cancel() {\n                            importExcel([sheet, f['name']]);\n                        }\n                    });\n                };\n            });\n            //清除input的值，使change触发\n            if (!!window.ActiveXObject || \"ActiveXObject\" in window) {\n                // 此处判断是否是IE\n                $(_this).replaceWith($(_this).clone(true));\n            } else {\n                $(_this).val('');\n            }\n        };\n        if (JSON.stringify(XLSX) === '{}') make_xlsx_lib(XLSX);\n    };\n    //window.bomup = bomup;\n    return bomup;\n});"]}