{"version":3,"sources":["Admin/Public/js/tab-controller.js"],"names":["layui","define","exports","element","layer","active_option","default_option","tabFilter","refreshInterval","canRefresh","renderTitle","value","icon","title","getTabs","tabs","window","sessionStorage","getItem","$","parseJSON","e","isArray","deleteTab","id","index","each","i","String","tabDelete","splice","setItem","JSON","stringify","renderIframe","$iframe","attr","data","init","option","extend","active_tab_id","tabAdd","content","url","tabChange","tabElem","on","children","eq","stopPropagation","$li","this","parent","go","tab_id","tab_index","iframLocation","contentWindow","location","pathname","search","href","Date","getTime","length","shift","push","refresh","setTimeout","get","reload","second","toFixed","msg","deleteTabs","ids","time","filter","indexOf"],"mappings":"AAAA,aAEAA,MAAMC,OAAO,CAAC,UAAW,SAAU,SAAUC,GACzC,IAAIC,EAAUH,MAAMG,QAChBC,EAAQJ,MAAMI,MACdC,EAAgB,GAEhBC,EAAiB,CACjBC,UAAW,gBACXC,gBAAiB,KAEjBC,GAAa,EACbC,EAAc,SAAqBC,GACnC,OAAQA,EAAMC,KAAO,iCAAmCD,EAAMC,KAAO,SAAW,IAAM,SAAWD,EAAME,MAAQ,yEAe/GC,EAAU,WACV,IAAIC,EAAOC,OAAOC,eAAeC,QAAQ,QACzC,GAAa,OAATH,EAAe,CACf,IACIA,EAAOI,EAAEC,UAAUL,GACrB,MAAOM,IACT,GAAIF,EAAEG,QAAQP,GACV,OAAOA,EAGf,MAAO,IAGPQ,EAAY,SAAmBC,EAAIC,GACnC,IAAIV,EAAOD,IACNW,GACDN,EAAEO,KAAKX,EAAM,SAAUY,EAAGhB,GACtB,GAAIiB,OAAOjB,EAAMa,MAAQI,OAAOJ,GAE5B,OADAC,EAAQE,GACD,IAInBxB,EAAQ0B,UAAUxB,EAAcE,UAAWiB,GAC3CT,EAAKe,OAAOL,EAAO,GACnBT,OAAOC,eAAec,QAAQ,OAAQC,KAAKC,UAAUlB,KAsBrDmB,EAAe,SAAsBV,GACrC,IAAIW,EAAUhB,EAAE,OAASK,GACfW,EAAQC,KAAK,QAEnBD,EAAQC,KAAK,MAAOD,EAAQE,KAAK,SAGzCnC,EAAQ,gBAAiB,CACrBoC,KAAM,SAAcC,GAChBpB,EAAEqB,OAAOnC,EAAeC,EAAgBiC,GAExC,IAAIxB,EAAOD,IACP2B,EAAgBzB,OAAOC,eAAeC,QAAQ,iBAClDC,EAAEO,KAAKX,EAAM,SAAUU,EAAOd,GAC1B,IAAIE,EAAQH,EAAYC,GACxBR,EAAQuC,OAAOrC,EAAcE,UAAW,CACpCM,MAAOA,EACP8B,QAAS,qBAAuBhC,EAAMiC,IAAM,cAAgBjC,EAAMa,GAAK,eAAiBb,EAAMa,GAAK,aACnGA,GAAIb,EAAMa,KAEVI,OAAOjB,EAAMa,MAAQiB,IACrBP,EAAavB,EAAMa,IACnBrB,EAAQ0C,UAAUxC,EAAcE,UAAWI,EAAMa,OAIzD,IAAIsB,EAAU3B,EAAE,yBAA2Bd,EAAcE,UAAY,KAErEJ,EAAQ4C,GAAG,OAAS1C,EAAcE,UAAY,IAAK,SAAU8B,GACzD,IACIb,EADKsB,EAAQE,SAAS,oBAAoBA,SAAS,MAAMC,GAAGZ,EAAKZ,OACzDW,KAAK,UACjBF,EAAaV,GACbR,OAAOC,eAAec,QAAQ,gBAAiBP,KAGnDsB,EAAQC,GAAG,QAAS,wBAAyB,SAAU1B,GACnDA,EAAE6B,kBACF,IAAIC,EAAMhC,EAAEiC,MAAMC,OAAO,MACrB7B,EAAK2B,EAAIf,KAAK,UACdX,EAAQ0B,EAAI1B,QAAU,EAC1BF,EAAUC,EAAIC,MAGtB6B,GAAI,SAAYf,GACZ,IAAIgB,GAAS,EACTC,GAAY,EACZzC,EAAOD,IAQX,GAPAK,EAAEO,KAAKX,EAAM,SAAUU,EAAOd,GAC1B,GAAIA,EAAME,QAAU0B,EAAO1B,MAGvB,OAFA0C,EAAS5C,EAAMa,GACfgC,EAAY/B,GACL,IAGX8B,EAAQ,CACRpD,EAAQ0C,UAAUxC,EAAcE,UAAWgD,GAC3C,IAAIpB,EAAUhB,EAAE,kBAAoBoC,EAAS,KACzCE,EAAgBtB,EAAQ,GAAGuB,cAAcC,SACzCF,EAAcG,SAAWH,EAAcI,SAAWtB,EAAOK,MACzDT,EAAQ,GAAGuB,cAAcC,SAASG,KAAOvB,EAAOK,KAEpD5B,OAAOC,eAAec,QAAQ,gBAAiBC,KAAKC,UAAUsB,IAC9DxC,EAAKyC,GAAgB,IAAIjB,EAAOK,QAC7B,CACHL,EAAW,IAAI,IAAIwB,MAAOC,UAC1B,IAAInD,EAAQH,EAAY6B,GACxBpC,EAAQuC,OAAOrC,EAAcE,UAAW,CACpCM,MAAOA,EACP8B,QAAS,gBAAkBJ,EAAOK,IAAM,cAAgBL,EAAOf,GAAK,aACpEA,GAAIe,EAAOf,KAEfrB,EAAQ0C,UAAUxC,EAAcE,UAAWgC,EAAOf,IA5IxC,EA6INT,EAAKkD,SACL1C,EAAUR,EAAK,GAAGS,GAAI,GACtBT,EAAKmD,SAETnD,EAAKoD,KAAK5B,GACVvB,OAAOC,eAAec,QAAQ,gBAAiBC,KAAKC,UAAUM,EAAOf,KAEzER,OAAOC,eAAec,QAAQ,OAAQC,KAAKC,UAAUlB,KAEzDqD,QAAS,WACL,GAAI3D,EAAY,CACZA,GAAa,EACb4D,WAAW,WACP5D,GAAa,GACdJ,EAAcG,iBACjB,IAAIiC,EAAgBzB,OAAOC,eAAeC,QAAQ,iBAClDuB,EAAgBA,GAAgC,UAClCtB,EAAE,kBAAoBsB,EAAgB,KAC5C6B,IAAI,GAAGZ,cAAcC,SAASY,QAAO,OAC1C,CACH,IAAIC,GAAUnE,EAAcG,gBAAkB,KAAMiE,QAAQ,GAC5DrE,EAAMsE,IAAI,0BAA4BF,EAAS,YAGvDG,WAnHa,SAAoBC,GACjC,GAAIzD,EAAEG,QAAQsD,GAAM,CAChB,IAAI7D,EAAOD,IACP+D,EAAO,EACX9D,EAAOA,EAAK+D,OAAO,SAAUnE,EAAOc,GAChC,SAAqC,EAAjCmD,EAAIG,QAAQnD,OAAOjB,EAAMa,OACzB6C,WAAW,WACPlE,EAAQ0B,UAAUxB,EAAcE,UAAWI,EAAMa,KAC3C,GAAPqD,GACHA,IACO,MAIf7D,OAAOC,eAAec,QAAQ,OAAQC,KAAKC,UAAUlB,SAErDQ,EAAUqD,IAoGdrD,UAAWA,EACXT,QAASA","file":"../../../../../temporaryJs/Admin/Public/js/tab-controller.js","sourcesContent":["\"use strict\";\n\nlayui.define([\"element\", \"layer\"], function (exports) {\n    var element = layui.element;\n    var layer = layui.layer;\n    var active_option = {};\n    var max_tabs_length = 8;\n    var default_option = {\n        tabFilter: \"tabController\", //添加窗口的filter\n        refreshInterval: 500\n    };\n    var canRefresh = true;\n    var renderTitle = function renderTitle(value) {\n        return (value.icon ? '<i class=\"iconfont-jl icon-jl-' + value.icon + '\"></i>' : '') + '<cite>' + value.title + '</cite>' + '<i class=\"tab-controller-close iconfont-jl icon-jl-close\"></i>';\n    };\n    //判断新跳转内容是否已经存在\n    var isHasTab = function isHasTab(option) {\n        var tab_id = false;\n        var tabs = getTabs();\n        $.each(tabs, function (index, value) {\n            if (value.title === option.title) {\n                tab_id = value.id;\n                return false;\n            }\n        });\n        return tab_id;\n    };\n    //获取sessionStorage中的tabs数据\n    var getTabs = function getTabs() {\n        var tabs = window.sessionStorage.getItem(\"tabs\");\n        if (tabs !== null) {\n            try {\n                tabs = $.parseJSON(tabs);\n            } catch (e) {}\n            if ($.isArray(tabs)) {\n                return tabs;\n            }\n        }\n        return [];\n    };\n    //删除指定id的tab，可以提供index：删除tab在tabs数据中的位置\n    var deleteTab = function deleteTab(id, index) {\n        var tabs = getTabs();\n        if (!index) {\n            $.each(tabs, function (i, value) {\n                if (String(value.id) === String(id)) {\n                    index = i;\n                    return false;\n                }\n            });\n        }\n        element.tabDelete(active_option.tabFilter, id); //自动触发切换事件\n        tabs.splice(index, 1);\n        window.sessionStorage.setItem(\"tabs\", JSON.stringify(tabs));\n    };\n    //删除多个\n    var deleteTabs = function deleteTabs(ids) {\n        if ($.isArray(ids)) {\n            var tabs = getTabs();\n            var time = 0;\n            tabs = tabs.filter(function (value, index) {\n                if (ids.indexOf(String(value.id)) > -1) {\n                    setTimeout(function () {\n                        element.tabDelete(active_option.tabFilter, value.id);\n                    }, time * 60);\n                    time++;\n                    return false;\n                }\n                return true;\n            });\n            window.sessionStorage.setItem(\"tabs\", JSON.stringify(tabs));\n        } else {\n            deleteTab(ids);\n        }\n    };\n    var renderIframe = function renderIframe(id) {\n        var $iframe = $('.jl-' + id);\n        var src = $iframe.attr('src');\n        if (!src) {\n            $iframe.attr('src', $iframe.data('src'));\n        }\n    };\n    exports(\"tabController\", {\n        init: function init(option) {\n            $.extend(active_option, default_option, option);\n            //还原sessionStorage里的窗口\n            var tabs = getTabs();\n            var active_tab_id = window.sessionStorage.getItem(\"active_tab_id\");\n            $.each(tabs, function (index, value) {\n                var title = renderTitle(value);\n                element.tabAdd(active_option.tabFilter, {\n                    title: title,\n                    content: \"<iframe data-src='\" + value.url + \"' data-id='\" + value.id + \"' class='jl-\" + value.id + \"'></frame>\",\n                    id: value.id\n                });\n                if (String(value.id) === active_tab_id) {\n                    renderIframe(value.id);\n                    element.tabChange(active_option.tabFilter, value.id);\n                }\n            });\n            //监听事件\n            var tabElem = $('.layui-tab[lay-filter=' + active_option.tabFilter + ']');\n            //切换事件\n            element.on('tab(' + active_option.tabFilter + ')', function (data) {\n                var li = tabElem.children('.layui-tab-title').children('li').eq(data.index);\n                var id = li.attr('lay-id');\n                renderIframe(id);\n                window.sessionStorage.setItem(\"active_tab_id\", id);\n            });\n            //删除按钮\n            tabElem.on('click', '.tab-controller-close', function (e) {\n                e.stopPropagation();\n                var $li = $(this).parent(\"li\");\n                var id = $li.attr('lay-id');\n                var index = $li.index() - 1;\n                deleteTab(id, index);\n            });\n        },\n        go: function go(option) {\n            var tab_id = false;\n            var tab_index = false;\n            var tabs = getTabs();\n            $.each(tabs, function (index, value) {\n                if (value.title === option.title) {\n                    tab_id = value.id;\n                    tab_index = index;\n                    return false;\n                }\n            });\n            if (tab_id) {\n                element.tabChange(active_option.tabFilter, tab_id);\n                var $iframe = $('iframe[data-id=' + tab_id + ']');\n                var iframLocation = $iframe[0].contentWindow.location;\n                if (iframLocation.pathname + iframLocation.search !== option.url) {\n                    $iframe[0].contentWindow.location.href = option.url;\n                }\n                window.sessionStorage.setItem(\"active_tab_id\", JSON.stringify(tab_id));\n                tabs[tab_index]['url'] = option.url;\n            } else {\n                option['id'] = new Date().getTime();\n                var title = renderTitle(option);\n                element.tabAdd(active_option.tabFilter, {\n                    title: title,\n                    content: \"<iframe src='\" + option.url + \"' data-id='\" + option.id + \"'></frame>\",\n                    id: option.id\n                });\n                element.tabChange(active_option.tabFilter, option.id);\n                if (tabs.length > max_tabs_length) {\n                    deleteTab(tabs[0].id, 0);\n                    tabs.shift();\n                }\n                tabs.push(option);\n                window.sessionStorage.setItem(\"active_tab_id\", JSON.stringify(option.id));\n            }\n            window.sessionStorage.setItem(\"tabs\", JSON.stringify(tabs));\n        },\n        refresh: function refresh() {\n            if (canRefresh) {\n                canRefresh = false;\n                setTimeout(function () {\n                    canRefresh = true;\n                }, active_option.refreshInterval);\n                var active_tab_id = window.sessionStorage.getItem(\"active_tab_id\");\n                active_tab_id = active_tab_id ? active_tab_id : 'default';\n                var $iframe = $('iframe[data-id=' + active_tab_id + ']');\n                $iframe.get(0).contentWindow.location.reload(true);\n            } else {\n                var second = (active_option.refreshInterval / 1000).toFixed(1);\n                layer.msg(\"点击速度超越了服务器的响应速度<br/>还是等\" + second + \"秒再刷新吧！\");\n            }\n        },\n        deleteTabs: deleteTabs,\n        deleteTab: deleteTab,\n        getTabs: getTabs\n    });\n});"]}