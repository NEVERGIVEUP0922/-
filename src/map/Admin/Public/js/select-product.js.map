{"version":3,"sources":["Admin/Public/js/select-product.js"],"names":["layui","define","exports","active_data","isOpen","layer","table","form","laypage","emptyErp","css_obj_self","checkBox","extraData","getData","query","callback","is_open","$","extend","Home","length","get","res","parseJSON","error","data","tips","msg","renderTable","cols","field","width","fixed","templet","title","align","splice","render","elem","list","page","limit","pageSize","cellMinWidth","height","on","$checkboxs","prop","each","this","renderPage","find","count","curr","layout","jump","obj","first","search","val","trim","p_sign","start","css_obj","open","type","skin","area","content","success","focus","css_fn","click","yes","index","layero","$checked","ind","eq","parents","push","close","initInput","selector","need","_this","$this","extra","decodeURIComponent","concat","JSON","parse","siblings","id"],"mappings":"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","file":"../../../../../temporaryJs/Admin/Public/js/select-product.js","sourcesContent":["'use strict';\n\nlayui.define(['layer', 'table', 'form', 'laypage'], function (exports) {\n    var layer = layui.layer;\n    var table = layui.table;\n    var form = layui.form;\n    var laypage = layui.laypage;\n    //\n    var active_data;\n    var isOpen,\n        emptyErp = false,\n        css_obj_self = {};\n    var checkBox = false;\n    var extraData = [];\n    var getData = function getData(query, callback) {\n        if (isOpen) {\n            typeof isOpen == \"string\" ? query.is_open = 1 : query = $.extend(query, isOpen);\n        }\n        if (css_obj_self.Home) {\n            query = $.extend(query, { Home: 'home' });\n        }\n        if (extraData.length > 0) {\n            active_data = extraData;\n            callback(extraData);\n            return;\n        }\n        $.get('/Admin/Product/productList', query, function (res) {\n            res = $.parseJSON(res);\n            //console.log(res);\n            if (res.error === 0) {\n                active_data = res.data;\n                callback(res.data);\n            } else {\n                layer.tips(res.msg, '.modal-search-btn');\n            }\n        });\n    };\n    var renderTable = function renderTable(data) {\n        var cols = [{ field: 'checkbox', width: 60, fixed: 'left', templet: function templet() {\n                var str = checkBox ? '<div ><input class=\"select-modal-checkbox\" lay-filter=\"p_check\" type=\"checkbox\" name=\"\" lay-skin=\"primary\"></div>' : '<div class=\"layui-form-item\">\\n' + '    <div class=\"layui-input-block\" style=\"margin-left:0\">\\n' + '      <input class=\"select-modal-checkbox\" lay-filter=\"p_check\" type=\"radio\" name=\"p_check\" lay-skin=\"primary\">\\n' + '    </div>\\n' + '  </div>';\n                return str;\n            }\n        }, { field: 'id', title: 'id', width: 80 }, { field: 'p_sign', title: '型号', width: 160 }, { field: 'fitemno', title: 'ERP型号', width: 160 }, { field: 'package', title: '封装', width: 100 }, { field: 'brand_name', title: '品牌', width: 100 }, { field: 'cate_name', title: '分类', width: 136, align: \"center\" /*,templet:function(d){\r\n                                                                                                                                                                                                                                                                                                                    return d.show_site == 1 ? \"最新\" :(d.show_site == 2 ? \"推荐\" : \"特卖\" );\r\n                                                                                                                                                                                                                                                                                                                    }*/\n        }];\n        if (emptyErp) {\n            cols.splice(3, 1);\n        }\n        table.render({\n            elem: '.select-modal-table',\n            data: data.list ? data.list : data,\n            page: false,\n            limit: data.pageSize || 10,\n            cellMinWidth: 160,\n            height: '320',\n            cols: [cols]\n        });\n        form.on('checkbox(p_check)', function (data) {\n            var $checkboxs = $('.select-modal-checkbox');\n            //console.log(checkBox,$(data.elem).prop(\"checked\"),$checkboxs);\n            if (checkBox) {\n                if (!$(data.elem).prop('checked')) {\n                    $(data.elem).prop('checked', false);\n                } else {\n                    $(data.elem).prop('checked', true);\n                }\n            } else {\n                $checkboxs.each(function () {\n                    $(this).prop('checked', false);\n                });\n                $(data.elem).prop('checked', true);\n            }\n            form.render('checkbox', 'p_check');\n        });\n    };\n    var renderPage = function renderPage(data) {\n        laypage.render({\n            elem: $('.layui-layer-content').find('.select-modal-page')[0],\n            limit: data.pageSize || 10,\n            count: data.count ? data.count.count : 10,\n            curr: data.page || 1,\n            layout: ['prev', 'page', 'next'],\n            jump: function jump(obj, first) {\n                //console.log(\"obj\",obj);\n                var search = $('.modal-search-input').val().trim();\n                if (!first) {\n                    getData({\n                        page: obj.curr,\n                        pageSize: data.pageSize,\n                        'p_sign': search || \"\"\n                    }, function (data) {\n                        renderTable(data);\n                    });\n                }\n            }\n        });\n    };\n    exports(\"selectProduct\", {\n        start: function start(callback, css_obj) {\n            layer.open({\n                title: '选择商品',\n                type: 0,\n                skin: css_obj.skin ? css_obj.skin : '',\n                area: ['640px', '60vh'],\n                content: '<div class=\"select-modal-container layui-form\"> ' + '<div class=\"select-modal-box\"> ' + '<div class=\"select-search-container\">' + '<input class=\"layui-input modal-search-input\" type=\"text\" placeholder=\"输入商品型号检索\">' + '<div class=\"layui-btn-group\" style=\"margin-top:-4px\"> ' + '<button class=\"layui-btn modal-search-btn\">搜索</button> ' + '<button class=\"layui-btn layui-btn-primary modal-clear-btn\">清空</button> ' + '</div>' + '</div>' + '<table lay-filter=\"select-modal-table\" class=\"select-modal-table\"></table> ' + '<div class=\"select-modal-page\"></div> ' + '</div> ' + '</div>',\n                success: function success() {\n                    $(\".layui-input.modal-search-input\").focus();\n                    if (css_obj.css_fn) css_obj.css_fn();\n                    $('.modal-search-btn').click(function () {\n                        var query = {};\n                        var search = $('.modal-search-input').val().trim();\n                        extraData = [];\n                        if (search) {\n                            query['p_sign'] = search;\n                        }\n                        getData(query, function (data) {\n                            renderTable(data);\n                            renderPage(data);\n                        });\n                    });\n                    $('.modal-clear-btn').on('click', function () {\n                        $('.modal-search-input').val('');\n                        extraData = [];\n                        getData({}, function (data) {\n                            renderTable(data);\n                            renderPage(data);\n                        });\n                    });\n                    getData({}, function (data) {\n                        renderTable(data);\n                        renderPage(data);\n                    });\n                },\n                yes: function yes(index, layero) {\n                    var $checked = $('.layui-layer-content .select-modal-checkbox:checked');\n                    if ($checked.length) {\n                        if (checkBox) {\n                            var data = [];\n                            $checked.each(function (ind, val) {\n                                var eq = $(val).parents('tr').index();\n                                data.push(active_data.list ? active_data.list[eq] : active_data[eq]);\n                            });\n                        } else {\n                            var eq = $checked.parents('tr').index();\n                            var data = active_data.list ? active_data.list[eq] : active_data[eq];\n                        }\n                        callback(data);\n                        layer.close(index);\n                    } else {\n                        layer.tips('请勾选需要操作的数据', '.layui-layer-btn0');\n                    }\n                }\n            });\n        },\n        initInput: function initInput(selector, callback, need, is_open, css_obj) {\n            var _this = this;\n            is_open && (isOpen = is_open);\n            selector = selector ? selector : '.jl-select-product';\n            need = need ? need : 'p_sign';\n            css_obj && (checkBox = css_obj.checkBox ? css_obj.checkBox : false, emptyErp = css_obj.emptyErp || false, css_obj_self = css_obj);\n            $(selector).click(function () {\n                var $this = $(this);\n                var extra = $this.data(\"data\") ? decodeURIComponent($this.data(\"data\")) : \"\";\n                //console.log(extra);\n                extra && (extraData = [].concat(JSON.parse(extra)));\n                _this.start(function (data) {\n                    //console.log('select',data);\n                    $this.val(data[need]);\n                    if ($this.siblings(\"input\")) $this.siblings(\"input\").val(data.id);\n                    $this.data('id', data.id);\n                    if (callback) {\n                        callback(data, $this);\n                    }\n                }, css_obj || {});\n            });\n        }\n    });\n});"]}