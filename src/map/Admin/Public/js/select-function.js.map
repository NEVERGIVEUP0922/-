{"version":3,"sources":["Admin/Public/js/select-function.js"],"names":["layui","define","exports","active_data","isReady","isWaiting","query","callback","layer","form","data","reduce","value","level","$","isArray","each","i","v","name","function_name","children","start","get","res","parseJSON","error","selected","open","title","type","area","content","success","jstree","core","check_callback","multiple","on","e","action","length","node","original","function_id","instance","open_node","parent","get_node","index","id","close_node","yes","layero","close","tips","initInput","selector","need","_this","this","click","$this","val"],"mappings":"AAAA,aAIAA,MAAMC,OAAO,CAAC,QAAS,QAAS,SAAUC,GACtC,IAGIC,EAAaC,EAASC,EACKC,EAAOC,EAJlCC,EAAQR,MAAMQ,MACPR,MAAMS,KAGcH,EAQvB,GAR8BC,EAQ1B,SAAUG,IAElB,SAAUC,EAAOC,EAAOC,GACpBA,EAAQA,GAAgB,EACpBD,GAASE,EAAEC,QAAQH,IACnBE,EAAEE,KAAKJ,EAAO,SAAUK,EAAGC,GACvBA,EAAS,MAAI,GAGTA,EAAQ,KAFE,IAAVL,GACAK,EAAS,MAAU,QAAI,EACXA,EAAEC,MACG,IAAVN,EACKK,EAAEC,KAEFD,EAAEE,cAEdF,EAAEG,UACFV,EAAOO,EAAEG,SAAUR,EAAQ,MAd3C,CADAV,EAAcO,GAoBdN,GAAU,EACNC,GACAiB,KA9BJR,EAAES,IAAI,yBAA0BjB,EAAO,SAAUkB,GAE3B,KADlBA,EAAMV,EAAEW,UAAUD,IACVE,OACJnB,EAASiB,EAAId,QA8BzB,IAAIY,EAAQ,SAAef,GAEnB,IAAIoB,EADJvB,EAEAI,EAAMoB,KAAK,CACPC,MAAO,OACPC,KAAM,EACNC,KAAM,CAAC,QAAS,SAChBC,QAAS,+EACTC,QAAS,WACLnB,EAAE,yBAAyBoB,OAAO,CAC9BC,KAAQ,CACJzB,KAAQP,EACRiC,gBAAkB,EAClBC,UAAY,KAEjBC,GAAG,iBAAkB,SAAUC,EAAG7B,GACjC,GAAoB,gBAAhBA,EAAK8B,QAA4B9B,EAAKiB,SAASc,OAAQ,CACvD,IAAIC,EAAOhC,EAAKgC,KACZC,EAAWD,EAAKC,SACpBhB,IAAWgB,EAASC,aAAcF,EAClChC,EAAKmC,SAASC,UAAUpC,EAAKiB,SAAS,IACtC,IAAIoB,EAASrC,EAAKmC,SAASG,SAASN,EAAKK,QACzCjC,EAAEE,KAAK+B,EAAO1B,SAAU,SAAU4B,EAAOrC,GACjCA,IAAU8B,EAAKQ,IACfxC,EAAKmC,SAASM,WAAWvC,SAM7CwC,IAAK,SAAaH,EAAOI,GACjB1B,GACIpB,GACAA,EAASoB,GAEbnB,EAAM8C,MAAML,IAEZzC,EAAM+C,KAAK,eAAgB,wBAKvClD,GAAY,GAGpBH,EAAQ,iBAAkB,CACtBoB,MAAOA,EACPkC,UAAW,SAAmBC,EAAUlD,EAAUmD,GAC9C,IAAIC,EAAQC,KACZH,EAAWA,GAAsB,sBACjCC,EAAOA,GAAc,OACrB5C,EAAE2C,GAAUI,MAAM,WACd,IAAIC,EAAQhD,EAAE8C,MACdD,EAAMrC,MAAM,SAAUZ,GAClBoD,EAAMC,IAAIrD,EAAKgD,IACXnD,GACAA,EAASG,EAAMoD","file":"../../../../../temporaryJs/Admin/Public/js/select-function.js","sourcesContent":["'use strict';\n\n// <link rel=\"stylesheet\" href=\"__PUBLIC__/Common/module/jstree/3.3.4/themes/default/style.min.css\"/>\n// <script src=\"__PUBLIC__/Common/module/jstree/3.3.4/jstree.min.js\"></script>\nlayui.define(['layer', 'form'], function (exports) {\n    var layer = layui.layer;\n    var form = layui.form;\n    //\n    var active_data, isReady, isWaiting;\n    var getData = function getData(query, callback) {\n        $.get('/Admin/Sys/sysFunction', query, function (res) {\n            res = $.parseJSON(res);\n            if (res.error === 0) {\n                callback(res.data);\n            }\n        });\n    };\n    getData({}, function (data) {\n        active_data = data;\n        (function reduce(value, level) {\n            level = level ? level : 1;\n            if (value && $.isArray(value)) {\n                $.each(value, function (i, v) {\n                    v[\"state\"] = {};\n                    if (level === 1) {\n                        v[\"state\"][\"opened\"] = true;\n                        v['text'] = v.name;\n                    } else if (level === 2) {\n                        v['text'] = v.name;\n                    } else {\n                        v['text'] = v.function_name;\n                    }\n                    if (v.children) {\n                        reduce(v.children, level + 1);\n                    }\n                });\n            }\n        })(active_data);\n        isReady = true;\n        if (isWaiting) {\n            start();\n        }\n    });\n    var start = function start(callback) {\n        if (isReady) {\n            var selected;\n            layer.open({\n                title: '选择功能',\n                type: 0,\n                area: ['370px', '500px'],\n                content: '<div class=\"select-function-tree\" style=\"height: 100%;overflow: auto\"></div>',\n                success: function success() {\n                    $('.select-function-tree').jstree({\n                        'core': {\n                            'data': active_data,\n                            'check_callback': true,\n                            'multiple': false\n                        }\n                    }).on(\"changed.jstree\", function (e, data) {\n                        if (data.action === 'select_node' && data.selected.length) {\n                            var node = data.node;\n                            var original = node.original;\n                            selected = original.function_id ? node : false;\n                            data.instance.open_node(data.selected[0]);\n                            var parent = data.instance.get_node(node.parent);\n                            $.each(parent.children, function (index, value) {\n                                if (value !== node.id) {\n                                    data.instance.close_node(value);\n                                }\n                            });\n                        }\n                    });\n                },\n                yes: function yes(index, layero) {\n                    if (selected) {\n                        if (callback) {\n                            callback(selected);\n                        }\n                        layer.close(index);\n                    } else {\n                        layer.tips('必须选择并且是第三层功能', '.layui-layer-btn0');\n                    }\n                }\n            });\n        } else {\n            isWaiting = true;\n        }\n    };\n    exports(\"selectFunction\", {\n        start: start,\n        initInput: function initInput(selector, callback, need) {\n            var _this = this;\n            selector = selector ? selector : '.jl-select-function';\n            need = need ? need : 'text';\n            $(selector).click(function () {\n                var $this = $(this);\n                _this.start(function (data) {\n                    $this.val(data[need]);\n                    if (callback) {\n                        callback(data, $this);\n                    }\n                });\n            });\n        }\n    });\n});"]}