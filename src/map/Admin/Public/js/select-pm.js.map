{"version":3,"sources":["Admin/Public/js/select-pm.js"],"names":["layui","define","exports","active_data","action","layer","table","form","laypage","getData","query","callback","$","get","res","parseJSON","error","data","tips","msg","renderTable","render","elem","list","page","limit","pageSize","cellMinWidth","height","cols","field","width","fixed","templet","title","d","departmentInfo","department_name","on","$checkboxs","prop","start","open","type","area","content","success","find","count","curr","layout","jump","obj","first","yes","index","layero","$checked","length","each","indexNum","this","parent","push","close","initInput","selector","need","choosePM","_this","attr","JSON","stringify","setTimeout","click","$this","val","id","siblings","uid"],"mappings":"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","file":"../../../../../temporaryJs/Admin/Public/js/select-pm.js","sourcesContent":["'use strict';\n\nlayui.define(['layer', 'table', 'form', 'laypage'], function (exports) {\n    var layer = layui.layer;\n    var table = layui.table;\n    var form = layui.form;\n    var laypage = layui.laypage;\n    //\n    var active_data;\n    var action;\n    var getData = function getData(query, callback) {\n        $.get('/Admin/Sysuser/productLiablePersionList', query, function (res) {\n            res = $.parseJSON(res);\n            if (res.error === 0) {\n                active_data = res.data;\n                callback(res.data);\n            } else {\n                layer.tips(res.msg, '.modal-search-btn');\n            }\n        });\n    };\n    var renderTable = function renderTable(data) {\n        table.render({\n            elem: '.select-modal-table',\n            data: data.list,\n            page: false,\n            limit: data.pageSize,\n            cellMinWidth: 160,\n            height: '360',\n            cols: [[{ field: 'checkbox', width: 50, fixed: 'left', templet: '<div><input class=\"select-modal-checkbox\" lay-filter=\"c_check\" type=\"checkbox\" name=\"\" lay-skin=\"primary\"></div>' }, { field: 'uid', title: '编号' }, { field: 'femplname', title: '产品负责人' }, { field: 'mobile', title: '电话' }, { field: 'email', title: '邮箱' }, { field: 'department_name', title: '部门', templet: function templet(d) {\n                    return d.departmentInfo ? d.departmentInfo.department_name : '';\n                } }]]\n        });\n        form.on('checkbox(c_check)', function (data) {\n            var $checkboxs = $('.select-modal-checkbox');\n            if (!action) {\n                $checkboxs.prop('checked', false);\n                $(data.elem).prop('checked', true);\n            } else {\n                if (!$(data.elem).prop('checked')) {\n                    $(data.elem).prop('checked', false);\n                } else {\n                    $(data.elem).prop('checked', true);\n                }\n            }\n            form.render('checkbox');\n        });\n    };\n    var renderPage = function renderPage(data) {\n        laypage.render({\n            elem: $('.layui-layer-content').find('.select-modal-page')[0],\n            limit: data.pageSize,\n            count: data.count,\n            curr: data.page,\n            layout: ['prev', 'page', 'next'],\n            jump: function jump(obj, first) {\n                if (!first) {\n                    getData({\n                        page: obj.curr,\n                        pageSize: data.pageSize\n                    }, function (data) {\n                        renderTable(data);\n                    });\n                }\n            }\n        });\n    };\n    exports(\"selectPm\", {\n        start: function start(callback) {\n            layer.open({\n                title: '选择产品负责人',\n                type: 0,\n                area: ['640px', '535px'],\n                content: '<div class=\"select-modal-container\"> ' + '<div class=\"select-modal-box\"> ' + '<table lay-filter=\"select-modal-table\" class=\"select-modal-table\"></table> ' + '<div class=\"select-modal-page\"></div> ' + '</div> ' + '</div>',\n                success: function success() {\n                    getData({}, function (data) {\n                        renderTable(data);\n                        renderPage(data);\n                    });\n                },\n                yes: function yes(index, layero) {\n                    var $checked = $('.layui-layer-content .select-modal-checkbox:checked');\n                    if ($checked.length) {\n                        // var eq = $checked.parent().parent().parent().index();\n                        //var data = active_data.list[eq];\n                        var data = [];\n                        $checked.each(function () {\n                            var indexNum = 0;\n                            indexNum = $(this).parent().parent().parent().index();\n                            data.push(active_data.list[indexNum]);\n                        });\n                        callback(data);\n                        layer.close(index);\n                    } else {\n                        layer.tips('请勾选需要操作的数据', '.layui-layer-btn0');\n                    }\n                }\n            });\n        },\n        initInput: function initInput(selector, callback, need, choosePM) {\n            var _this = this;\n            selector = selector ? selector : '.jl-select-pm';\n            need = need ? need : 'uid';\n            action = choosePM;\n            if (choosePM) {\n                _this.start(function (data) {\n                    choosePM.attr(\"data-val\", JSON.stringify(data));\n                    setTimeout(function () {\n                        if (callback) {\n                            callback(data);\n                        }\n                    }, 10);\n                });\n            }\n            $(selector).click(function () {\n                var $this = $(this);\n                _this.start(function (data) {\n                    var data = data[0];\n                    $this.val(data[need]);\n                    $this.data('id', data.id);\n                    if ($this.siblings(\"input\")) $this.siblings(\"input\").val(data.uid);\n                    if (callback) {\n                        callback(data, $this);\n                    }\n                });\n            });\n        }\n    });\n});"]}