"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};layui.define(["table","actionTpl","layer","upload","form","jlTool","selectErpProduct","selectPm","selectProduct"],function(t){var i,s,p,n,u,f,c,y=layui.table,_=layui.actionTpl,m=layui.layer,v=layui.upload,h=layui.form,g=layui.jlTool,b=layui.selectErpProduct,k=layui.selectPm,x=layui.selectProduct,T=[],l={p_sign:"",fitemno:"",product_fitemno:"",pack_unit:"",brand_id:"",delivery:"",fcustitemno:"",fitemno_access:"",package:"",min:"0",fstcb:"",price_section:[{start:"0",end:"100",price_ratio:"2.00"},{start:"100",end:"3000",price_ratio:"1.50"},{start:"3000",end:"0",price_ratio:"1.20"}],min_price:"0",is_tax:"0",tax:"",_tax_disabled:1,discount_num:"0",min_open:"",cate_id:"",parameter:"",describe_image:"",note:"",is_inquiry_table:"",pdf:"",person_liable:"",extraAttr:"",describe:"",show_site:"",unit:"PCS",earnest_scale:"0",search_top:"",is_search_top:"0",volume_length:"",volume_width:"",voltage_output_start:"",voltage_output_end:"",voltage_input_start:"",voltage_input_end:"",current_start:"",current_end:""},j={allchecked:!1,isChoose:!1},w=function(t,e,i){var n=t?C(t.p_sign):C();if(0==i&&n)return e.val(t.fitemno),e.parent().parent().siblings("[data-field=fstcb]").find("div").text(t.fstcb),void e.data("id",t.id);var a=JSON.parse(JSON.stringify(l));t&&(a.fitemno=t.fitemno,a.fstcb=t.fstcb),n.push(a),n=E(n),f.reload({data:n,done:function(){o()}})},C=function(l){var o=[];return $(".layui-show .layui-table-fixed-l>.layui-table-body").find("tr").each(function(t){var i=$(this).parents(".layui-table-fixed-l").siblings(".layui-table-main").find("tr").eq(t),n={},a=this;$.each(c,function(t,e){if("p_sign"===e.field){if(l&&l==$(a).find(".jl-control-p_sign").val())return o=null,!1;n.p_sign=$(a).find(".jl-control-p_sign").val()?$(a).find(".jl-control-p_sign").val().trim():""}else"fstcb"==e.field?n[e.field]=i.find(".laytable-cell-1-"+e.field).text():"input"===e.tplType||"select"===e.tplType||"time"===e.tplType?n[e.field]=i.find(".jl-control-"+e.field).val()?i.find(".jl-control-"+e.field).val().trim():"":"checkbox"===e.tplType?n[e.field]=i.find(".jl-control-"+e.field).prop("checked")?1:0:"scale"===e.tplType?n[e.field]=parseInt(i.find(".jl-control-"+e.field).val())/100:"selectTap"===e.tplType?n[e.field]=i.find(".jl-control-"+e.field).data("option")?i.find(".jl-control-"+e.field).data("option").trim():"":"selectProductTap"===e.tplType?n[e.field]=i.find(".jl-control-"+e.field).data("option")||[]:"selectCategory"===e.tplType?(n.cate_id=i.find(".jl-control-"+e.field).data("id"),n.cate_name=i.find(".jl-control-"+e.field).text()):"describe"===e.tplType?n[e.field]=encodeURIComponent(i.find(".jl-control-"+e.field).data("describe")):"img"===e.tplType?n[e.field]=i.find(".jl-control-"+e.field).data("img")?i.find(".jl-control-"+e.field).data("img").trim():"":"pdf"===e.tplType?n[e.field]=i.find(".jl-control-"+e.field).data("pdf")?i.find(".jl-control-"+e.field).data("pdf").trim():"":"priceInfo"===e.tplType?n[e.field]=$.parseJSON(i.find(".jl-control-"+e.field).siblings().text().trim()):"id"===e.tplType?n[e.field]=$.parseJSON(i.find(".jl-control-"+e.field).text().trim()):"input_input"===e.tplType?(n[e.field]=i.find(".jl-control-"+e.field).val()?i.find(".jl-control-"+e.field).val().trim():"",n[e.field.replace("start","end")]=i.find(".jl-control-"+e.field.replace("start","end")).val()?i.find(".jl-control-"+e.field.replace("start","end")).val().trim():""):"input_volume"===e.tplType?n[e.field]=i.find(".jl-control-"+e.field).val()?i.find(".jl-control-"+e.field).val().trim():"":"extraAttr"===e.tplType&&(n[e.field]=i.find(".jl-control-"+e.field).data("option")?i.find(".jl-control-"+e.field).data("option").trim():"")}),o&&o.push(n)}),o},E=function(t){return t?($.each(t,function(t,e){0===parseInt(e.is_tax)&&(e._tax_disabled=1);var i=parseFloat(e.earnest_scale);e.earnest_scale=i?100*i:0,e.LAY_CHECKED=!1}),t):[]},o=function n(){$(".jl-control-extraAttr").off("click").on("click",function(){var i="",n="",a="",e=this,c=$(e).data("option")?JSON.parse(decodeURIComponent($(e).data("option"))):"",t=c?c.attr_id:"1",l=$(e).parents("tr").find(".jl-control-cate_id").data("id");if(c){T=[],u&&$.each(u,function(t,e){var i=e.cate_id.split(",");-1<$.inArray(l+"",i)&&T.push(e)});var r=0<T.length?T:u,d=[{name:"电流",key:"current",current:"",current_start:"",current_type:"2",current_end:""},{name:"输入电压",key:"voltage_input",voltage_input_start:"",voltage_input_type:"2",voltage_input_end:""},{name:"输出电压",key:"voltage_output",voltage_output_start:"",voltage_output_type:"2",voltage_output_end:""},{name:"体积",key:"volume",volume:"",volume_start:"",current_type:"1",volume_end:""},{name:"属性5",key:"custom",custom:"",custom_start:"",custom_type:"1",custom_end:""},{name:"属性6",key:"custom1",custom1:"",custom1_start:"",custom1_type:"1",custom1_end:""},{name:"属性7",key:"custom2",custom2:"",custom2_start:"",custom2_type:"1",custom2_end:""}],o=$.extend(!0,[],d);if(0<r.length){var s=r[0];o.forEach(function(t,e){t.name=s[t.key],t[t.key+"_value"]=s[t.key+"_value"],t[t.key+"_type"]=s[t.key+"_type"]})}c&&o.forEach(function(t,e){t.name=c[t.key+"_name"],t[t.key+"_type"]=c[t.key+"_type"],t[t.key+"_start"]=c[t.key+"_start"],t[t.key+"_end"]=c[t.key+"_end"],1==t[t.key+"_type"]&&(t[t.key]=c[t.key]),"volume"==t.key&&(t[t.key+"_length"]=c[t.key+"_length"]||"",t[t.key+"_width"]=c[t.key+"_width"]||"")}),$.each(o,function(t,e){e.name&&(1<e[e.key+"_type"]?n+=_.input_area(e.key,e):e[e.key+"_value"]?a+=_.selectAttr(e):i+=_.input_input(e))});var p='<form class="layui-form">'+_.selectAttr(t,r||[])+'<div class="input-container">'+a+i+n+"</div></form>";m.open({title:"其他属性",area:["30vw","auto"],content:p,success:function(){h.render(),h.on("select(attrSelect)",function(t){var n=$(t.elem).val(),a=r.filter(function(t,e){if(t.id==n)return t}),e=$.extend(!0,[],d);"0"!=n&&e.forEach(function(t,e){if(c.attr_id==a[0].id)t.name=c[t.key+"_name"],t[t.key+"_type"]=c[t.key+"_type"],t[t.key+"_value"]=r[0][t.key+"_value"]||"",t[t.key+"_start"]=c[t.key+"_start"],t[t.key+"_end"]=c[t.key+"_end"],"volume"===t.key&&(t[t.key+"_length"]=c[t.key+"_length"],t[t.key+"_width"]=c[t.key+"_width"]),1===Number(t[t.key+"_type"])&&(t[t.key]=c[t.key]);else{var i=function(i,t){if("string"==typeof i&&t instanceof Array){var n={};return $.each(t,function(t,e){if(String(i)===String(e.id))return(n=$.extend(!0,{},e)).index=t,!1}),n}m.msg("数据类型错误")}(n,r);i.id&&(t.name=a[0][t.key],t[t.key+"_type"]=a[0][t.key+"_type"],t[t.key+"_value"]=r[i.index][t.key+"_value"]||"",t[t.key+"_start"]="",t[t.key+"_end"]="",1==t[t.key+"_type"]&&(t[t.key]=""))}});var i="",l="",o="";$.each(e,function(t,e){e.name&&(1<e[e.key+"_type"]?l+=_.input_area(e.key,e):e[e.key+"_value"]?o+=_.selectAttr(e):i+=_.input_input(e))}),$(".input-container").html(o+i+l),h.render()})},yes:function(){var t=$(".layui-form").serializeArray(),i={},n=!0;0<t.length&&t.forEach(function(t,e){i[t.name]=t.value;/(_start)|(_end)|(_length)|(_width)/gi.test(t.name)&&t.value&&(n=!1)}),n?$(e).css("background-color","#c2c2c2"):$(e).css("background-color","#009688"),$(e).data("option",encodeURIComponent(JSON.stringify(i))),m.closeAll()},btn2:function(){}})}}),$(".img-pdf").html('<button class="layui-btn action-product action-upload-img action-all-img " data-type="all-imgs">产品图片</button>\n                <button class="layui-btn action-product action-upload-pdf " data-type="all-pdf">产品规格书</button>'),initInput({package:".layui-form-label-pinyin-package"}),b.initInput(".jl-select-erp-product",function(t,e){e.parent().parent().siblings('td[data-field="fstcb"]').children().text(t.fstcb)},w,s.action),x.initInput(".jl-select-product",function(t,e){var i=C();i[e.parents("tr").data("index")]=t,i=E(i),f.reload({data:i,done:function(){}}),n()}),$(".select-tap").click(function(){var n=$(this),t=n.data("option")||n.attr("data-option");t="object"!=(void 0===t?"undefined":_typeof(t))?t?t.split("{}"):[]:"";var i='<div class="action-tpl-tap-box"><div class="action-tpl-tap-list">',a=function(t){return'<div class="action-tpl-tap-section"> <input type="text" autocomplete="off" class="layui-input" value="'+t+'"> <button class="layui-btn layui-btn-primary action-tpl-tap-delete"> <i class="iconfont-jl icon-jl-delete_fill"></i> </button> </div> '};$.each(t,function(t,e){e.trim()&&(i+=a(e))}),i+='<div class="action-tpl-tap-section"> <input type="text" autocomplete="off" class="layui-input" value=""> <button class="layui-btn layui-btn-primary action-tpl-tap-delete"> <i class="iconfont-jl icon-jl-delete_fill"></i> </button> </div> ',m.open({title:"替代料号",type:0,content:i,success:function(){$(".action-tpl-tap-list").on("click",".action-tpl-tap-delete",function(){$(this).parents(".action-tpl-tap-section").remove()}),$(".action-tpl-tap-add").click(function(){var t=$(this).siblings("input"),e=t.val().trim();e&&(t.val(""),$(".action-tpl-tap-list").append(a(e)))})},yes:function(t,e){var i=[];$(".action-tpl-tap-section").each(function(){var t=$(this).children(".layui-input").val().trim();t&&i.push(t)}),n.data("option",0<i.length?i.join("{}"):""),i?n.css("background-color","#009688"):n.css("background-color","#c2c2c2"),m.close(t)}})}),$(".select-erp-tap").click(function(){var n=this,a=$(n).data("option")||[];if(a.length<1){var t=$.parseJSON($(n).prev().text())||[];$.each(t,function(t,e){a.push(e.fitemno)})}var i="";$.each(a,function(t,e){i+='<div ><span style="display:inline-block;margin:5px 0;border:1px solid #ddd;cursor:pointer;padding:5px 10px;width: 76%">'+e+'</span> <i class="iconfont-jl icon-jl-delete_fill erp-delete" style="cursor:pointer;color:red;display:inline-block;padding:5px"></i></div>'});var e=i+'<div class=" erp_add price-section-add" style=\'padding-top:4px;border:1px solid #e6e6e6\'> <i class="iconfont-jl icon-jl-addition_fill"></i> </div>',l=[];m.open({title:"添加关联ERP型号",type:0,area:["30%"],content:e,btn:["确定","取消"],success:function(){b.initInput(".erp_add",function(t){var i=[];l=[],$.each(t,function(t,e){-1==a.indexOf(e.fitemno)&&i.push(e.fitemno)}),0<a.length&&(l=a.concat(i)),l=0<l.length?l:i,$(n).data("option",l),$(n).prev("span").text(JSON.stringify(l)),$(n).css("background-color","#009688")},!1,!1),$(".erp-delete").on("click",function(){var t=$(n).data("option")||[];$(this).parent().remove(),t.splice(t.indexOf($(this).prev().text()),1),$(n).data("option",t),$(n).prev("span").text(JSON.stringify(t))})},yes:function(t,e){0==l.length||a.length<1?$(n).css("background-color","#c2c2c2"):$(n).css("background-color","#009688"),m.closeAll()}})}),$(".layui-show .layui-table-fixed-l>.layui-table-body").find("tr").each(function(t){var e=$(this).parents(".layui-table-fixed-l").siblings(".layui-table-main").find("tr").eq(t),i=e.find(".jl-control-product_fitemno").data("option")||[];if(i.length<1){var n=$.parseJSON(e.find(".jl-control-product_fitemno").prev("span").text())||[];$.each(n,function(t,e){i.push(e.fitemno)})}e.find(".jl-control-product_fitemno").data("option",i)});var l,a=!1,o=null,e=null;function c(t,n){var a,l=$(t);l.data("id");m.open({title:"选择分类",type:0,content:'<div class="jstree-div"></div>',success:function(){(function i(t){t&&$.isArray(t)&&$.each(t,function(t,e){e.text=e.cate_name,e.children&&i(e.children)})})(p.category);$(".jstree-div").jstree({core:{data:[{text:"商品分类",state:{opened:!0},children:p.category}]}}).on("changed.jstree",function(t,e){if("select_node"===e.action&&e.selected.length){var i=e.instance.get_node(e.selected[0]);a=0===i.children.length&&i}})},yes:function(t,e){if(a){if(T=[],l.data("id",a.id),l.parents("tr").find(".jl-control-extraAttr").data("option",""),n||l.data("text",a.text).text(a.text),n){var i={cate_id:a.id,cate_name:a.text};n(i)}m.close(t)}else m.tips("必须选择并且是最底层分类",".layui-layer-btn0")}})}function r(t,n){var a=$(t),e=function t(e){var i=e;return e?/(<p>)+|[\u2E80-\u9FFF]+/g.test(e+"")?i:t(decodeURIComponent(e+"")):e}(-1<(a.data("describe")+"").indexOf("null")?"":a.data("describe")),i=m.open({title:"产品描述",type:0,content:'<script id="describe-container" name="content" type="text/plain">'+e+"<\/script>",success:function(){$(".layui-layer-shade").css({"z-index":"1000"}),$(".layui-layer.layui-layer-dialog").css({"z-index":"1000"}),setTimeout(function(){$(".layui-layer-btn").css({"text-align":"center"});var t=$(".layui-layer-content").height();l=UE.getEditor("describe-container",{autoHeightEnabled:!0,scaleEnabled:!1,allowDivTransToP:!1,initialFrameWidth:1162,initialFrameHeight:t-120,topOffset:43}),setTimeout(function(){$($("#ueditor_0").contents()[0]).find("body").css({width:"1160",margin:"0 auto"}).addClass("containers"),$("#describe-container>div").css("margin","0 auto")},100)},200)},end:function(){l.destroy()},yes:function(t,e){var i=l.getContent();a.data("describe",encodeURIComponent(i)),n&&n(encodeURIComponent(i)),m.close(t)}});m.full(i)}y.on("checkbox(editable)",function(t){var e=C();if("all"!=t.type)j.all="one",t.checked?j[t.data.LAY_TABLE_INDEX]=!0:j[t.data.LAY_TABLE_INDEX]=!1,$.each(j,function(t,e){if(0<=Number(t)){if(e)return!(j.isChoose=!0);j.isChoose=!1}});else if(t.checked){j.all="all",j.allchecked=!0,j.isChoose=!0;for(var i=0;i<e.length;i++)j[i]=!0}else{j.all="null",j.allchecked=!1,j.isChoose=!1;for(i=0;i<e.length;i++)j[i]=!1}}),$(".action-product").off("click").on("click",function(){a=!0;var t=$(this).data("type"),i=C(),l=($.extend(!0,{},i),j);if(!l.isChoose)return a=!1,void m.tips("请勾选商品",this,{duration:2e3});switch(t){case"all-cate":c(this,function(t){var e,a;i=E(i),e=i,a=t,$.each(e,function(i,n){"all"==l.all?(n.cate_id=a.cate_id,n.cate_name=a.cate_name,n.LAY_CHECKED=!0):"one"==l.all&&$.each(l,function(t,e){i==t&&e&&(n.cate_id=a.cate_id,n.cate_name=a.cate_name,n.LAY_CHECKED=!0)})}),f.reload({data:e,done:function(){n()}})});break;case"all-productDetail":r(this,function(a){i=E(i),$.each(i,function(i,n){"all"==l.all?(n.describe=a,n.LAY_CHECKED=!0):"one"==l.all&&$.each(l,function(t,e){i==t&&e&&(n.describe=a,n.LAY_CHECKED=!0)})}),f.reload({data:i}),n()});break;case"all-imgs":!0,$(".action-upload-img").removeClass("active-upload"),i=E(i),$(this).addClass("active-upload"),o=function(a){$.each(i,function(i,n){"all"==l.all?(n.describe_image?n.describe_image+=";"+a:n.describe_image+=a,n.LAY_CHECKED=!0):"one"==l.all&&$.each(l,function(t,e){i==t&&e&&(n.describe_image?n.describe_image+=";"+a:n.describe_image+=a,n.LAY_CHECKED=!0)})}),f.reload({data:i,done:function(){n()}})};break;case"all-pdf":$(".action-upload-pdf").removeClass("active-upload"),i=E(i),$(this).addClass("active-upload"),e=function(a){$.each(i,function(i,n){"all"==l.all?(n.pdf=a,n.LAY_CHECKED=!0):"one"==l.all&&$.each(l,function(t,e){i==t&&e&&(n.pdf=a,n.LAY_CHECKED=!0)})}),f.reload({data:i,done:function(){n()}})}}}),$(".select-category").click(function(){c(this,!1)}),$(".describe-tpl").click(function(){r(this,!1)}),$(".action-upload-img-self").off("click").on("click",function(){a=!0,$(".action-upload-img").removeClass("active-upload"),!1,$(this).addClass("active-upload")});v.render({elem:".action-upload-img",url:"/admin/excel/fileUpload",data:{path:"product"},done:function(t){if(0===t.error){if(!a)return void m.msg("请选择商品");var e=$(".action-upload-img.active-upload").siblings(".jl-control-describe_image").data("img");e?e+=";"+t.data.path:e=t.data.path,$(".action-upload-img.active-upload").siblings(".jl-control-describe_image").data("img",e).css("background-color","#009688"),o&&o(e),i(e)}else m.msg(t.msg)}});function i(t,i){var e=t.split(";"),n="";$.each(e,function(t,e){n+='<div style="width: 150px;height: 150px;float:left;margin:4px;position:relative"><span style="position:absolute;top: -4px;right: -4px;width: 20px; height: 20px;line-height: 20px;background-color: black;color: #fff;border-radius: 50%;cursor: pointer;">X</span><img style="width: 150px;height: auto;vertical-align: middle;cursor: pointer" src="'+e+'"/></div>'}),m.open({title:"产品描述",type:0,content:'<div class="action-product-imgs" style="text-align: center;overflow:hidden">'+n+"</div>",success:function(){$(".action-product-imgs").find("span").on("click",function(){$(this).parent().remove()})},yes:function(){var e="";$(".action-product-imgs").find("img").each(function(t){e+=0==t?$(this).attr("src"):";"+$(this).attr("src")});var t={"background-color":"#009688"};e||(t["background-color"]="#c2c2c2"),i?$(i).data("img",e):$(".action-upload-img.active-upload").siblings(".jl-control-describe_image").data("img",e),i&&$(i).css(t),setTimeout(function(){$(".action-upload-img").removeClass("active-upload")},200),m.closeAll()}})}$(".jl-control-describe_image").click(function(){var t=$(this).data("img");t?i(t,this):m.msg("没有图片")}),$(".action-upload-pdf-self").click(function(){a=!0,$(".action-upload-pdf").removeClass("active-upload"),$(this).addClass("active-upload")});v.render({elem:".action-upload-pdf",url:"/admin/excel/fileUpload",accept:"file",exts:"pdf",data:{path:"productPdf"},done:function(t){if(0===t.error){if(!a)return void m.msg("请选择商品");$(".action-upload-pdf.active-upload").siblings(".jl-control-pdf").data("pdf",t.data.path).css("background-color","#009688"),e&&e(t.data.path),m.msg("上传成功"),g.sendIframeMsg("new",{url:t.data.path})}else m.msg(t.msg)}});$(".jl-control-pdf").click(function(){var t=$(this).data("pdf");t?g.sendIframeMsg("new",{url:t}):m.msg("没有规格书")});var d=function(t){return t.start=parseInt(t.start),t.end=parseInt(t.end),'<tr> <td class="price-asction-start"><input class="layui-input price-section-start-input" type="number" value="'+t.start+'"/></td> <td class="price-asction-end">'+(0===t.end?"以上":t.end-1)+'</td> <td><input class="layui-input price-asction-ratio" type="number" value="'+t.price_ratio+'"/></td> <td> <div class="price-section-delete"> <i class="iconfont-jl icon-jl-delete_fill"></i> </div> </td> </tr> '};$(".price-tpl").click(function(){var e=$(this),t=$.parseJSON(e.siblings().text()),i="";t&&$.isArray(t)?$.each(t,function(t,e){i+=d(e)}):i+=d({start:0,end:0}),m.open({title:"区间数量及区间比例设置",type:0,area:"440px",content:'<div class="price-section-container"> <table class="layui-table price-section-table" lay-size="sm"> <colgroup><col width="100"><col width="100"><col width="100"><col width="120"></colgroup> <thead><tr><th>开始数量</th><th class="end-tips-mark">结束数量</th><th class="ratio-tips-mark">区间比例</th><th>操作</th></tr></thead> <tbody class="price-section-list"> '+i+'</tbody> </table> <div class="price-section-add"> <i class="iconfont-jl icon-jl-addition_fill"></i> </div> </div>',success:function(){var a=!1;$(".price-section-add").click(function(){a||(a=!0,$(".price-section-list").append('<tr class="price-section-new"> <td><input class="layui-input price-add-input" type="number" value=""/></td> <td>以上</td> <td><input class="layui-input price-ratio-input" type="number" value=""/></td> <td> <div> <div class="layui-btn-group"> <button class="layui-btn layui-btn-sm price-add-confirm">确定</button> <button class="layui-btn layui-btn-sm price-add-cancel">取消</button> </div> </div> </td> </tr> '))});var t=$(".price-section-list");t.on("click",".price-section-delete",function(){var t=$(this).parent().parent();t.prev().find(".price-asction-end").text("以上"),t.remove()}),t.on("change",".price-section-start-input",function(){var t=$(this).parent().parent(),e=parseInt(t.prev().find(".price-section-start-input").val()),i=parseInt(t.find(".price-asction-end").text()),n=parseInt($(this).val());if((!e||e<n)&&(!i||n<i))t.prev().find(".price-asction-end").text(n-1);else{var a=parseInt(t.prev().find(".price-asction-end").text());$(this).val(a+1),m.tips("修改值需大于"+e+(i?",并且小于"+i:""),".end-tips-mark")}}),t.on("click",".price-add-confirm",function(){var t=$(this).parents(".price-section-new"),e=t.prev().find(".price-section-start-input").val(),i=t.find(".price-add-input").val(),n=t.find(".price-ratio-input").val();(i=parseInt(i))>parseInt(e)?(a=!1,t.prev().find(".price-asction-end").text(i-1),t.parent().append(d({price_ratio:n,start:i,end:0})),t.remove()):m.tips("新区间开始数量需大于"+e,".price-add-confirm")}),t.on("click",".price-add-cancel",function(){a=!1,$(this).parents(".price-section-new").remove()})},yes:function(t){var a=[],l=!0;$(".price-section-list").children("tr").each(function(){var t=$(this);if(!t.hasClass("price-section-new")){var e=parseInt(t.find(".price-section-start-input").val()),i=parseInt(t.find(".price-asction-end").text()),n=t.find(".price-asction-ratio").val();if(!n.trim())return l=!1;a.push({start:e||0,end:i?i+1:0,price_ratio:n})}}),l?(e.siblings().text(JSON.stringify(a)),m.close(t)):m.tips("请填写完整区间比例",".ratio-tips-mark")}})}),k.initInput()};t("actionTable",{init:function(t){var e;i=t.productList?E(t.productList.list):[],s=t.request,p=t.categoryTree,n=t.brandList,u=t.attributeList,l.person_liable=t.adminFront.uid,e="edit"===s.action?i:[l],console.log("data",e,s,u,p),c=[{field:"p_sign",title:"型号",fixed:"left",tplType:"input",templet:"edit"===s.action?_.inputReadOnly("p_sign"):_.input("p_sign")},{field:"fitemno",title:"ERP型号",tplType:"input",templet:_.selectErpProduct("fitemno")},{field:"product_fitemno",width:120,align:"center",title:"多关联",tplType:"selectProductTap",templet:function(t){return _.select_erp_Tap("product_fitemno",t)}},{field:"package",title:"封装",tplType:"input",templet:function(t){return'<div><input type="text" value="'+t.package+'" name="package_title"  class="layui-input jl-control-package  layui-form-label-pinyin-package" ></div>'}},{field:"brand_id",title:"品牌",width:160,tplType:"select",templet:_.selectBrand("brand_id",n)},{field:"delivery",title:"交期",width:105,tplType:"input",templet:_.input_delivery("delivery")},{field:"fitemno_access",width:100,title:"替代料号",tplType:"selectTap",templet:function(t){return _.selectTap("fitemno_access",t)}},{field:"pack_unit",title:"包装形态",width:105,tplType:"select",templet:_.select("pack_unit",[{title:"",value:""},{title:"盘",value:"盘"},{title:"管",value:"管"},{title:"袋",value:"袋"},{title:"托盘",value:"托盘"}])},{field:"unit",title:"单位",width:105,tplType:"input",templet:_.input("unit")},{field:"min",title:"最小包装数",width:105,tplType:"input",templet:_.input("min")},{field:"fstcb",title:"标准成本",width:105},{field:"price_section",width:130,title:"区间数量/价格",tplType:"priceInfo",templet:_.priceInfo("price_section")},{field:"earnest_scale",title:"定金比例",width:125,tplType:"scale",templet:_.input_earnest("earnest_scale")},{field:"min_price",title:"建议最低价",width:105,tplType:"input",templet:_.input("min_price")},{field:"is_tax",title:"进项",width:60,align:"center",tplType:"checkbox",templet:_.checkbox("is_tax")},{field:"tax",title:"开票税点",width:100,tplType:"select",templet:_.select("tax",[{title:"10%",value:"1.10"},{title:"11%",value:"1.11"},{title:"12%",value:"1.12"},{title:"13%",value:"1.13"},{title:"14%",value:"1.14"},{title:"15%",value:"1.15"},{title:"16%",value:"1.16"},{title:"17%",value:"1.17"}])},{field:"discount_num",title:"折扣限",tplType:"input",templet:_.inputNum("discount_num")},{field:"min_open",title:"是否拆",width:105,tplType:"select",templet:_.select("min_open",[{title:"拆",value:"1"},{title:"不拆",value:"0"}])},{field:"cate_id",title:"分类",width:130,tplType:"selectCategory",templet:_.selectCategory("cate_id",p.category)},{field:"parameter",title:"简要描述",tplType:"input",templet:_.input("parameter")},{field:"describe",title:"产品描述",width:90,align:"center",tplType:"describe",templet:_.describe("describe")},{field:"show_site",title:"展示状态",width:105,tplType:"select",templet:_.select("show_site",[{title:"无",value:""},{title:"最新",value:"1"},{title:"推荐",value:"2"},{title:"特卖",value:"3"}])},{field:"note_isshow",title:"是否显示备注",tplType:"checkbox",width:120,align:"center",templet:_.checkbox("note_isshow")},{field:"search_top",title:"主推型号",tplType:"input",templet:_.input("search_top")},{field:"is_search_top",title:"是否头条",tplType:"checkbox",width:100,align:"center",templet:_.checkbox("is_search_top")},{field:"note",title:"备注",tplType:"input",templet:_.input("note")},{field:"is_inquiry_table",title:"报备表",width:80,align:"center",tplType:"checkbox",templet:_.checkbox("is_inquiry_table")},{field:"describe_image",title:"产品图片",tplType:"img",width:130,templet:function(t){return _.img("describe_image",t)}},{field:"pdf",title:"产品规格书",tplType:"pdf",width:200,templet:function(t){return _.pdf("pdf",t)}},{field:"extraAttr",width:120,title:"其他属性",tplType:"extraAttr",templet:function(i){var n,t=[{name:"电流",key:"current",current:"",current_start:"",current_type:"2",current_end:""},{name:"输入电压",key:"voltage_input",voltage_input_start:"",voltage_input_type:"2",voltage_input_end:""},{name:"输出电压",key:"voltage_output",voltage_output_start:"",voltage_output_type:"2",voltage_output_end:""},{name:"体积",key:"volume",volume:"",volume_start:"",current_type:"1",volume_end:""},{name:"属性5",key:"custom",custom:"",custom_start:"",custom_type:"1",custom_end:""},{name:"属性6",key:"custom1",custom1:"",custom1_start:"",custom1_type:"1",custom1_end:""},{name:"属性7",key:"custom2",custom2:"",custom2_start:"",custom2_type:"1",custom2_end:""}];if("edit"===s.action){var a=i.attr_list,e=!1,l=0;n={attr_id:i.attr_id||"1",volume_name:"体积",volume_type:"1",volume:"",current_name:"电流",current_type:"2",current_start:"",current_end:"",voltage_input_name:"输入电压",voltage_input_type:"2",voltage_input_start:"",voltage_input_end:"0",voltage_output_name:"输出电压",voltage_output_type:"2",voltage_output_start:"",voltage_output_end:""},t.forEach(function(t,e){a.id?a[t.key]?(n[t.key+"_name"]=a[t.key],n[t.key+"_type"]=a[t.key+"_type"],n[t.key+"_value"]=i[t.key+"_value"]||"",n[t.key+"_start"]=i[t.key+"_start"]||"",n[t.key+"_end"]=i[t.key+"_end"]||"",1==n[t.key+"_type"]&&(n[t.key]=i[t.key]||""),"volume"==t.key?(n[t.key+"_length"]=i[t.key+"_length"]||"",n[t.key+"_width"]=i[t.key+"_width"]||"",1<n[t.key+"_type"]?i[t.key+"_length"]||i[t.key+"_width"]||l++:i[t.key+"_length"]||l++):1<n[t.key+"_type"]?i[t.key+"_start"]||i[t.key+"_end"]||l++:i[t.key+"_start"]||l++):(l++,n[t.key+"_name"]=""):n=""})}else n="";return e=l===t.length,'<div><button data-option="'+(n?encodeURIComponent(JSON.stringify(n)):"")+'" class="layui-btn layui-btn-sm jl-control-extraAttr" style="background-color:'+(n?e?"#c2c2c2":"#009688":"#c2c2c2")+'">查看其他属性</button></div>'}},{field:"handle",title:"操作",toolbar:"#handle-tpl",fixed:"right",width:170}],"edit"===s.action&&c.unshift({field:"id",title:"产品id",fixed:"left",align:"center",width:70,tplType:"id",templet:_.id("id")}),c.unshift({field:"checkbox",type:"checkbox",width:50,fixed:"left"}),f=y.render({elem:"#editable-table",height:"full-196",id:"product",data:e,page:!1,cellMinWidth:160,cols:[c],limit:50,done:function(){$(".layui-form tr td").find("div.layui-table-cell").css("line-height","40px")}}),o(),y.on("tool(editable)",function(a){"del"===a.event&&m.confirm("删除只是放弃编辑这一行，不会影响数据",function(t){var e,i,n=a.data.id;n?(e=C(),$.each(e,function(t,e){if(e.id==n)return i=t,!1}),i&&e.splice(i,1)):(a.tr.remove(),e=C()),f.reload({data:e}),o(),m.close(t)})}),h.on("checkbox(checkbox)",function(t){})},addRow:w,getData:C,handleData:E})});