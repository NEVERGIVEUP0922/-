"use strict";define(["jquery","Toolkit/handle-district","jl-modal"],function(u,r,j){var m=function(n,i,e){"error"===i?n.addClass("js-input-error").siblings(".jl-input-error-icon").addClass("jl-cur"):"pass"===i&&n.removeClass("js-input-error").siblings(".jl-input-error-icon").removeClass("jl-cur")};u(".js-check-input").on("blur",function(){var n=u(this),i=u.trim(n.val()),e=new RegExp("^(\\-|\\+)?\\d+(\\-\\d+)?$");""===i?m(n,"error",this.name):n.hasClass("js-check-input-phone")&&11!==i.length?m(n,"error",this.name):n.hasClass("js-check-input-phone-2")&&!e.test(i)?m(n,"error",this.name):m(n,"pass")});var v=function(n,i,e){"error"===i?n.siblings(".jl-input-error-icon").addClass("jl-cur").siblings(".jl-y-select").addClass("js-input-error"):"pass"===i&&n.siblings(".jl-input-error-icon").removeClass("jl-cur").siblings(".jl-y-select").removeClass("js-input-error")};return u(".jl-check-address").on("change",function(){var n=u(this),i=u.trim(n.val());v(n,""===i?"error":"pass")}),{address:{init:function(n,i){var a=n,r=this,l=u(".js-address-list"),t=u(".js-address-empty"),o=u(".js-popup-consignee");if(a&&a.length&&0!==a.length){t.hide(),l.show(),a[0].active=!0,u.each(a,function(n,i){"1"===i.status&&(a[0].active=!1)});var e=r.builtAddressHtml(a);l.html(e);var s=r.builtShortHtml(a[0]);u(".js-selected-address").html(s)}else t.show(),l.hide();u(".js-address-add").on("click",function(){o.show()}),o.find(".jl-close").on("click",function(){o.hide()}),o.find(".jl-popup-submit").on("click",function(){var e=!0,s={};o.find("input").each(function(){var n=u(this),i=u.trim(n.val());""===i?("company_area"===this.name?v(n,"error"):m(n,"error",this.name),e=!1):"mobile"===this.name&&11!==i.length&&(m(n,"error"),e=!1),s[this.name]=i}),s.area_code=s.company_area,e&&u.post(i,s,function(n){if(0===(n=u.parseJSON(n)).error){if(o.hide(),s.id=n.data.address_id,0===l.children().length){s.active=!0;var i=r.builtShortHtml(s);u(".js-selected-address").html(i)}a.push(s);var e=r.builtAddressHtml(s);l.append(e),t.hide(),l.show()}else j.alert({title:n.msg})})}),l.on("click",".jl-consignee-title",function(){u(".jl-consignee-title").removeClass("jl-cur"),u(this).addClass("jl-cur");var s=String(u(this).data("id"));u.each(a,function(n,i){if(i.id===s){var e=r.builtShortHtml(i);return u(".js-selected-address").html(e),!1}})})},builtShortHtml:function(n){return"<span>收货人："+n.consignee+" "+n.mobile+"</span>\n<span>"+r.getData(n.area_code).join(" ")+" "+n.address+"</span>\n"},builtAddressHtml:function(n){n.length||(n=[n]);var e="";return u.each(n,function(n,i){e+='<li>\n<p data-id="'+i.id+'" data-code="'+i.area_code+'" class="jl-consignee-title '+("1"===i.status?"jl-cur":i.active?"jl-cur":"")+'">'+i.consignee+'<i></i></p>\n<span class="jl-consignee-name">'+i.consignee+'</span>\n<span class="jl-consignee-addr">'+r.getData(i.area_code).join(" ")+" "+i.address+'</span>\n<span class="jl-consignee-phone">'+i.mobile+"</span>\n</li>"}),e}},invoice:{init:function(n,i){var r=this,e=u(".jl-special-invoice"),a=u(".jl-ordinary-invoice"),l=u(".jl-no-invoice"),s=u(".js-add-invoice"),t=u(".js-popup-special"),o=u(".js-popup-ordinary"),c=[],d=[];u.each(n,function(n,i){"1"===i.invoice_type?c.push(i):d.push(i)});var p="",h="";0!==c.length&&(c[0].active=!0,p=r.builtInvoiceHtml(c,1),e.html(p)),0!==d.length&&(d[0].active=!0,h=r.builtInvoiceHtml(d,2),a.html(h)),u(".jl-invoice-class li").on("click",function(){u(this).addClass("jl-cur").siblings().removeClass("jl-cur");var n=u(this).index();if(e.hide(),a.hide(),l.hide(),s.hide(),0!==n){var i=1===n?e:a;i.show(),s.show(),0===i.children().length&&l.show()}}),s.on("click",function(){var n=u(".jl-invoice-class .jl-cur").index();1===n?t.show():2===n&&o.show()}),t.find(".jl-close").on("click",function(){t.hide()}),o.find(".jl-close").on("click",function(){o.hide()}),t.find(".jl-popup-submit").on("click",function(){var s=!0,a={};t.find("input").each(function(){var n=u(this),i=u(this).val().trim(),e=new RegExp("^(\\-|\\+)?\\d+(\\-\\d+)?$");if("company_phone"===this.name)e.test(i);""===i?("company_area_code"===this.name||"area_code"===this.name?v(n,"error"):m(n,"error",this.name),s=!1):"company_phone"!==this.name||e.test(i)?"mobile"===this.name&&11!==i.length&&(m(n,"error"),s=!1):(m(n,"error"),s=!1),a[this.name]=i}),s&&(a.invoice_type=1,u.post(i,a,function(n){if(0===(n=u.parseJSON(n)).error){t.hide(),a.id=n.data.invoice_id,0===e.children().length&&(a.active=!0);var i=r.builtInvoiceHtml(a,1);e.append(i),l.hide()}else j.alert({title:n.msg})}))}),o.find(".jl-popup-submit").on("click",function(){var e=!0,s={};o.find("input").each(function(){var n=u(this),i=n.val().trim();""===i?("area_code"===this.name?v(n,"error"):m(n,"error",this.name),e=!1):"mobile"===this.name&&11!==i.length&&(m(n,"error"),e=!1),s[this.name]=i}),e&&(s.invoice_type=2,u.post(i,s,function(n){if(0===(n=u.parseJSON(n)).error){o.hide(),s.id=n.data.invoice_id,0===a.children().length&&(s.active=!0);var i=r.builtInvoiceHtml(s,2);a.append(i),l.hide()}else j.alert({title:n.msg})}))}),e.on("click","li",function(){u(this).addClass("jl-cur").siblings().removeClass("jl-cur")}),a.on("click","li",function(){u(this).addClass("jl-cur").siblings().removeClass("jl-cur")})},builtInvoiceHtml:function(n,s){n.length||(n=[n]);var a="";return u.each(n,function(n,i){var e=1===s?'    <div class="jl-special-phone">\n        <p class="jl-ordinary-title">地址、电话:</p>\n        <p class="jl-ordinary-addr">\n            <span class="jl-ordinary-name">'+r.getData(i.company_area_code).join(" ")+" "+i.company_address+'            </span>\n            <span class="jl-ordinary-telephone">'+i.company_phone+'</span>\n        </p>\n    </div>\n    <div class="jl-special-number">\n        <p class="jl-ordinary-title">税务登记号:</p>\n        <p class="jl-ordinary-name">'+i.company_tax_code+'</p>\n    </div>\n    <div class="jl-special-bank">\n        <p class="jl-ordinary-title">开户行、账号:</p>\n        <p class="jl-ordinary-addr">\n            <span class="jl-ordinary-name">'+i.company_bank_name+'</span>\n            <span class="jl-ordinary-telephone">'+i.company_bank_acount+"</span>\n        </p>\n    </div>\n":"";a+='<li data-id="'+i.id+'" class="'+(i.active?"jl-cur":"")+'">\n    <div class="jl-ordinary-top">\n        <p class="jl-ordinary-title">发票抬头:</p>\n        <p class="jl-ordinary-name">'+i.invoice_header+"</p>\n    </div>\n"+e+'    <div class="jl-ordinary-bottom">\n        <p class="jl-ordinary-title">收票人信息:</p>\n        <p class="jl-ordinary-addr">\n            <span class="jl-ordinary-name">'+i.invoice_owner+'</span>\n            <span class="jl-ordinary-news">'+r.getData(i.area_code).join(" ")+" "+i.address+'            </span>\n            <span class="jl-ordinary-phone">'+i.mobile+"</span>\n        </p>\n    </div>\n    <i></i>\n</li>"}),a}}}});